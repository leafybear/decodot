{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Wanikani Open Framework","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_prototypes":false,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["/^https://(www|preview).wanikani.com//"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":null,"orig_connects":[]}},"storage":{"ts":1645069584970,"data":{}},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/38582-wanikani-open-framework/code/Wanikani%20Open%20Framework.user.js","uuid":"4afe316b-be1b-4481-8707-5d5fb28c0a16","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIFdhbmlrYW5pIE9wZW4gRnJhbWV3b3JrCi8vIEBuYW1lc3BhY2UgICByZmluZGxleQovLyBAZGVzY3JpcHRpb24gRnJhbWV3b3JrIGZvciB3cml0aW5nIHNjcmlwdHMgZm9yIFdhbmlrYW5pCi8vIEB2ZXJzaW9uICAgICAxLjAuNTgKLy8gQGluY2x1ZGUgICAgIC9eaHR0cHM6Ly8od3d3fHByZXZpZXcpLndhbmlrYW5pLmNvbS8vCi8vIEBjb3B5cmlnaHQgICAyMDE4KywgUm9iaW4gRmluZGxleQovLyBAbGljZW5zZSAgICAgTUlUOyBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUCi8vIEBydW4tYXQgICAgICBkb2N1bWVudC1zdGFydAovLyBAZ3JhbnQgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbihnbG9iYWwpIHsKCSd1c2Ugc3RyaWN0JzsKCgkvKiBlc2xpbnQgbm8tbXVsdGktc3BhY2VzOiBvZmYgKi8KCS8qIGdsb2JhbHMgd2tvZiAqLwoKCXZhciB2ZXJzaW9uID0gJzEuMC41OCc7Cgl2YXIgaWdub3JlX21pc3NpbmdfaW5kZXhlZGRiID0gZmFsc2U7CgoJLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBTdXBwb3J0ZWQgTW9kdWxlcwoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCXZhciBzdXBwb3J0ZWRfbW9kdWxlcyA9IHsKCQlBcGl2MjogICAgeyB1cmw6ICdodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvMzg1ODEtd2FuaWthbmktb3Blbi1mcmFtZXdvcmstYXBpdjItbW9kdWxlL2NvZGUvV2FuaWthbmklMjBPcGVuJTIwRnJhbWV3b3JrJTIwLSUyMEFwaXYyJTIwbW9kdWxlLmpzP3ZlcnNpb249NzQ3ODY2J30sCgkJSXRlbURhdGE6IHsgdXJsOiAnaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzM4NTgwLXdhbmlrYW5pLW9wZW4tZnJhbWV3b3JrLWl0ZW1kYXRhLW1vZHVsZS9jb2RlL1dhbmlrYW5pJTIwT3BlbiUyMEZyYW1ld29yayUyMC0lMjBJdGVtRGF0YSUyMG1vZHVsZS5qcz92ZXJzaW9uPTEwMzAxNTknfSwKCQlNZW51OiAgICAgeyB1cmw6ICdodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvMzg1Nzgtd2FuaWthbmktb3Blbi1mcmFtZXdvcmstbWVudS1tb2R1bGUvY29kZS9XYW5pa2FuaSUyME9wZW4lMjBGcmFtZXdvcmslMjAtJTIwTWVudSUyMG1vZHVsZS5qcz92ZXJzaW9uPTEwMjkzOTAnfSwKCQlQcm9ncmVzczogeyB1cmw6ICdodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvMzg1Nzctd2FuaWthbmktb3Blbi1mcmFtZXdvcmstcHJvZ3Jlc3MtbW9kdWxlL2NvZGUvV2FuaWthbmklMjBPcGVuJTIwRnJhbWV3b3JrJTIwLSUyMFByb2dyZXNzJTIwbW9kdWxlLmpzP3ZlcnNpb249NjAxNDczJ30sCgkJU2V0dGluZ3M6IHsgdXJsOiAnaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzM4NTc2LXdhbmlrYW5pLW9wZW4tZnJhbWV3b3JrLXNldHRpbmdzLW1vZHVsZS9jb2RlL1dhbmlrYW5pJTIwT3BlbiUyMEZyYW1ld29yayUyMC0lMjBTZXR0aW5ncyUyMG1vZHVsZS5qcz92ZXJzaW9uPTEwMzAxNjMnfSwKCX07CgoJLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBQdWJsaXNoZWQgaW50ZXJmYWNlCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJdmFyIHB1Ymxpc2hlZF9pbnRlcmZhY2UgPSB7CgkJaW5jbHVkZTogaW5jbHVkZSwgICAgICAgICAgICAgIC8vIGluY2x1ZGUobW9kdWxlX2xpc3QpICAgICAgICA9PiBQcm9taXNlCgkJcmVhZHk6ICAgcmVhZHksICAgICAgICAgICAgICAgIC8vIHJlYWR5KG1vZHVsZV9saXN0KSAgICAgICAgICA9PiBQcm9taXNlCgoJCWxvYWRfZmlsZTogICBsb2FkX2ZpbGUsICAgICAgICAvLyBsb2FkX2ZpbGUodXJsLCB1c2VfY2FjaGUpICAgPT4gUHJvbWlzZQoJCWxvYWRfY3NzOiAgICBsb2FkX2NzcywgICAgICAgICAvLyBsb2FkX2Nzcyh1cmwsIHVzZV9jYWNoZSkgICAgPT4gUHJvbWlzZQoJCWxvYWRfc2NyaXB0OiBsb2FkX3NjcmlwdCwgICAgICAvLyBsb2FkX3NjcmlwdCh1cmwsIHVzZV9jYWNoZSkgPT4gUHJvbWlzZQoKCQlmaWxlX2NhY2hlOiB7CgkJCWRpcjogICAge30sICAgICAgICAgICAgICAgIC8vIE9iamVjdCBjb250YWluaW5nIGRpcmVjdG9yeSBvZiBmaWxlcy4KCQkJbHM6ICAgICBmaWxlX2NhY2hlX2xpc3QsICAgLy8gbHMoKQoJCQljbGVhcjogIGZpbGVfY2FjaGVfY2xlYXIsICAvLyBjbGVhcigpICAgICAgICAgICAgID0+IFByb21pc2UKCQkJZGVsZXRlOiBmaWxlX2NhY2hlX2RlbGV0ZSwgLy8gZGVsZXRlKG5hbWUpICAgICAgICA9PiBQcm9taXNlCgkJCWZsdXNoOiAgZmlsZV9jYWNoZV9mbHVzaCwgIC8vIGZsdXNoKCkgICAgICAgICAgICAgPT4gUHJvbWlzZQoJCQlsb2FkOiAgIGZpbGVfY2FjaGVfbG9hZCwgICAvLyBsb2FkKG5hbWUpICAgICAgICAgID0+IFByb21pc2UKCQkJc2F2ZTogICBmaWxlX2NhY2hlX3NhdmUsICAgLy8gc2F2ZShuYW1lLCBjb250ZW50KSA9PiBQcm9taXNlCgkJCW5vX2NhY2hlOmZpbGVfbm9jYWNoZSwgICAgIC8vIG5vX2NhY2hlKG1vZHVsZXMpCgkJfSwKCgkJb246ICAgICAgd2FpdF9ldmVudCwgICAgICAgICAgIC8vIG9uKGV2ZW50LCBjYWxsYmFjaykKCQl0cmlnZ2VyOiB0cmlnZ2VyX2V2ZW50LCAgICAgICAgLy8gdHJpZ2dlcihldmVudFssIGRhdGExWywgZGF0YTJbLCAuLi5dXV0pCgoJCWdldF9zdGF0ZTogIGdldF9zdGF0ZSwgICAgICAgICAvLyBnZXQoc3RhdGVfdmFyKQoJCXNldF9zdGF0ZTogIHNldF9zdGF0ZSwgICAgICAgICAvLyBzZXQoc3RhdGVfdmFyLCB2YWx1ZSkKCQl3YWl0X3N0YXRlOiB3YWl0X3N0YXRlLCAgICAgICAgLy8gd2FpdChzdGF0ZV92YXIsIHZhbHVlWywgY2FsbGJhY2tbLCBwZXJzaXN0ZW50XV0pID0+IGlmIG5vIGNhbGxiYWNrLCByZXR1cm4gb25lLXNob3QgUHJvbWlzZQoKCQl2ZXJzaW9uOiB7CgkJCXZhbHVlOiB2ZXJzaW9uLAoJCQljb21wYXJlX3RvOiBjb21wYXJlX3RvLCAgICAvLyBjb21wYXJlX3ZlcnNpb24odmVyc2lvbikKCQl9Cgl9OwoKCXB1Ymxpc2hlZF9pbnRlcmZhY2Uuc3VwcG9ydF9maWxlcyA9IHsKCQknanF1ZXJ5X3VpLmpzJzogJ2h0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5dWkvMS4xMi4xL2pxdWVyeS11aS5taW4uanMnLAoJCSdqcXVpX3drbWFpbi5jc3MnOiAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3JmaW5kbGV5L3dhbmlrYW5pLW9wZW4tZnJhbWV3b3JrLzE1NTBhZjgzODNlYzI4YWQ0MDZjZjQwMWFlZTJkZTRjNTI0NDZmNmMvanF1aS13a21haW4uY3NzJywKCX07CgoJLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCglmdW5jdGlvbiBzcGxpdF9saXN0KHN0cikge3JldHVybiBzdHIucmVwbGFjZSgv44CBL2csJywnKS5yZXBsYWNlKC9bXHPjgIBdKy9nLCcgJykudHJpbSgpLnJlcGxhY2UoLyAqLCAqL2csICcsJykuc3BsaXQoJywnKS5maWx0ZXIoZnVuY3Rpb24obmFtZSkge3JldHVybiAobmFtZS5sZW5ndGggPiAwKTt9KTt9CglmdW5jdGlvbiBwcm9taXNlKCl7dmFyIGEsYixjPW5ldyBQcm9taXNlKGZ1bmN0aW9uKGQsZSl7YT1kO2I9ZTt9KTtjLnJlc29sdmU9YTtjLnJlamVjdD1iO3JldHVybiBjO30KCgkvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBDb21wYXJlIHRoZSBmcmFtZXdvcmsgdmVyc2lvbiBhZ2FpbnN0IGEgc3BlY2lmaWMgdmVyc2lvbi4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjb21wYXJlX3RvKGNsaWVudF92ZXJzaW9uKSB7CgkJdmFyIGNsaWVudF92ZXIgPSBjbGllbnRfdmVyc2lvbi5zcGxpdCgnLicpLm1hcChkID0+IE51bWJlcihkKSk7CgkJdmFyIHdrb2ZfdmVyID0gdmVyc2lvbi5zcGxpdCgnLicpLm1hcChkID0+IE51bWJlcihkKSk7CgkJdmFyIGxlbiA9IE1hdGgubWF4KGNsaWVudF92ZXIubGVuZ3RoLCB3a29mX3Zlci5sZW5ndGgpOwoJCWZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGxlbjsgaWR4KyspIHsKCQkJdmFyIGEgPSBjbGllbnRfdmVyW2lkeF0gfHwgMDsKCQkJdmFyIGIgPSB3a29mX3ZlcltpZHhdIHx8IDA7CgkJCWlmIChhID09PSBiKSBjb250aW51ZTsKCQkJaWYgKGEgPCBiKSByZXR1cm4gJ25ld2VyJzsKCQkJcmV0dXJuICdvbGRlcic7CgkJfQoJCXJldHVybiAnc2FtZSc7Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEluY2x1ZGUgYSBsaXN0IG9mIG1vZHVsZXMuCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJdmFyIGluY2x1ZGVfcHJvbWlzZXMgPSB7fTsKCglmdW5jdGlvbiBpbmNsdWRlKG1vZHVsZV9saXN0KSB7CgkJaWYgKHdrb2YuZ2V0X3N0YXRlKCd3a29mLndrb2YnKSAhPT0gJ3JlYWR5JykgewoJCQlyZXR1cm4gd2tvZi5yZWFkeSgnd2tvZicpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gd2tvZi5pbmNsdWRlKG1vZHVsZV9saXN0KTt9KTsKCQl9CgkJdmFyIGluY2x1ZGVfcHJvbWlzZSA9IHByb21pc2UoKTsKCQl2YXIgbW9kdWxlX25hbWVzID0gc3BsaXRfbGlzdChtb2R1bGVfbGlzdCk7CgkJdmFyIHNjcmlwdF9jbnQgPSBtb2R1bGVfbmFtZXMubGVuZ3RoOwoJCWlmIChzY3JpcHRfY250ID09PSAwKSB7CgkJCWluY2x1ZGVfcHJvbWlzZS5yZXNvbHZlKHtsb2FkZWQ6W10sIGZhaWxlZDpbXX0pOwoJCQlyZXR1cm4gaW5jbHVkZV9wcm9taXNlOwoJCX0KCgkJdmFyIGRvbmVfY250ID0gMDsKCQl2YXIgbG9hZGVkID0gW10sIGZhaWxlZCA9IFtdOwoJCXZhciBub19jYWNoZSA9IHNwbGl0X2xpc3QobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3drb2YuaW5jbHVkZS5ub2NhY2hlJykgfHwgJycpOwoJCWZvciAodmFyIGlkeCA9IDA7IGlkeCA8IG1vZHVsZV9uYW1lcy5sZW5ndGg7IGlkeCsrKSB7CgkJCXZhciBtb2R1bGVfbmFtZSA9IG1vZHVsZV9uYW1lc1tpZHhdOwoJCQl2YXIgbW9kdWxlID0gc3VwcG9ydGVkX21vZHVsZXNbbW9kdWxlX25hbWVdOwoJCQlpZiAoIW1vZHVsZSkgewoJCQkJZmFpbGVkLnB1c2goe25hbWU6bW9kdWxlX25hbWUsIHVybDp1bmRlZmluZWR9KTsKCQkJCWNoZWNrX2RvbmUoKTsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCXZhciBhd2FpdF9sb2FkID0gaW5jbHVkZV9wcm9taXNlc1ttb2R1bGVfbmFtZV07CgkJCXZhciB1c2VfY2FjaGUgPSAobm9fY2FjaGUuaW5kZXhPZihtb2R1bGVfbmFtZSkgPCAwKSAmJiAobm9fY2FjaGUuaW5kZXhPZignKicpIDwgMCk7CgkJCWlmICghdXNlX2NhY2hlKSBmaWxlX2NhY2hlX2RlbGV0ZShtb2R1bGUudXJsKTsKCQkJaWYgKGF3YWl0X2xvYWQgPT09IHVuZGVmaW5lZCkgaW5jbHVkZV9wcm9taXNlc1ttb2R1bGVfbmFtZV0gPSBhd2FpdF9sb2FkID0gbG9hZF9zY3JpcHQobW9kdWxlLnVybCwgdXNlX2NhY2hlKTsKCQkJYXdhaXRfbG9hZC50aGVuKHB1c2hfbG9hZGVkLCBwdXNoX2ZhaWxlZCk7CgkJfQoKCQlyZXR1cm4gaW5jbHVkZV9wcm9taXNlOwoKCQlmdW5jdGlvbiBwdXNoX2xvYWRlZCh1cmwpIHsKCQkJbG9hZGVkLnB1c2godXJsKTsKCQkJY2hlY2tfZG9uZSgpOwoJCX0KCgkJZnVuY3Rpb24gcHVzaF9mYWlsZWQodXJsKSB7CgkJCWZhaWxlZC5wdXNoKHVybCk7CgkJCWNoZWNrX2RvbmUoKTsKCQl9CgoJCWZ1bmN0aW9uIGNoZWNrX2RvbmUoKSB7CgkJCWlmICgrK2RvbmVfY250IDwgc2NyaXB0X2NudCkgcmV0dXJuOwoJCQlpZiAoZmFpbGVkLmxlbmd0aCA9PT0gMCkgaW5jbHVkZV9wcm9taXNlLnJlc29sdmUoe2xvYWRlZDpsb2FkZWQsIGZhaWxlZDpmYWlsZWR9KTsKCQkJZWxzZSBpbmNsdWRlX3Byb21pc2UucmVqZWN0KHtlcnJvcjonRmFpbHVyZSBsb2FkaW5nIG1vZHVsZScsIGxvYWRlZDpsb2FkZWQsIGZhaWxlZDpmYWlsZWR9KTsKCQl9Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIFdhaXQgZm9yIGFsbCBtb2R1bGVzIHRvIHJlcG9ydCB0aGF0IHRoZXkgYXJlIHJlYWR5CgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcmVhZHkobW9kdWxlX2xpc3QpIHsKCQl2YXIgbW9kdWxlX25hbWVzID0gc3BsaXRfbGlzdChtb2R1bGVfbGlzdCk7CgoJCXZhciByZWFkeV9wcm9taXNlcyA9IFsgXTsKCQlmb3IgKHZhciBpZHggaW4gbW9kdWxlX25hbWVzKSB7CgkJCXZhciBtb2R1bGVfbmFtZSA9IG1vZHVsZV9uYW1lc1tpZHhdOwoJCQlyZWFkeV9wcm9taXNlcy5wdXNoKHdhaXRfc3RhdGUoJ3drb2YuJyArIG1vZHVsZV9uYW1lLCAncmVhZHknKSk7CgkJfQoKCQlpZiAocmVhZHlfcHJvbWlzZXMubGVuZ3RoID09PSAwKSB7CgkJCXJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKCQl9IGVsc2UgaWYgKHJlYWR5X3Byb21pc2VzLmxlbmd0aCA9PT0gMSkgewoJCQlyZXR1cm4gcmVhZHlfcHJvbWlzZXNbMF07CgkJfSBlbHNlIHsKCQkJcmV0dXJuIFByb21pc2UuYWxsKHJlYWR5X3Byb21pc2VzKTsKCQl9Cgl9CgkvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBMb2FkIGEgZmlsZSBhc3luY2hyb25vdXNseSwgYW5kIHBhc3MgdGhlIGZpbGUgYXMgcmVzb2x2ZWQgUHJvbWlzZSBkYXRhLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGxvYWRfZmlsZSh1cmwsIHVzZV9jYWNoZSkgewoJCXZhciBmZXRjaF9wcm9taXNlID0gcHJvbWlzZSgpOwoJCXZhciBub19jYWNoZSA9IHNwbGl0X2xpc3QobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3drb2YubG9hZF9maWxlLm5vY2FjaGUnKSB8fCAnJyk7CgkJaWYgKG5vX2NhY2hlLmluZGV4T2YodXJsKSA+PSAwIHx8IG5vX2NhY2hlLmluZGV4T2YoJyonKSA+PSAwKSB1c2VfY2FjaGUgPSBmYWxzZTsKCQlpZiAodXNlX2NhY2hlID09PSB0cnVlKSB7CgkJCXJldHVybiBmaWxlX2NhY2hlX2xvYWQodXJsLCB1c2VfY2FjaGUpLmNhdGNoKGZldGNoX3VybCk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGZldGNoX3VybCgpOwoJCX0KCgkJLy8gUmV0cmlldmUgZmlsZSBmcm9tIHNlcnZlcgoJCWZ1bmN0aW9uIGZldGNoX3VybCgpewoJCQl2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoJCQlyZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHByb2Nlc3NfcmVzdWx0OwoJCQlyZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CgkJCXJlcXVlc3Quc2VuZCgpOwoJCQlyZXR1cm4gZmV0Y2hfcHJvbWlzZTsKCQl9CgoJCWZ1bmN0aW9uIHByb2Nlc3NfcmVzdWx0KGV2ZW50KXsKCQkJaWYgKGV2ZW50LnRhcmdldC5yZWFkeVN0YXRlICE9PSA0KSByZXR1cm47CgkJCWlmIChldmVudC50YXJnZXQuc3RhdHVzID49IDQwMCB8fCBldmVudC50YXJnZXQuc3RhdHVzID09PSAwKSByZXR1cm4gZmV0Y2hfcHJvbWlzZS5yZWplY3QoZXZlbnQudGFyZ2V0LnN0YXR1cyk7CgkJCWlmICh1c2VfY2FjaGUpIHsKCQkJCWZpbGVfY2FjaGVfc2F2ZSh1cmwsIGV2ZW50LnRhcmdldC5yZXNwb25zZSkKCQkJCS50aGVuKGZldGNoX3Byb21pc2UucmVzb2x2ZS5iaW5kKG51bGwsZXZlbnQudGFyZ2V0LnJlc3BvbnNlKSk7CgkJCX0gZWxzZSB7CgkJCQlmZXRjaF9wcm9taXNlLnJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3BvbnNlKTsKCQkJfQoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTG9hZCBhbmQgaW5zdGFsbCBhIHNwZWNpZmljIGZpbGUgdHlwZSBpbnRvIHRoZSBET00uCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gbG9hZF9hbmRfYXBwZW5kKHVybCwgdGFnX25hbWUsIGxvY2F0aW9uLCB1c2VfY2FjaGUpIHsKCQl1cmwgPSB1cmwucmVwbGFjZSgvIi9nLCdcJycpOwoJCWlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhZ19uYW1lKydbdWlkPSInK3VybCsnIl0nKSAhPT0gbnVsbCkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwoJCXJldHVybiBsb2FkX2ZpbGUodXJsLCB1c2VfY2FjaGUpLnRoZW4oYXBwZW5kX3RvX3RhZyk7CgoJCWZ1bmN0aW9uIGFwcGVuZF90b190YWcoY29udGVudCkgewoJCQl2YXIgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdfbmFtZSk7CgkJCXRhZy5pbm5lckhUTUwgPSBjb250ZW50OwoJCQl0YWcuc2V0QXR0cmlidXRlKCd1aWQnLCB1cmwpOwoJCQlkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGxvY2F0aW9uKS5hcHBlbmRDaGlsZCh0YWcpOwoJCQlyZXR1cm4gdXJsOwoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTG9hZCBhbmQgaW5zdGFsbCBhIENTUyBmaWxlLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGxvYWRfY3NzKHVybCwgdXNlX2NhY2hlKSB7CgkJcmV0dXJuIGxvYWRfYW5kX2FwcGVuZCh1cmwsICdzdHlsZScsICdoZWFkJywgdXNlX2NhY2hlKTsKCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTG9hZCBhbmQgaW5zdGFsbCBKYXZhc2NyaXB0LgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGxvYWRfc2NyaXB0KHVybCwgdXNlX2NhY2hlKSB7CgkJcmV0dXJuIGxvYWRfYW5kX2FwcGVuZCh1cmwsICdzY3JpcHQnLCAnYm9keScsIHVzZV9jYWNoZSk7Cgl9CgkvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCXZhciBzdGF0ZV9saXN0ZW5lcnMgPSB7fTsKCXZhciBzdGF0ZV92YWx1ZXMgPSB7fTsKCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gR2V0IHRoZSB2YWx1ZSBvZiBhIHN0YXRlIHZhcmlhYmxlLCBhbmQgbm90aWZ5IGxpc3RlbmVycy4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXRfc3RhdGUoc3RhdGVfdmFyKSB7CgkJcmV0dXJuIHN0YXRlX3ZhbHVlc1tzdGF0ZV92YXJdOwoJfQoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBTZXQgdGhlIHZhbHVlIG9mIGEgc3RhdGUgdmFyaWFibGUsIGFuZCBub3RpZnkgbGlzdGVuZXJzLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHNldF9zdGF0ZShzdGF0ZV92YXIsIHZhbHVlKSB7CgkJdmFyIG9sZF92YWx1ZSA9IHN0YXRlX3ZhbHVlc1tzdGF0ZV92YXJdOwoJCWlmIChvbGRfdmFsdWUgPT09IHZhbHVlKSByZXR1cm47CgkJc3RhdGVfdmFsdWVzW3N0YXRlX3Zhcl0gPSB2YWx1ZTsKCgkJLy8gRG8gbGlzdGVuZXIgY2FsbGJhY2tzLCBhbmQgcmVtb3ZlIG5vbi1wZXJzaXN0ZW50IGxpc3RlbmVycwoJCXZhciBsaXN0ZW5lcnMgPSBzdGF0ZV9saXN0ZW5lcnNbc3RhdGVfdmFyXTsKCQl2YXIgcGVyc2lzdGVudF9saXN0ZW5lcnMgPSBbIF07CgkJZm9yICh2YXIgaWR4IGluIGxpc3RlbmVycykgewoJCQl2YXIgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaWR4XTsKCQkJdmFyIGtlZXAgPSB0cnVlOwoJCQlpZiAobGlzdGVuZXIudmFsdWUgPT09IHZhbHVlIHx8IGxpc3RlbmVyLnZhbHVlID09PSAnKicpIHsKCQkJCWtlZXAgPSBsaXN0ZW5lci5wZXJzaXN0ZW50OwoJCQkJdHJ5IHsKCQkJCQlsaXN0ZW5lci5jYWxsYmFjayh2YWx1ZSwgb2xkX3ZhbHVlKTsKCQkJCX0gY2F0Y2ggKGUpIHt9CgkJCX0KCQkJaWYgKGtlZXApIHBlcnNpc3RlbnRfbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwoJCX0KCQlzdGF0ZV9saXN0ZW5lcnNbc3RhdGVfdmFyXSA9IHBlcnNpc3RlbnRfbGlzdGVuZXJzOwoJfQoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBXaGVuIHN0YXRlIG9mIHN0YXRlX3ZhciBjaGFuZ2VzIHRvIHZhbHVlLCBjYWxsIGNhbGxiYWNrLgoJLy8gSWYgcGVyc2lzdGVudCA9PT0gdHJ1ZSwgY29udGludWUgbGlzdGVuaW5nIGZvciBhZGRpdGlvbmFsIHN0YXRlIGNoYW5nZXMKCS8vIElmIHZhbHVlIGlzICcqJywgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgZm9yIGFsbCBzdGF0ZSBjaGFuZ2VzLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHdhaXRfc3RhdGUoc3RhdGVfdmFyLCB2YWx1ZSwgY2FsbGJhY2ssIHBlcnNpc3RlbnQpIHsKCQl2YXIgcHJvbWlzZTsKCQlpZiAoY2FsbGJhY2sgPT09IHVuZGVmaW5lZCkgewoJCQlwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CgkJCQljYWxsYmFjayA9IHJlc29sdmU7CgkJCX0pOwoJCX0KCQlpZiAoc3RhdGVfbGlzdGVuZXJzW3N0YXRlX3Zhcl0gPT09IHVuZGVmaW5lZCkgc3RhdGVfbGlzdGVuZXJzW3N0YXRlX3Zhcl0gPSBbIF07CgkJcGVyc2lzdGVudCA9IChwZXJzaXN0ZW50ID09PSB0cnVlKTsKCQl2YXIgY3VycmVudF92YWx1ZSA9IHN0YXRlX3ZhbHVlc1tzdGF0ZV92YXJdOwoJCWlmIChwZXJzaXN0ZW50IHx8IHZhbHVlICE9PSBjdXJyZW50X3ZhbHVlKSBzdGF0ZV9saXN0ZW5lcnNbc3RhdGVfdmFyXS5wdXNoKHtjYWxsYmFjazpjYWxsYmFjaywgcGVyc2lzdGVudDpwZXJzaXN0ZW50LCB2YWx1ZTp2YWx1ZX0pOwoKCQkvLyBJZiBpdCdzIGFscmVhZHkgYXQgdGhlIGRlc2lyZWQgc3RhdGUsIGNhbGwgdGhlIGNhbGxiYWNrIGltbWVkaWF0ZWx5LgoJCWlmICh2YWx1ZSA9PT0gY3VycmVudF92YWx1ZSkgewoJCQl0cnkgewoJCQkJY2FsbGJhY2sodmFsdWUsIGN1cnJlbnRfdmFsdWUpOwoJCQl9IGNhdGNoIChlcnIpIHt9CgkJfQoJCXJldHVybiBwcm9taXNlOwoJfQoJLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgl2YXIgZXZlbnRfbGlzdGVuZXJzID0ge307CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEZpcmUgYW4gZXZlbnQsIHdoaWNoIHRoZW4gY2FsbHMgY2FsbGJhY2tzIGZvciBhbnkgbGlzdGVuZXJzLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHRyaWdnZXJfZXZlbnQoZXZlbnQpIHsKCQl2YXIgbGlzdGVuZXJzID0gZXZlbnRfbGlzdGVuZXJzW2V2ZW50XTsKCQlpZiAobGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHJldHVybjsKCQl2YXIgYXJncyA9IFtdOwoJCUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGFyZ3MsYXJndW1lbnRzKTsKCQlhcmdzLnNoaWZ0KCk7CgkJZm9yICh2YXIgaWR4IGluIGxpc3RlbmVycykgdHJ5IHsKCQkJbGlzdGVuZXJzW2lkeF0uYXBwbHkobnVsbCxhcmdzKTsKCQl9IGNhdGNoIChlcnIpIHt9CgkJcmV0dXJuIGdsb2JhbC53a29mOwoJfQoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBBZGQgYSBsaXN0ZW5lciBmb3IgYW4gZXZlbnQuCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gd2FpdF9ldmVudChldmVudCwgY2FsbGJhY2spIHsKCQlpZiAoZXZlbnRfbGlzdGVuZXJzW2V2ZW50XSA9PT0gdW5kZWZpbmVkKSBldmVudF9saXN0ZW5lcnNbZXZlbnRdID0gW107CgkJZXZlbnRfbGlzdGVuZXJzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTsKCQlyZXR1cm4gZ2xvYmFsLndrb2Y7Cgl9CgkvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCXZhciBmaWxlX2NhY2hlX29wZW5fcHJvbWlzZTsKCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gT3BlbiB0aGUgZmlsZV9jYWNoZSBkYXRhYmFzZSAob3IgcmV0dXJuIGhhbmRsZSBpZiBvcGVuKS4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmaWxlX2NhY2hlX29wZW4oKSB7CgkJaWYgKGZpbGVfY2FjaGVfb3Blbl9wcm9taXNlKSByZXR1cm4gZmlsZV9jYWNoZV9vcGVuX3Byb21pc2U7CgkJdmFyIG9wZW5fcHJvbWlzZSA9IHByb21pc2UoKTsKCQlmaWxlX2NhY2hlX29wZW5fcHJvbWlzZSA9IG9wZW5fcHJvbWlzZTsKCQl2YXIgcmVxdWVzdDsKCQlyZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oJ3drb2YuZmlsZV9jYWNoZScpOwoJCXJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gdXBncmFkZV9kYjsKCQlyZXF1ZXN0Lm9uc3VjY2VzcyA9IGdldF9kaXI7CgkJcmVxdWVzdC5vbmVycm9yID0gZXJyb3I7CgkJcmV0dXJuIG9wZW5fcHJvbWlzZTsKCgkJZnVuY3Rpb24gZXJyb3IoKSB7CgkJCWNvbnNvbGUubG9nKCdpbmRleGVkREIgY291bGQgbm90IG9wZW4hJyk7CgkJCXdrb2YuZmlsZV9jYWNoZS5kaXIgPSB7fTsKCQkJaWYgKGlnbm9yZV9taXNzaW5nX2luZGV4ZWRkYikgewoJCQkJb3Blbl9wcm9taXNlLnJlc29sdmUobnVsbCk7CgkJCX0gZWxzZSB7CgkJCQlvcGVuX3Byb21pc2UucmVqZWN0KCk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIHVwZ3JhZGVfZGIoZXZlbnQpewoJCQl2YXIgZGIgPSBldmVudC50YXJnZXQucmVzdWx0OwoJCQl2YXIgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgnZmlsZXMnLCB7a2V5UGF0aDonbmFtZSd9KTsKCQl9CgoJCWZ1bmN0aW9uIGdldF9kaXIoZXZlbnQpewoJCQl2YXIgZGIgPSBldmVudC50YXJnZXQucmVzdWx0OwoJCQl2YXIgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbignZmlsZXMnLCAncmVhZG9ubHknKTsKCQkJdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoJ2ZpbGVzJyk7CgkJCXZhciByZXF1ZXN0ID0gc3RvcmUuZ2V0KCdbZGlyXScpOwoJCQlyZXF1ZXN0Lm9uc3VjY2VzcyA9IHByb2Nlc3NfZGlyOwoJCQl0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gb3Blbl9wcm9taXNlLnJlc29sdmUuYmluZChudWxsLCBkYik7CgkJCW9wZW5fcHJvbWlzZS50aGVuKHNldFRpbWVvdXQuYmluZChudWxsLCBmaWxlX2NhY2hlX2NsZWFudXAsIDEwMDAwKSk7CgkJfQoKCQlmdW5jdGlvbiBwcm9jZXNzX2RpcihldmVudCl7CgkJCWlmIChldmVudC50YXJnZXQucmVzdWx0ID09PSB1bmRlZmluZWQpIHsKCQkJCXdrb2YuZmlsZV9jYWNoZS5kaXIgPSB7fTsKCQkJfSBlbHNlIHsKCQkJCXdrb2YuZmlsZV9jYWNoZS5kaXIgPSBKU09OLnBhcnNlKGV2ZW50LnRhcmdldC5yZXN1bHQuY29udGVudCk7CgkJCX0KCQl9Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIExpc3RzIHRoZSBjb250ZW50IG9mIHRoZSBmaWxlX2NhY2hlLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZpbGVfY2FjaGVfbGlzdCgpIHsKCQljb25zb2xlLmxvZyhPYmplY3Qua2V5cyh3a29mLmZpbGVfY2FjaGUuZGlyKS5zb3J0KCkuam9pbignXG4nKSk7Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIENsZWFyIHRoZSBmaWxlX2NhY2hlIGRhdGFiYXNlLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZpbGVfY2FjaGVfY2xlYXIoKSB7CgkJcmV0dXJuIGZpbGVfY2FjaGVfb3BlbigpLnRoZW4oY2xlYXIpOwoKCQlmdW5jdGlvbiBjbGVhcihkYikgewoJCQl2YXIgY2xlYXJfcHJvbWlzZSA9IHByb21pc2UoKTsKCQkJd2tvZi5maWxlX2NhY2hlLmRpciA9IHt9OwoJCQlpZiAoZGIgPT09IG51bGwpIHJldHVybiBjbGVhcl9wcm9taXNlLnJlc29sdmUoKTsKCQkJdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oJ2ZpbGVzJywgJ3JlYWR3cml0ZScpOwoJCQl2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgnZmlsZXMnKTsKCQkJc3RvcmUuY2xlYXIoKTsKCQkJdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGNsZWFyX3Byb21pc2UucmVzb2x2ZTsKCQl9Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIERlbGV0ZSBhIGZpbGUgZnJvbSB0aGUgZmlsZV9jYWNoZSBkYXRhYmFzZS4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmaWxlX2NhY2hlX2RlbGV0ZShwYXR0ZXJuKSB7CgkJcmV0dXJuIGZpbGVfY2FjaGVfb3BlbigpLnRoZW4oZGVsKTsKCgkJZnVuY3Rpb24gZGVsKGRiKSB7CgkJCXZhciBkZWxfcHJvbWlzZSA9IHByb21pc2UoKTsKCQkJaWYgKGRiID09PSBudWxsKSByZXR1cm4gZGVsX3Byb21pc2UucmVzb2x2ZSgpOwoJCQl2YXIgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbignZmlsZXMnLCAncmVhZHdyaXRlJyk7CgkJCXZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKCdmaWxlcycpOwoJCQl2YXIgZmlsZXMgPSBPYmplY3Qua2V5cyh3a29mLmZpbGVfY2FjaGUuZGlyKS5maWx0ZXIoZnVuY3Rpb24oZmlsZSl7CgkJCQlpZiAocGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkgewoJCQkJCXJldHVybiBmaWxlLm1hdGNoKHBhdHRlcm4pICE9PSBudWxsOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gKGZpbGUgPT09IHBhdHRlcm4pOwoJCQkJfQoJCQl9KTsKCQkJZmlsZXMuZm9yRWFjaChmdW5jdGlvbihmaWxlKXsKCQkJCXN0b3JlLmRlbGV0ZShmaWxlKTsKCQkJCWRlbGV0ZSB3a29mLmZpbGVfY2FjaGUuZGlyW2ZpbGVdOwoJCQl9KTsKCQkJZmlsZV9jYWNoZV9kaXJfc2F2ZSgpOwoJCQl0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZGVsX3Byb21pc2UucmVzb2x2ZS5iaW5kKG51bGwsIGZpbGVzKTsKCQkJcmV0dXJuIGRlbF9wcm9taXNlOwoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gRm9yY2UgaW1tZWRpYXRlIHNhdmUgb2YgZmlsZV9jYWNoZSBkaXJlY3RvcnkuCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZmlsZV9jYWNoZV9mbHVzaCgpIHsKCQlmaWxlX2NhY2hlX2Rpcl9zYXZlKHRydWUgLyogaW1tZWRpYXRlbHkgKi8pOwoJfQoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBMb2FkIGEgZmlsZSBmcm9tIHRoZSBmaWxlX2NhY2hlIGRhdGFiYXNlLgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZpbGVfY2FjaGVfbG9hZChuYW1lKSB7CgkJdmFyIGxvYWRfcHJvbWlzZSA9IHByb21pc2UoKTsKCQlyZXR1cm4gZmlsZV9jYWNoZV9vcGVuKCkudGhlbihsb2FkKTsKCgkJZnVuY3Rpb24gbG9hZChkYikgewoJCQlpZiAod2tvZi5maWxlX2NhY2hlLmRpcltuYW1lXSA9PT0gdW5kZWZpbmVkKSB7CgkJCQlsb2FkX3Byb21pc2UucmVqZWN0KG5hbWUpOwoJCQkJcmV0dXJuIGxvYWRfcHJvbWlzZTsKCQkJfQoJCQl2YXIgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbignZmlsZXMnLCAncmVhZG9ubHknKTsKCQkJdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoJ2ZpbGVzJyk7CgkJCXZhciByZXF1ZXN0ID0gc3RvcmUuZ2V0KG5hbWUpOwoJCQl3a29mLmZpbGVfY2FjaGUuZGlyW25hbWVdLmxhc3RfbG9hZGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwoJCQlmaWxlX2NhY2hlX2Rpcl9zYXZlKCk7CgkJCXJlcXVlc3Qub25zdWNjZXNzID0gZmluaXNoOwoJCQlyZXF1ZXN0Lm9uZXJyb3IgPSBlcnJvcjsKCQkJcmV0dXJuIGxvYWRfcHJvbWlzZTsKCgkJCWZ1bmN0aW9uIGZpbmlzaChldmVudCl7CgkJCQlpZiAoZXZlbnQudGFyZ2V0LnJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJbG9hZF9wcm9taXNlLnJlamVjdChuYW1lKTsKCQkJCX0gZWxzZSB7CgkJCQkJbG9hZF9wcm9taXNlLnJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdC5jb250ZW50KTsKCQkJCX0KCQkJfQoKCQkJZnVuY3Rpb24gZXJyb3IoZXZlbnQpewoJCQkJbG9hZF9wcm9taXNlLnJlamVjdChuYW1lKTsKCQkJfQoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gU2F2ZSBhIGZpbGUgaW50byB0aGUgZmlsZV9jYWNoZSBkYXRhYmFzZS4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmaWxlX2NhY2hlX3NhdmUobmFtZSwgY29udGVudCwgZXh0cmFfYXR0cmlicykgewoJCXJldHVybiBmaWxlX2NhY2hlX29wZW4oKS50aGVuKHNhdmUpOwoKCQlmdW5jdGlvbiBzYXZlKGRiKSB7CgkJCXZhciBzYXZlX3Byb21pc2UgPSBwcm9taXNlKCk7CgkJCWlmIChkYiA9PT0gbnVsbCkgcmV0dXJuIHNhdmVfcHJvbWlzZS5yZXNvbHZlKG5hbWUpOwoJCQl2YXIgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbignZmlsZXMnLCAncmVhZHdyaXRlJyk7CgkJCXZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKCdmaWxlcycpOwoJCQlzdG9yZS5wdXQoe25hbWU6bmFtZSxjb250ZW50OmNvbnRlbnR9KTsKCQkJdmFyIG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKCQkJd2tvZi5maWxlX2NhY2hlLmRpcltuYW1lXSA9IE9iamVjdC5hc3NpZ24oe2FkZGVkOm5vdywgbGFzdF9sb2FkZWQ6bm93fSwgZXh0cmFfYXR0cmlicyk7CgkJCWZpbGVfY2FjaGVfZGlyX3NhdmUodHJ1ZSAvKiBpbW1lZGlhdGVseSAqLyk7CgkJCXRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBzYXZlX3Byb21pc2UucmVzb2x2ZS5iaW5kKG51bGwsIG5hbWUpOwoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gU2F2ZSBhIHRoZSBmaWxlX2NhY2hlIGRpcmVjdG9yeSBjb250ZW50cy4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgl2YXIgZmNfc3luY190aW1lcjsKCWZ1bmN0aW9uIGZpbGVfY2FjaGVfZGlyX3NhdmUoaW1tZWRpYXRlbHkpIHsKCQlpZiAoZmNfc3luY190aW1lciAhPT0gdW5kZWZpbmVkKSBjbGVhclRpbWVvdXQoZmNfc3luY190aW1lcik7CgkJdmFyIGRlbGF5ID0gKGltbWVkaWF0ZWx5ID8gMCA6IDIwMDApOwoJCWZjX3N5bmNfdGltZXIgPSBzZXRUaW1lb3V0KHNhdmUsIGRlbGF5KTsKCgkJZnVuY3Rpb24gc2F2ZSgpewoJCQlmaWxlX2NhY2hlX29wZW4oKS50aGVuKHNhdmUyKTsKCQl9CgoJCWZ1bmN0aW9uIHNhdmUyKGRiKXsKCQkJZmNfc3luY190aW1lciA9IHVuZGVmaW5lZDsKCQkJdmFyIHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oJ2ZpbGVzJywgJ3JlYWR3cml0ZScpOwoJCQl2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgnZmlsZXMnKTsKCQkJc3RvcmUucHV0KHtuYW1lOidbZGlyXScsY29udGVudDpKU09OLnN0cmluZ2lmeSh3a29mLmZpbGVfY2FjaGUuZGlyKX0pOwoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gUmVtb3ZlIGZpbGVzIHRoYXQgaGF2ZW4ndCBiZWVuIGFjY2Vzc2VkIGluIGEgd2hpbGUuCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZmlsZV9jYWNoZV9jbGVhbnVwKCkgewoJCXZhciB0aHJlc2hvbGQgPSBuZXcgRGF0ZSgpIC0gMTQqODY0MDAwMDA7IC8vIDE0IGRheXMKCQl2YXIgb2xkX2ZpbGVzID0gW107CgkJZm9yICh2YXIgZm5hbWUgaW4gd2tvZi5maWxlX2NhY2hlLmRpcikgewoJCQlpZiAoZm5hbWUubWF0Y2goL153a29mXC5zZXR0aW5nc1wuLykpIGNvbnRpbnVlOyAvLyBEb24ndCBmbHVzaCBzZXR0aW5ncyBmaWxlcy4KCQkJdmFyIGZkYXRlID0gbmV3IERhdGUod2tvZi5maWxlX2NhY2hlLmRpcltmbmFtZV0ubGFzdF9sb2FkZWQpOwoJCQlpZiAoZmRhdGUgPCB0aHJlc2hvbGQpIG9sZF9maWxlcy5wdXNoKGZuYW1lKTsKCQl9CgkJaWYgKG9sZF9maWxlcy5sZW5ndGggPT09IDApIHJldHVybjsKCQljb25zb2xlLmxvZygnQ2xlYW5pbmcgb3V0ICcrb2xkX2ZpbGVzLmxlbmd0aCsnIG9sZCBmaWxlKHMpIGZyb20gIndrb2YuZmlsZV9jYWNoZSI6Jyk7CgkJZm9yICh2YXIgZm51bSBpbiBvbGRfZmlsZXMpIHsKCQkJY29uc29sZS5sb2coJyAgJysoTnVtYmVyKGZudW0pKzEpKyc6ICcrb2xkX2ZpbGVzW2ZudW1dKTsKCQkJd2tvZi5maWxlX2NhY2hlLmRlbGV0ZShvbGRfZmlsZXNbZm51bV0pOwoJCX0KCX0KCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gUHJvY2VzcyBuby1jYWNoZSByZXF1ZXN0cy4KCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmaWxlX25vY2FjaGUobGlzdCkgewoJCWlmIChsaXN0ID09PSB1bmRlZmluZWQpIHsKCQkJbGlzdCA9IHNwbGl0X2xpc3QobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3drb2YuaW5jbHVkZS5ub2NhY2hlJykgfHwgJycpOwoJCQlsaXN0ID0gbGlzdC5jb25jYXQoc3BsaXRfbGlzdChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnd2tvZi5sb2FkX2ZpbGUubm9jYWNoZScpIHx8ICcnKSk7CgkJCWNvbnNvbGUubG9nKGxpc3Quam9pbignLCcpKTsKCQl9IGVsc2UgaWYgKHR5cGVvZiBsaXN0ID09PSAnc3RyaW5nJykgewoJCQl2YXIgbm9fY2FjaGUgPSBzcGxpdF9saXN0KGxpc3QpOwoJCQl2YXIgaWR4LCBtb2R1bGVzID0gW10sIHVybHMgPSBbXTsKCQkJZm9yIChpZHggPSAwOyBpZHggPCBub19jYWNoZS5sZW5ndGg7IGlkeCsrKSB7CgkJCQl2YXIgaXRlbSA9IG5vX2NhY2hlW2lkeF07CgkJCQlpZiAoc3VwcG9ydGVkX21vZHVsZXNbaXRlbV0gIT09IHVuZGVmaW5lZCkgewoJCQkJCW1vZHVsZXMucHVzaChpdGVtKTsKCQkJCX0gZWxzZSB7CgkJCQkJdXJscy5wdXNoKGl0ZW0pOwoJCQkJfQoJCQl9CgkJCWNvbnNvbGUubG9nKCdNb2R1bGVzOiAnK21vZHVsZXMuam9pbignLCcpKTsKCQkJY29uc29sZS5sb2coJyAgIFVSTHM6ICcrdXJscy5qb2luKCcsJykpOwoJCQlsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnd2tvZi5pbmNsdWRlLm5vY2FjaGUnLCBtb2R1bGVzLmpvaW4oJywnKSk7CgkJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCd3a29mLmxvYWRfZmlsZS5ub2NhY2hlJywgdXJscy5qb2luKCcsJykpOwoJCX0KCX0KCglmdW5jdGlvbiBkb2NfcmVhZHkoKSB7CgkJd2tvZi5zZXRfc3RhdGUoJ3drb2YuZG9jdW1lbnQnLCAncmVhZHknKTsKCX0KCgkvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoJLy8gQm9vdGxvYWRlciBTdGFydHVwCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gc3RhcnR1cCgpIHsKCQlnbG9iYWwud2tvZiA9IHB1Ymxpc2hlZF9pbnRlcmZhY2U7CgoJCS8vIE1hcmsgZG9jdW1lbnQgc3RhdGUgYXMgJ3JlYWR5Jy4KCQlpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgewoJCQlkb2NfcmVhZHkoKTsKCQl9IGVsc2UgewoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIGRvY19yZWFkeSwgZmFsc2UpOyAgLy8gTm90aWZ5IGxpc3RlbmVycyB0aGF0IHdlIGFyZSByZWFkeS4KCQl9CgoJCS8vIE9wZW4gY2FjaGUsIHNvIHdrb2YuZmlsZV9jYWNoZS5kaXIgaXMgYXZhaWxhYmxlIHRvIGNvbnNvbGUgaW1tZWRpYXRlbHkuCgkJZmlsZV9jYWNoZV9vcGVuKCk7CgkJd2tvZi5zZXRfc3RhdGUoJ3drb2Yud2tvZicsICdyZWFkeScpOwoJfQoJc3RhcnR1cCgpOwoKfSkod2luZG93KTsK"},{"name":"Bunpro: Auto-show Info","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_prototypes":false,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["*bunpro.jp/study*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":["*community.bunpro.jp*"],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"ts":1645358913898,"data":{}},"enabled":true,"position":2,"file_url":"https://greasyfork.org/scripts/370019-bunpro-auto-show-info/code/Bunpro:%20Auto-show%20Info.user.js","uuid":"a8368bd9-c722-4a1b-b9e7-5e7d630ed838","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBCdW5wcm86IEF1dG8tc2hvdyBJbmZvCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMC4yLjEwCi8vIEBkZXNjcmlwdGlvbiAgQXV0b21hdGljYWxseSBleHBhbmRzIHRoZSBmdWxsIGdyYW1tYXIgaW5mbyB3aGVuIHlvdSBnZXQgYSByZXZpZXcgd3JvbmcuCi8vIEBhdXRob3IgICAgICAgS3VtaXJlaQovLyBAaW5jbHVkZSAgICAgICpidW5wcm8uanAvc3R1ZHkqCi8vIEBleGNsdWRlICAgICAgKmNvbW11bml0eS5idW5wcm8uanAqCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQzMjQxOC13YWl0LWZvci1zZWxlY3Rvci9jb2RlL1dhaXQlMjBGb3IlMjBTZWxlY3Rvci5qcz92ZXJzaW9uPTk5MDIwNwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8zNzA2MjMtYnVucHJvLWhlbHBmdWwtZXZlbnRzL2NvZGUvQnVucHJvOiUyMEhlbHBmdWwlMjBFdmVudHMuanM/dmVyc2lvbj05OTAyMTEKLy8gQGdyYW50ICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKOyhmdW5jdGlvbiAoKSB7CiAgICAvL3dhaXQgdW50aWwgd2UncmUgcmV2aWV3aW5nCiAgICAkKCdIVE1MJylbMF0uYWRkRXZlbnRMaXN0ZW5lcigncXVpei1wYWdlJywgZnVuY3Rpb24gKCkgewogICAgICAgIC8vZG8gc3R1ZmYgd2hlbiB3ZSBwcmVzcyBlbnRlciBhbmQgZ2V0IHRoZSBhbnN3ZXIgd3JvbmcKICAgICAgICAkKCcjc3R1ZHktYW5zd2VyLWlucHV0Jykub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09IDEzKSB7CiAgICAgICAgICAgICAgICBvcGVuSWZXcm9uZygpCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC8vZG8gc3R1ZmYgd2hlbiB3ZSBjbGljayBzdWJtaXQgYW5kIGdldCB0aGUgYW5zd2VyIHdyb25nCiAgICAgICAgJCgnI3N1Ym1pdC1zdHVkeS1hbnN3ZXInKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9wZW5JZldyb25nKCkKICAgICAgICB9KQogICAgfSkKCiAgICAvL29wZW5zIHRoZSBpbmZvIGlmIHlvdSBnZXQgdGhlIGl0ZW0gd3JvbmcKICAgIGZ1bmN0aW9uIG9wZW5JZldyb25nKCkgewogICAgICAgIGlmICgkKCcub29wcy1idXR0b24nKVswXS5zdHlsZS5kaXNwbGF5ID09ICdibG9jaycgfHwgJCgnI2xlYXJuLW5ldy1ncmFtbWFyLXBhZ2UnKS5sZW5ndGgpIHsKICAgICAgICAgICAgJCgnLnNob3ctZ3JhbW1hci10ZXh0JykuY2xpY2soKQogICAgICAgIH0KICAgIH0KfSkoKQo=","requires":[{"meta":{"name":"Wait%20For%20Selector.js","url":"https://greasyfork.org/scripts/432418-wait-for-selector/code/Wait%20For%20Selector.js?version=990207","ts":1647909791721,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBXYWl0IEZvciBTZWxlY3RvcgovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAZGVzY3JpcHRpb24gIFdhaXRzIGZvciBlbGVtZW50cwovLyBAYXV0aG9yICAgICAgIEt1bWlyZWkKLy8gQGluY2x1ZGUgICAgICAqY29tbXVuaXR5LndhbmlrYW5pLmNvbSoKLy8gQGdyYW50ICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQoKOyhmdW5jdGlvbiAod2ZzKSB7CiAgICBsZXQgdmVyc2lvbiA9ICcxLjAuMScKCiAgICAvLyBDcmVhdGUgbmV3IG9ic2VydmVyIG9uIGJvZHkgdG8gbW9uaXRvciBhbGwgRE9NIGNoYW5nZXMKICAgIGxldCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9uSGFuZGxlcikKICAgIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2h0bWwnKVswXSwgeyBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWUgfSkKCiAgICAvLyBJbnRlcmZhY2UgZm9yIGludGVyYWN0aW5nIHdpdGggdGhlIGxpYnJhcnkKICAgIGxldCBpbnRlcmZhY2UgPSB7CiAgICAgICAgdmVyc2lvbiwKICAgICAgICBvYnNlcnZlcjogb2JzZXJ2ZXIsCiAgICAgICAgd2FpdDogd2FpdEZvclNlbGVjdG9yLAogICAgICAgIHVud2FpdDogdW53YWl0SUQsCiAgICAgICAgd2FpdHM6IHt9LAogICAgICAgIHdhaXRzQnlJRDoge30sCiAgICAgICAgbmV4dElEOiAwLAogICAgfQoKICAgIC8vIFN0YXJ0CiAgICBpbnN0YWxsSW50ZXJmYWNlKCkKCiAgICAvLyBDcmVhdGVzIGEgbmV3IGVudHJ5IHRvIHNlYXJjaCBmb3Igd2hlbmV2ZXIgYSBuZXcgZWxlbWVudCBpcyBhZGRlZCB0byB0aGUgRE9NCiAgICBmdW5jdGlvbiB3YWl0Rm9yU2VsZWN0b3Ioc2VsZWN0b3IsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCFpbnRlcmZhY2Uud2FpdHNbc2VsZWN0b3JdKSBpbnRlcmZhY2Uud2FpdHNbc2VsZWN0b3JdID0ge30KICAgICAgICBpbnRlcmZhY2Uud2FpdHNbc2VsZWN0b3JdW2ludGVyZmFjZS5uZXh0SURdID0gY2FsbGJhY2sKICAgICAgICBpbnRlcmZhY2Uud2FpdHNCeUlEW2ludGVyZmFjZS5uZXh0SURdID0gc2VsZWN0b3IKICAgICAgICBzZWFyY2goc2VsZWN0b3IsIHRydWUpCiAgICAgICAgcmV0dXJuIGludGVyZmFjZS5uZXh0SUQrKwogICAgfQoKICAgIC8vIERlbGV0ZXMgYSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgc2VsZWN0b3IKICAgIGZ1bmN0aW9uIHVud2FpdElEKElEKSB7CiAgICAgICAgZGVsZXRlIGludGVyZmFjZS53YWl0c1tpbnRlcmZhY2Uud2FpdHNCeUlEW0lEXV1bSURdCiAgICAgICAgZGVsZXRlIGludGVyZmFjZS53YWl0c0J5SURbSURdCiAgICB9CgogICAgLy8gTWFrZXMgc3VyZSB0aGF0IHRoZSBwdWJsaWMgaW50ZXJmYWNlIGlzIHRoZSBuZXdlc3QgdmVyc2lvbiBhbmQgdGhlIHNhbWUgYXMgdGhlIGxvY2FsIG9uZQogICAgZnVuY3Rpb24gaW5zdGFsbEludGVyZmFjZSgpIHsKICAgICAgICBpZiAoIXdmcykgd2luZG93LndmcyA9IGludGVyZmFjZQogICAgICAgIGVsc2UgaWYgKHdmcy52ZXJzaW9uIDwgaW50ZXJmYWNlLnZlcnNpb24pIHsKICAgICAgICAgICAgd2ZzLnZlcnNpb24gPSBpbnRlcmZhY2UudmVyc2lvbgogICAgICAgICAgICB3ZnMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpCiAgICAgICAgICAgIHdmcy5vYnNlcnZlciA9IGludGVyZmFjZS5vYnNlcnZlcgogICAgICAgICAgICB3ZnMud2FpdCA9IGludGVyZmFjZS53YWl0CiAgICAgICAgICAgIHdmcy51bndhaXQgPSBpbnRlcmZhY2UudW53YWl0CiAgICAgICAgfQogICAgICAgIGludGVyZmFjZSA9IHdmcyB8fCBpbnRlcmZhY2UKICAgIH0KCiAgICAvLyBXYWl0cyB1bnRpbCB0aGVyZSBoYXMgYmVlbiBtb3JlIHRoYW4gMzAwIG1zIGJldHdlZW4gbXV0YXRpb25zIGFuZCB0aGVuIGNoZWNrcyBmb3IgbmV3IGVsZW1lbnRzCiAgICBsZXQgbGFzdE11dGF0aW9uRGF0ZSA9IDAgLy8gRXBvY2ggb2YgbGFzdCBtdXRhdGlvbiBldmVudAogICAgbGV0IHRpbWVvdXRJRCA9IDAKICAgIGZ1bmN0aW9uIG11dGF0aW9uSGFuZGxlcihtdXRhdGlvbnMpIHsKICAgICAgICBsZXQgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gbGFzdE11dGF0aW9uRGF0ZQogICAgICAgIGxhc3RNdXRhdGlvbkRhdGUgPSBEYXRlLm5vdygpCiAgICAgICAgaWYgKGR1cmF0aW9uIDwgMzAwKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SUQpCiAgICAgICAgICAgIHRpbWVvdXRJRCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgZm9yIChsZXQgc2VsZWN0b3IgaW4gaW50ZXJmYWNlLndhaXRzKSBzZWFyY2goc2VsZWN0b3IpCiAgICAgICAgICAgIH0sIDMwMCkKICAgICAgICB9CiAgICB9CgogICAgLy8gU2VhcmNoZXMgZm9yIHRoZSBzZWxlY3RvciBhbmQgY2FsbHMgdGhlIGNhbGxiYWNrIG9uIHRoZSBmb3VuZCBlbGVtZW50cwogICAgZnVuY3Rpb24gc2VhcmNoKHNlbGVjdG9yLCBhbGwgPSBmYWxzZSkgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgICAgICAgbGV0IGNhbGxiYWNrcyA9IE9iamVjdC52YWx1ZXMoaW50ZXJmYWNlLndhaXRzW3NlbGVjdG9yXSkKICAgICAgICAgICAgaWYgKGFsbCB8fCAhZS5XRlNGb3VuZCB8fCBlLldGU0ZvdW5kID09IGxhc3RNdXRhdGlvbkRhdGUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcykgY2FsbGJhY2soZSkKICAgICAgICAgICAgICAgIGUuV0ZTRm91bmQgPSBsYXN0TXV0YXRpb25EYXRlCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfQp9KSh3aW5kb3cud2ZzKQo="},{"meta":{"name":"Bunpro:%20Helpful%20Events.js","url":"https://greasyfork.org/scripts/370623-bunpro-helpful-events/code/Bunpro:%20Helpful%20Events.js?version=990211","ts":1647909791716,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBCdW5wcm86IEhlbHBmdWwgRXZlbnRzCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMS4wLjIKLy8gQGF1dGhvciAgICAgICBLdW1pcmVpCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQzMjQxOC13YWl0LWZvci1zZWxlY3Rvci9jb2RlL1dhaXQlMjBGb3IlMjBTZWxlY3Rvci5qcz92ZXJzaW9uPTk5MDIwNwovLyBAaW5jbHVkZSAgICAgICpidW5wcm8uanAqCi8vIEBleGNsdWRlICAgICAgKmNvbW11bml0eS5idW5wcm8uanAqCi8vID09L1VzZXJTY3JpcHQ9PQoKOyhmdW5jdGlvbiAod2ZzKSB7CiAgICAvLyBBZGQgYSBjdXN0b20gZXZlbnQgZm9yIHdoZW4gQlAgY3JlYXRlcyBhIG5ldyBib2R5CiAgICB2YXIgbmV3Qm9keSA9IG5ldyBFdmVudCgnbmV3LWJvZHknKQogICAgd2ZzLndhaXQoJ2JvZHkgPiBoZWFkZXInLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZpcmVFdmVudChuZXdCb2R5KQogICAgfSkKCiAgICAvLyBBZGQgYSBjdXN0b20gZXZlbnQgZm9yIHdoZW4geW91IGdldCBhIG5ldyBpdGVtIGluIHJldmlld3MKICAgIHZhciBuZXdSZXZpZXdJdGVtID0gbmV3IEV2ZW50KCduZXctcmV2aWV3LWl0ZW0nKQogICAgd2ZzLndhaXQoJy5sZXZlbF9sZXNzb25faW5mbyBhJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBmaXJlRXZlbnQobmV3UmV2aWV3SXRlbSkKICAgIH0pCgogICAgLy8gQWRkIGEgY3VzdG9tIGV2ZW50IHdoZW4geW91IGdvIHRvIHN0dWR5IG9yIGNyYW0gcGFnZQogICAgdmFyIHF1aXpQYWdlID0gbmV3IEV2ZW50KCdxdWl6LXBhZ2UnKQogICAgd2ZzLndhaXQoJyNzaG93LWdyYW1tYXInLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZpcmVFdmVudChxdWl6UGFnZSkKICAgIH0pCgogICAgLy8gQWRkIGEgY3VzdG9tIGV2ZW50IHdoZW4geW91IGdvIHRvIHN0dWR5IHBhZ2UKICAgIHZhciBzdHVkeVBhZ2UgPSBuZXcgRXZlbnQoJ3N0dWR5LXBhZ2UnKQogICAgd2ZzLndhaXQoJyNzdHVkeS1wYWdlICNzaG93LWdyYW1tYXInLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZpcmVFdmVudChzdHVkeVBhZ2UpCiAgICB9KQoKICAgIC8vIEFkZCBhIGN1c3RvbSBldmVudCB3aGVuIHlvdSBnbyB0byBjcmFtIHBhZ2UKICAgIHZhciBjcmFtUGFnZSA9IG5ldyBFdmVudCgnY3JhbS1wYWdlJykKICAgIHdmcy53YWl0KCcjY3JhbS1wYWdlICNzaG93LWdyYW1tYXInLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGZpcmVFdmVudChjcmFtUGFnZSkKICAgIH0pCgogICAgLy8gRmlyZXMgdGhlIGdpdmVuIGV2ZW50IG9uIHRoZSBIVE1MIGVsZW1lbnQKICAgIGZ1bmN0aW9uIGZpcmVFdmVudChldmVudCkgewogICAgICAgIHZhciByZXRyeUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7CiAgICAgICAgICAgICAgICAkKCdIVE1MJylbMF0uZGlzcGF0Y2hFdmVudChldmVudCkKICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwocmV0cnlJbnRlcnZhbCkKICAgICAgICAgICAgfQogICAgICAgIH0sIDEwMCkKICAgIH0KfSkod2luZG93LndmcykK"}]},{"name":"Wanikani Heatmap","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_prototypes":false,"noframes":null,"run_at":null,"override":{"use_includes":[],"orig_includes":["/^https://(www|preview).wanikani.com/(dashboard)?$/"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_connects":[]},"tab_types":null},"storage":{"ts":1645589526382,"data":{}},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/377336-wanikani-heatmap/code/Wanikani%20Heatmap.user.js","uuid":"42a2e87a-eb2d-476a-9416-923b7458b301","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBXYW5pa2FuaSBIZWF0bWFwCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMy4wLjQ3Ci8vIEBkZXNjcmlwdGlvbiAgQWRkcyByZXZpZXcgYW5kIGxlc3NvbiBoZWF0bWFwcyB0byB0aGUgZGFzaGJvYXJkLgovLyBAYXV0aG9yICAgICAgIEt1bWlyZWkKLy8gQGluY2x1ZGUgICAgICAvXmh0dHBzOi8vKHd3d3xwcmV2aWV3KS53YW5pa2FuaS5jb20vKGRhc2hib2FyZCk/JC8KLy8gQHJlcXVpcmUgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvNDEwOTA5LXdhbmlrYW5pLXJldmlldy1jYWNoZS9jb2RlL1dhbmlrYW5pOiUyMFJldmlldyUyMENhY2hlLmpzP3ZlcnNpb249OTUyNTU2Ci8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzQxMDkxMC1oZWF0bWFwL2NvZGUvSGVhdG1hcC5qcz92ZXJzaW9uPTg4ODI0NAovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09Cgo7KGZ1bmN0aW9uICh3a29mLCByZXZpZXdfY2FjaGUsIEhlYXRtYXApIHsKICAgIGNvbnN0IENTU19DT01NSVQgPSAnZjJhNTdkMTZmMTI0YzcyOWFjMTNjZmJhZmUyNzc2YTc5NDhkNmQ5NicKICAgIGxldCBtc2ggPSA2MCAqIDYwICogMTAwMCwKICAgICAgICBtc2QgPSAyNCAqIG1zaCAvLyBNaWxsaXNlY29uZHMgaW4gaG91ciBhbmQgZGF5CgogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgICAvLyBNYWtlIHN1cmUgV0tPRiBpcyBpbnN0YWxsZWQKICAgIGxldCBzY3JpcHRfaWQgPSAnaGVhdG1hcDMnCiAgICBsZXQgc2NyaXB0X25hbWUgPSAnV2FuaWthbmkgSGVhdG1hcCcKICAgIGlmICghd2tvZikgewogICAgICAgIGxldCByZXNwb25zZSA9IGNvbmZpcm0oCiAgICAgICAgICAgIHNjcmlwdF9uYW1lICsKICAgICAgICAgICAgICAgICcgcmVxdWlyZXMgV2FuaUthbmkgT3BlbiBGcmFtZXdvcmsuXG4gQ2xpY2sgIk9LIiB0byBiZSBmb3J3YXJkZWQgdG8gaW5zdGFsbGF0aW9uIGluc3RydWN0aW9ucy4nLAogICAgICAgICkKICAgICAgICBpZiAocmVzcG9uc2UpCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0KICAgICAgICAgICAgICAgICdodHRwczovL2NvbW11bml0eS53YW5pa2FuaS5jb20vdC9pbnN0cnVjdGlvbnMtaW5zdGFsbGluZy13YW5pa2FuaS1vcGVuLWZyYW1ld29yay8yODU0OScKICAgICAgICByZXR1cm4KICAgIH0KCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAgIGxldCByZWxvYWQgLy8gRnVuY3Rpb24gdG8gcmVsb2FkIHRoZSBoZWF0bWFwCgogICAgLy8gV2FpdCB1bnRpbCBtb2R1bGVzIGFyZSByZWFkeSB0aGVuIGluaXRpYXRlIHNjcmlwdAogICAgd2tvZi5pbmNsdWRlKCdNZW51LFNldHRpbmdzLEl0ZW1EYXRhLEFwaXYyJykKICAgIHdrb2YucmVhZHkoJ01lbnUsU2V0dGluZ3MsSXRlbURhdGEsQXBpdjInKS50aGVuKGxvYWRfc2V0dGluZ3MpLnRoZW4obG9hZF9jc3MpLnRoZW4oaW5zdGFsbF9tZW51KS50aGVuKGluaXRpYXRlKQoKICAgIC8vIEZldGNoIG5lY2Vzc2FyeSBkYXRhIHRoZW4gaW5zdGFsbCB0aGUgaGVhdG1hcAogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhdGUoKSB7CiAgICAgICAgLy8gRmV0Y2ggZGF0YQogICAgICAgIGxldCBbcmV2aWV3cywgaXRlbXNdID0gYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICByZXZpZXdfY2FjaGUuZ2V0X3Jldmlld3MoKSwKICAgICAgICAgICAgd2tvZi5JdGVtRGF0YS5nZXRfaXRlbXMoJ2Fzc2lnbm1lbnRzLGluY2x1ZGVfaGlkZGVuJyksCiAgICAgICAgXSkKICAgICAgICBsZXQgW2ZvcmVjYXN0LCBsZXNzb25zXSA9IGdldF9mb3JlY2FzdF9hbmRfbGVzc29ucyhpdGVtcykKICAgICAgICBpZiAod2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLmxlc3NvbnMucmVjb3Zlcl9sZXNzb25zKSB7CiAgICAgICAgICAgIGxldCByZWNvdmVyZWRfbGVzc29ucyA9IGF3YWl0IGdldF9yZWNvdmVyZWRfbGVzc29ucyhpdGVtcywgcmV2aWV3cywgbGVzc29ucykKICAgICAgICAgICAgbGVzc29ucyA9IGxlc3NvbnMuY29uY2F0KHJlY292ZXJlZF9sZXNzb25zKS5zb3J0KChhLCBiKSA9PiAoYVswXSA8IGJbMF0gPyAtMSA6IDEpKQogICAgICAgIH0KICAgICAgICAvLyBDcmVhdGUgaGVhdG1hcAogICAgICAgIHJlbG9hZCA9IGZ1bmN0aW9uIChuZXdfcmV2aWV3cyA9IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIElmIHN0YXJ0IGRhdGUgaXMgaW52YWxpZCwgc2V0IGl0IHRvIHRoZSBkZWZhdWx0CiAgICAgICAgICAgIGlmIChpc05hTihEYXRlLnBhcnNlKHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5nZW5lcmFsLnN0YXJ0X2RhdGUpKSkKICAgICAgICAgICAgICAgIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5nZW5lcmFsLnN0YXJ0X2RhdGUgPSAnMjAxMi0wMS0wMScKICAgICAgICAgICAgLy8gR2V0IGEgdGltZXN0YW1wIGZvciB0aGUgc3RhcnQgZGF0ZQogICAgICAgICAgICB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0uZ2VuZXJhbC5zdGFydF9kYXkgPQogICAgICAgICAgICAgICAgbmV3IERhdGUod2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLmdlbmVyYWwuc3RhcnRfZGF0ZSkgLQogICAgICAgICAgICAgICAgLW5ldyBEYXRlKHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5nZW5lcmFsLnN0YXJ0X2RhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MCAqIDEwMDAKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBNYWtlIHNldHRpbmdzIGRpYWxvZyByZXNwb25kIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICBsZXQgc3RhdHMgPSB7CiAgICAgICAgICAgICAgICAgICAgcmV2aWV3czogY2FsY3VsYXRlX3N0YXRzKCdyZXZpZXdzJywgcmV2aWV3cyksCiAgICAgICAgICAgICAgICAgICAgbGVzc29uczogY2FsY3VsYXRlX3N0YXRzKCdsZXNzb25zJywgbGVzc29ucyksCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhdXRvX3JhbmdlKHN0YXRzLCBmb3JlY2FzdCkKICAgICAgICAgICAgICAgIGluc3RhbGxfaGVhdG1hcChyZXZpZXdzLCBmb3JlY2FzdCwgbGVzc29ucywgc3RhdHMsIGl0ZW1zKQogICAgICAgICAgICB9LCAwKQogICAgICAgIH0KICAgICAgICByZWxvYWQoKQogICAgfQoKICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogICAgLy8gTG9hZCBzZXR0aW5ncyBmcm9tIFdLT0YKICAgIGZ1bmN0aW9uIGxvYWRfc2V0dGluZ3MoKSB7CiAgICAgICAgbGV0IGRlZmF1bHRzID0gewogICAgICAgICAgICBnZW5lcmFsOiB7CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiAnMjAxMi0wMS0wMScsCiAgICAgICAgICAgICAgICB3ZWVrX3N0YXJ0OiAwLAogICAgICAgICAgICAgICAgZGF5X3N0YXJ0OiAwLAogICAgICAgICAgICAgICAgcmV2ZXJzZV95ZWFyczogZmFsc2UsCiAgICAgICAgICAgICAgICBzZWdtZW50X3llYXJzOiB0cnVlLAogICAgICAgICAgICAgICAgemVyb19nYXA6IGZhbHNlLAogICAgICAgICAgICAgICAgbW9udGhfbGFiZWxzOiAnYWxsJywKICAgICAgICAgICAgICAgIGRheV9sYWJlbHM6IHRydWUsCiAgICAgICAgICAgICAgICBzZXNzaW9uX2xpbWl0OiAxMCwKICAgICAgICAgICAgICAgIG5vd19pbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICBjb2xvcl9ub3dfaW5kaWNhdG9yOiAnI2ZmMDAwMCcsCiAgICAgICAgICAgICAgICBsZXZlbF9pbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICBjb2xvcl9sZXZlbF9pbmRpY2F0b3I6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAyLAogICAgICAgICAgICAgICAgdGhlbWU6ICdkYXJrJywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmV2aWV3czogewogICAgICAgICAgICAgICAgZ3JhZGllbnQ6IGZhbHNlLAogICAgICAgICAgICAgICAgYXV0b19yYW5nZTogdHJ1ZSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGVzc29uczogewogICAgICAgICAgICAgICAgZ3JhZGllbnQ6IGZhbHNlLAogICAgICAgICAgICAgICAgYXV0b19yYW5nZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvdW50X3plcm9zOiBmYWxzZSwKICAgICAgICAgICAgICAgIHJlY292ZXJfbGVzc29uczogZmFsc2UsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcmVjYXN0OiB7CiAgICAgICAgICAgICAgICBncmFkaWVudDogZmFsc2UsCiAgICAgICAgICAgICAgICBhdXRvX3JhbmdlOiB0cnVlLAogICAgICAgICAgICB9LAogICAgICAgICAgICBvdGhlcjogewogICAgICAgICAgICAgICAgdmlzaWJsZV95ZWFyczogeyByZXZpZXdzOiB7fSwgbGVzc29uczoge30gfSwKICAgICAgICAgICAgICAgIHZpc2libGVfbWFwOiAncmV2aWV3cycsCiAgICAgICAgICAgICAgICB0aW1lc19wb3BwZWQ6IDAsCiAgICAgICAgICAgICAgICB0aW1lc19kcmFnZ2VkOiAwLAogICAgICAgICAgICAgICAgcG9ydGVkOiBmYWxzZSwKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdrb2YuU2V0dGluZ3MubG9hZChzY3JpcHRfaWQsIGRlZmF1bHRzKS50aGVuKChzZXR0aW5ncykgPT4gewogICAgICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBkZWZhdWx0cyBtb2RpZnlpbmcgZXhpc3Rpbmcgc2V0dGluZ3MKICAgICAgICAgICAgaWYgKCFzZXR0aW5ncy5yZXZpZXdzLmNvbG9ycykKICAgICAgICAgICAgICAgIHNldHRpbmdzLnJldmlld3MuY29sb3JzID0gWwogICAgICAgICAgICAgICAgICAgIFswLCAnIzc0NzQ3NCddLAogICAgICAgICAgICAgICAgICAgIFsxLCAnI2FkZTRmZiddLAogICAgICAgICAgICAgICAgICAgIFsxMDAsICcjODJjNWU2J10sCiAgICAgICAgICAgICAgICAgICAgWzIwMCwgJyM1N2E1Y2MnXSwKICAgICAgICAgICAgICAgICAgICBbMzAwLCAnIzJiODZiMyddLAogICAgICAgICAgICAgICAgICAgIFs0MDAsICcjMDA2Njk5J10sCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIGlmICghc2V0dGluZ3MubGVzc29ucy5jb2xvcnMpCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5sZXNzb25zLmNvbG9ycyA9IFsKICAgICAgICAgICAgICAgICAgICBbMCwgJyM3NDc0NzQnXSwKICAgICAgICAgICAgICAgICAgICBbMSwgJyNmZjhhYTEnXSwKICAgICAgICAgICAgICAgICAgICBbMTAwLCAnI2U0NmU5ZSddLAogICAgICAgICAgICAgICAgICAgIFsyMDAsICcjYzg1MzlhJ10sCiAgICAgICAgICAgICAgICAgICAgWzMwMCwgJyNhZDM3OTcnXSwKICAgICAgICAgICAgICAgICAgICBbNDAwLCAnIzkxMWI5MyddLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICBpZiAoIXNldHRpbmdzLmZvcmVjYXN0LmNvbG9ycykKICAgICAgICAgICAgICAgIHNldHRpbmdzLmZvcmVjYXN0LmNvbG9ycyA9IFsKICAgICAgICAgICAgICAgICAgICBbMCwgJyM3NDc0NzQnXSwKICAgICAgICAgICAgICAgICAgICBbMSwgJyNhYWFhYWEnXSwKICAgICAgICAgICAgICAgICAgICBbMTAwLCAnI2JmYmZiZiddLAogICAgICAgICAgICAgICAgICAgIFsyMDAsICcjZDVkNWQ1J10sCiAgICAgICAgICAgICAgICAgICAgWzMwMCwgJyNlYWVhZWEnXSwKICAgICAgICAgICAgICAgICAgICBbNDAwLCAnI2ZmZmZmZiddLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAvLyBMb2FkIHNldHRpbmdzIGZyb20gb2xkIHNjcmlwdCBpZiBwb3NzaWJsZQogICAgICAgICAgICBpZiAoIXNldHRpbmdzLm90aGVyLnBvcnRlZCkgcG9ydF9zZXR0aW5ncyhzZXR0aW5ncykKICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGN1cnJlbnQgeWVhciBpcyB2aXNpYmxlCiAgICAgICAgICAgIGZvciAobGV0IHR5cGUgb2YgWydyZXZpZXdzJywgJ2xlc3NvbnMnXSkgewogICAgICAgICAgICAgICAgd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLm90aGVyLnZpc2libGVfeWVhcnNbdHlwZV1bbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpXSA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICB3a29mLlNldHRpbmdzLnNhdmUoc2NyaXB0X2lkKQogICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MKICAgICAgICB9KQogICAgfQoKICAgIC8vIExvYWRzIGhlYXRtYXAgYW5kIGpRdWVyeSBkYXRlcGlja2VyIENTUwogICAgZnVuY3Rpb24gbG9hZF9jc3MoKSB7CiAgICAgICAgLy8gSGVhdG1hcCBDU1MKICAgICAgICBjb25zdCBoZWF0bWFwUmVwbyA9IGAvL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS3VtaXJlaS9Vc2Vyc2NyaXB0cy8ke0NTU19DT01NSVR9L1dhbmlrYW5pL0hlYXRtYXBgCiAgICAgICAgd2tvZi5sb2FkX2NzcyhgJHtoZWF0bWFwUmVwb30vSGVhdG1hcC9IZWF0bWFwLmNzc2AsIHRydWUpCiAgICAgICAgd2tvZi5sb2FkX2NzcyhgJHtoZWF0bWFwUmVwb30vaGVhdG1hcDMuY3NzYCwgdHJ1ZSkKICAgIH0KCiAgICAvLyBJbnN0YWxscyB0aGUgc2V0dGluZ3MgYnV0dG9uIGluIHRoZSBtZW51CiAgICBmdW5jdGlvbiBpbnN0YWxsX21lbnUoKSB7CiAgICAgICAgbGV0IGNvbmZpZyA9IHsKICAgICAgICAgICAgbmFtZTogc2NyaXB0X2lkLAogICAgICAgICAgICBzdWJtZW51OiAnU2V0dGluZ3MnLAogICAgICAgICAgICB0aXRsZTogJ0hlYXRtYXAnLAogICAgICAgICAgICBvbl9jbGljazogb3Blbl9zZXR0aW5ncywKICAgICAgICB9CiAgICAgICAgd2tvZi5NZW51Lmluc2VydF9zY3JpcHRfbGluayhjb25maWcpCiAgICB9CgogICAgLy8gQWRkIHN0dWZmIHRvIHRoZSBzZXR0aW5ncyBkaWFsb2cgYmVmb3JlIG9wZW5pbmcKICAgIGxldCBhcHBsaWVkIC8vIEtlZXBzIHRyYWNrIG9mIHdoZXRoZXIgdGhlIHNldHRpbmdzIGhhdmUgYmVlbiBhcHBsaWVkCiAgICBmdW5jdGlvbiBtb2RpZnlfc2V0dGluZ3MoZGlhbG9nKSB7CiAgICAgICAgLy8gTWFrZSBzdGFydC1kYXRlIGEgalF1ZXJ5IGRhdGVwaWNrZXIKICAgICAgICAvL3dpbmRvdy5qUXVlcnkoZGlhbG9nWzBdLnF1ZXJ5U2VsZWN0b3IoJyMnK3NjcmlwdF9pZCsnX3N0YXJ0X2RhdGUnKSkuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogInl5LW1tLWRkIixjaGFuZ2VZZWFyOiB0cnVlLHllYXJSYW5nZTogIjIwMTI6KzAifSk7CiAgICAgICAgLy8gQWRkIGFwcGx5IGJ1dHRvbgogICAgICAgIGFwcGxpZWQgPSBmYWxzZQogICAgICAgIGxldCBhcHBseSA9IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsCiAgICAgICAgICAgIGNsYXNzOiAndWktYnV0dG9uIHVpLWNvcm5lci1hbGwgdWktd2lkZ2V0JywKICAgICAgICAgICAgY2hpbGQ6ICdBcHBseScsCiAgICAgICAgICAgIG9uY2xpY2s6IChlKSA9PiB7CiAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZQogICAgICAgICAgICAgICAgcmVsb2FkKCkKICAgICAgICAgICAgfSwKICAgICAgICB9KQogICAgICAgIGRpYWxvZ1swXS5uZXh0RWxlbWVudFNpYmxpbmcKICAgICAgICAgICAgLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3VpLWRpYWxvZy1idXR0b25zZXQnKVswXQogICAgICAgICAgICAuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgYXBwbHkpCiAgICAgICAgLy8gVXBkYXRlcyB0aGUgY29sb3IgbGFiZWxzIHdpdGggbmV3IGhleCB2YWx1ZXMKICAgICAgICBsZXQgdXBkYXRlX2xhYmVsID0gZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIGlmICghaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nKQogICAgICAgICAgICAgICAgaW5wdXQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KAogICAgICAgICAgICAgICAgICAgICdhZnRlcmVuZCcsCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdjb2xvci1sYWJlbCcsIGNoaWxkOiBpbnB1dC52YWx1ZSB9KSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZSBpbnB1dC5uZXh0RWxlbWVudFNpYmxpbmcuaW5uZXJUZXh0ID0gaW5wdXQudmFsdWUKICAgICAgICAgICAgaWYgKCFNYXRoLnJvdW5kKGhleF90b19yZ2IoaW5wdXQudmFsdWUpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIgLyAzLCAwKSAvIDI1NSAtIDAuMTUpKQogICAgICAgICAgICAgICAgaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5yZW1vdmUoJ2xpZ2h0LWNvbG9yJykKICAgICAgICAgICAgZWxzZSBpbnB1dC5uZXh0RWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LmFkZCgnbGlnaHQtY29sb3InKQogICAgICAgIH0KICAgICAgICAvLyBBZGQgY29sb3Igc2V0dGluZ3MKICAgICAgICBkaWFsb2dbMF0KICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJyMnICsgc2NyaXB0X2lkICsgJ19nZW5lcmFsIH4gZGl2IC53a29mX2dyb3VwID4gZGl2Om50aC1vZi10eXBlKDIpJykKICAgICAgICAgICAgLmZvckVhY2goKGVsZW0sIGkpID0+IHsKICAgICAgICAgICAgICAgIGxldCB0eXBlID0gWydyZXZpZXdzJywgJ2xlc3NvbnMnLCAnZm9yZWNhc3QnXVtpXQogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzZXR0aW5ncyBvYmplY3Qgd2l0aCBkYXRhIGZyb20gdGhlIHNldHRpbmdzIGRpYWxvZwogICAgICAgICAgICAgICAgbGV0IHVwZGF0ZV9jb2xvcl9zZXR0aW5ncyA9IChfKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdW3R5cGVdLmNvbG9ycyA9IFtdCiAgICAgICAgICAgICAgICAgICAgZWxlbS5uZXh0RWxlbWVudFNpYmxpbmcuY2hpbGRyZW5bMV0uY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdW3R5cGVdLmNvbG9ycy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0udmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIENyZWF0ZXMgYSBuZXcgaW50ZXJ2YWwgc2V0dGluZwogICAgICAgICAgICAgICAgbGV0IGNyZWF0ZV9yb3cgPSAodmFsdWUsIGNvbG9yKSA9PgogICAgICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiAncm93JywKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkOiBjcmVhdGVfZWxlbSh7IHR5cGU6ICdpbnB1dCcsIGlucHV0OiAnbnVtYmVyJywgdmFsdWU6IHZhbHVlIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdjb2xvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQ6IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2lucHV0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6ICdjb2xvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjb2xvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IChlKSA9PiBlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChfKSA9PiB1cGRhdGVfbGFiZWwoZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoZSkgPT4gdXBkYXRlX2xhYmVsKGUuY2hpbGRyZW5bMF0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdkZWxldGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkOiBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdidXR0b24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuY2xvc2VzdCgnLnJvdycpLnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfY29sb3Jfc2V0dGluZ3MoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDogY3JlYXRlX2VsZW0oeyB0eXBlOiAnaScsIGNsYXNzOiAnZmEgZmEtdHJhc2gnIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIENyZWF0ZXMgdGhlIGludGVyZmFjZSBmb3IgY29sb3Igc2V0dGluZ3MKICAgICAgICAgICAgICAgIGxldCBwYW5lbCA9IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JywKICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3JpZ2h0JywKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnYWRkZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljazogKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmcuYXBwZW5kKGNyZWF0ZV9yb3coMCwgJyNmZmZmZmYnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfY29sb3Jfc2V0dGluZ3MoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkOiAnQWRkIGludGVydmFsJywKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAncm93IHBhbmVsJyB9KSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc2V0dGluZ3Mgd2hlbiB0aGV5IGNoYW5nZQogICAgICAgICAgICAgICAgcGFuZWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlX2NvbG9yX3NldHRpbmdzKQogICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBleGlzdGluZyBzZXR0aW5ncwogICAgICAgICAgICAgICAgZm9yIChsZXQgW3ZhbHVlLCBjb2xvcl0gb2Ygd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdW3R5cGVdLmNvbG9ycykKICAgICAgICAgICAgICAgICAgICBwYW5lbC5jaGlsZHJlblsxXS5hcHBlbmQoY3JlYXRlX3Jvdyh2YWx1ZSwgY29sb3IpKQogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgcmV2aWV3cyBhbmQgZm9yZWNhc3QgaGF2ZSB0aGUgc2FtZSB6ZXJvLWNvbG9yCiAgICAgICAgICAgICAgICBpZiAoaSA9PSAwIHx8IGkgPT0gMikKICAgICAgICAgICAgICAgICAgICBwYW5lbC5jaGlsZHJlblsxXS5jaGlsZHJlblswXS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSBlLnRhcmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoJyMnICsgc2NyaXB0X2lkICsgJ190YWJzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcjJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdF9pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdfJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpID09IDAgPyAnZm9yZWNhc3QnIDogJ3Jldmlld3MnKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgLnBhbmVsID4gLnJvdzpmaXJzdC1jaGlsZCAuY29sb3IgaW5wdXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWUgIT0gZS50YXJnZXQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gZS50YXJnZXQudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXVtpID09IDAgPyAnZm9yZWNhc3QnIDogJ3Jldmlld3MnXS5jb2xvcnNbMF1bMV0gPSBlLnRhcmdldC52YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIEluc3RhbGwKICAgICAgICAgICAgICAgIGVsZW0uaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmVuZCcsIHBhbmVsKQogICAgICAgICAgICB9KQogICAgICAgIC8vIERpc2FibGUgdGhlIGZpcnN0IGludGVydmFsJ3MgYm91bmQgaW5wdXQgc28gdGhhdCBpdCBjYW4ndCBiZSBjaGFuZ2VkIGZyb20gMAogICAgICAgIGRpYWxvZ1swXQogICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnIycgKyBzY3JpcHRfaWQgKyAnX2dlbmVyYWwgfiBkaXYgLnBhbmVsIC5yb3c6Zmlyc3QtY2hpbGQgLnRleHQgaW5wdXQnKQogICAgICAgICAgICAuZm9yRWFjaCgoZWxlbSkgPT4gKGVsZW0uZGlzYWJsZWQgPSB0cnVlKSkKICAgICAgICAvLyBBZGQgbGFiZWxzIHRvIGFsbCBjb2xvciBpbnB1dHMKICAgICAgICBkaWFsb2dbMF0ucXVlcnlTZWxlY3RvckFsbCgnIycgKyBzY3JpcHRfaWQgKyAnX2dlbmVyYWwgaW5wdXRbdHlwZT0iY29sb3IiXScpLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHVwZGF0ZV9sYWJlbChpbnB1dCkpCiAgICAgICAgICAgIHVwZGF0ZV9sYWJlbChpbnB1dCkKICAgICAgICB9KQogICAgfQoKICAgIC8vIE9wZW4gdGhlIHNldHRpbmdzIGRpYWxvZwogICAgZnVuY3Rpb24gb3Blbl9zZXR0aW5ncygpIHsKICAgICAgICBsZXQgY29uZmlnID0gewogICAgICAgICAgICBzY3JpcHRfaWQ6IHNjcmlwdF9pZCwKICAgICAgICAgICAgdGl0bGU6ICdIZWF0bWFwJywKICAgICAgICAgICAgb25fc2F2ZTogKF8pID0+IChhcHBsaWVkID0gdHJ1ZSksCiAgICAgICAgICAgIG9uX2Nsb3NlOiByZWxvYWRfb25fY2hhbmdlLAogICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICB0YWJzOiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RhYnNldCcsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogewogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmFsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGFnZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0dlbmVyYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnU2V0dGluZ3MgcGVydGFpbmluZyB0byB0aGUgZ2VuZXJhbCBmdW5jdGlvbnMgb2YgdGhlIHNjcmlwdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JvdXAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbnRyb2wnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkcm9wZG93bicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdQb3NpdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdXaGVyZSBvbiB0aGUgZGFzaGJvYXJkIHRvIGluc3RhbGwgdGhlIGhlYXRtYXAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMDogJ1RvcCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE6ICdCZWxvdyBmb3JlY2FzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDI6ICdCZWxvdyBTUlMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzOiAnQmVsb3cgcGFuZWxzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNDogJ0JvdHRvbScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwucG9zaXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW5wdXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnR5cGU6ICdkYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1N0YXJ0IGRhdGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICcyMDEyLTAxLTAxJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdBbGwgZGF0YSBiZWZvcmUgdGhpcyBkYXRlIHdpbGwgYmUgaWdub3JlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ0BnZW5lcmFsLnN0YXJ0X2RhdGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlZWtfc3RhcnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZHJvcGRvd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnRmlyc3QgZGF5IG9mIHRoZSB3ZWVrJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ0RldGVybWluZXMgd2hpY2ggZGF5IG9mIHRoZSB3ZWVrIGlzIGF0IHRoZSB0b3Agb2YgdGhlIGhlYXRtYXBzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDA6ICdNb25kYXknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxOiAnVHVlc2RheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDI6ICdXZWRuZXNkYXknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzOiAnVGh1cnNkYXknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA0OiAnRnJpZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNTogJ1NhdHVyZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNjogJ1N1bmRheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwud2Vla19zdGFydCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5X3N0YXJ0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ251bWJlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdOZXcgZGF5IHN0YXJ0cyBhdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJyhob3VycyBhZnRlciBtaWRuaWdodCknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ09mZnNldCBmb3IgdGhvc2Ugd2hvIHRlbmQgdG8gc3RheSB1cCBhZnRlciBtaWRuaWdodC4gSWYgeW91IHdhbnQgdGhlIG5ldyBkYXkgdG8gc3RhcnQgYXQgNCBBTSwgaW5wdXQgNC4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdAZ2VuZXJhbC5kYXlfc3RhcnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25fbGltaXQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1Nlc3Npb24gdGltZSBsaW1pdCAobWludXRlcyknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnKG1pbnV0ZXMpJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdNYXggbnVtYmVyIG9mIG1pbnV0ZXMgYmV0d2VlbiByZXZpZXcvbGVzc29uIGl0ZW1zIHRvIHN0aWxsIGNvdW50IHdpdGhpbiB0aGUgc2FtZSBzZXNzaW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuc2Vzc2lvbl9saW1pdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZHJvcGRvd24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVGhlbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICdkYXJrJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdDaGFuZ2VzIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIGFuZCBvdGhlciB0aGluZ3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHsgbGlnaHQ6ICdMaWdodCcsIGRhcms6ICdEYXJrJywgJ2JyZWV6ZS1kYXJrJzogJ0JyZWV6ZSBEYXJrJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdAZ2VuZXJhbC50aGVtZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdncm91cCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTGF5b3V0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZV95ZWFyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdSZXZlcnNlIHllYXIgb3JkZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ1B1dHMgdGhlIG1vc3QgcmVjZW50IHllYXJzIG9uIHRoZSBib3R0b20gaW5zdGVhZCBvZiB0aGUgdG9wJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwucmV2ZXJzZV95ZWFycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudF95ZWFyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdTZWdtZW50IHllYXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnUHV0IGEgZ2FwIGJldHdlZW4gbW9udGhzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuc2VnbWVudF95ZWFycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgemVyb19nYXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTm8gZ2FwJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6IGBEb24ndCBkaXNwbGF5IGFueSBnYXAgYmV0d2VlbiBkYXlzYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuemVyb19nYXAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheV9sYWJlbHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnRGF5IG9mIHdlZWsgbGFiZWxzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FkZHMgbGV0dGVycyB0byB0aGUgbGVmdCBvZiB0aGUgaGVhdG1hcHMgaW5kaWNhdGluZyB3aGljaCByb3cgcmVwcmVzZW50cyB3aGljaCB3ZWVrZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuZGF5X2xhYmVscycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhfbGFiZWxzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Ryb3Bkb3duJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ01vbnRoIGxhYmVscycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogJ2FsbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnRGlzcGxheSBtb250aCBsYWJlbHMgYWJvdmUgZWFjaCBtb250aCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogeyBhbGw6ICdBbGwnLCB0b3A6ICdPbmx5IGF0IHRoZSB0b3AnLCBub25lOiAnTm9uZScgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwubW9udGhfbGFiZWxzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdncm91cCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnSW5kaWNhdG9ycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vd19pbmRpY2F0b3I6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQ3VycmVudCBkYXkgaW5kaWNhdG9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ1B1dHMgYSBib3JkZXIgYXJvdW5kIHRoZSBjdXJyZW50IGRheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ0BnZW5lcmFsLm5vd19pbmRpY2F0b3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsX2luZGljYXRvcjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMZXZlbC11cCBpbmRpY2F0b3JzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ1B1dHMgYm9yZGVycyBhcm91bmQgdGhlIGRheXMgb24gd2hpY2ggeW91IGxldmVsZWQgdXAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdAZ2VuZXJhbC5sZXZlbF9pbmRpY2F0b3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yX25vd19pbmRpY2F0b3I6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29sb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQ29sb3IgZm9yIGN1cnJlbnQgZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdUaGUgYm9yZGVyIGFyb3VuZCB0aGUgY3VycmVudCBkYXkgd2lsbCBoYXZlIHRoaXMgY29sb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICcjZmYwMDAwJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuY29sb3Jfbm93X2luZGljYXRvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JfbGV2ZWxfaW5kaWNhdG9yOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NvbG9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbG9yIGZvciBsZXZlbC11cHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ1RoZSBib3JkZXJzIGFyb3VuZCBsZXZlbC11cHMgd2lsbCBoYXZlIHRoaXMgY29sb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGdlbmVyYWwuY29sb3JfbGV2ZWxfaW5kaWNhdG9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHJldmlld3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwYWdlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnUmV2aWV3cycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdTZXR0aW5ncyBwZXJ0YWluaW5nIHRvIHRoZSByZXZpZXcgaGVhdG1hcHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlld3Nfc2V0dGluZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2dyb3VwJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdSZXZpZXcgU2V0dGluZ3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdzX3NlY3Rpb246IHsgdHlwZTogJ3NlY3Rpb24nLCBsYWJlbDogJ0ludGVydmFscycgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlld3NfYXV0b19yYW5nZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdBdXRvIHJhbmdlIGludGVydmFscycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdBdXRvbWF0aWNhbGx5IGRlY2lkZSB3aGF0IHRoZSBpbnRlcnZhbHMgc2hvdWxkIGJlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQHJldmlld3MuYXV0b19yYW5nZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2aWV3c19ncmFkaWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdVc2UgZ3JhZGllbnRzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbnRlcnBvbGF0ZSBjb2xvcnMgYmFzZWQgb24gdGhlIGV4YWN0IG51bWJlciBvZiBpdGVtcyBvbiB0aGF0IGRheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ0ByZXZpZXdzLmdyYWRpZW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdzX2dlbmVyYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdHZW5lcmF0ZSBjb2xvcnMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdHZW5lcmF0ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnR2VuZXJhdGUgbmV3IGNvbG9ycyBmcm9tIHRoZSBmaXJzdCBhbmQgbGFzdCBub24temVybyBpbnRlcnZhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25fY2xpY2s6IGdlbmVyYXRlX2NvbG9ycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXdzX3NlY3Rpb24yOiB7IHR5cGU6ICdzZWN0aW9uJywgbGFiZWw6ICdPdGhlcicgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbG9hZF9idXR0b246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1JlbG9hZCByZXZpZXcgZGF0YScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ1JlbG9hZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnRGVsZXRlcyByZXZpZXcgY2FjaGUgYW5kIHN0YXJ0cyBhIG5ldyBmZXRjaCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25fY2xpY2s6ICgpID0+IHJldmlld19jYWNoZS5yZWxvYWQoKS50aGVuKChyZXZpZXdzKSA9PiByZWxvYWQocmV2aWV3cykpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVzc29uczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3BhZ2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdMZXNzb25zJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ1NldHRpbmdzIHBlcnRhaW5pbmcgdG8gdGhlIGxlc3NvbiBoZWF0bWFwcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVzc29uc19zZXR0aW5nczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ3JvdXAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0xlc3NvbiBTZXR0aW5ncycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlc3NvbnNfc2VjdGlvbjogeyB0eXBlOiAnc2VjdGlvbicsIGxhYmVsOiAnSW50ZXJ2YWxzJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVzc29uc19hdXRvX3JhbmdlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0F1dG8gcmFuZ2UgaW50ZXJ2YWxzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDogJ0F1dG9tYXRpY2FsbHkgZGVjaWRlIHdoYXQgdGhlIGludGVydmFscyBzaG91bGQgYmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdAbGVzc29ucy5hdXRvX3JhbmdlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXNzb25zX2dyYWRpZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1VzZSBncmFkaWVudHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyX3RpcDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ludGVycG9sYXRlIGNvbG9ycyBiYXNlZCBvbiB0aGUgZXhhY3QgbnVtYmVyIG9mIGl0ZW1zIG9uIHRoYXQgZGF5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGxlc3NvbnMuZ3JhZGllbnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlc3NvbnNfZ2VuZXJhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0dlbmVyYXRlIGNvbG9ycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0dlbmVyYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdHZW5lcmF0ZSBuZXcgY29sb3JzIGZyb20gdGhlIGZpcnN0IGFuZCBsYXN0IG5vbi16ZXJvIGludGVydmFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbl9jbGljazogZ2VuZXJhdGVfY29sb3JzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlc3NvbnNfc2VjdGlvbjI6IHsgdHlwZTogJ3NlY3Rpb24nLCBsYWJlbDogJ090aGVyJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVzc29uc19jb3VudF96ZXJvczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdJbmNsdWRlIHplcm9zIGluIHN0cmVhaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnQ291bnRzIGRheXMgd2l0aCBubyBsZXNzb25zIGF2YWlsYWJsZSB0b3dhcmRzIHRoZSBzdHJlYWsnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdAbGVzc29ucy5jb3VudF96ZXJvcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Zlcl9sZXNzb25zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1JlY292ZXIgcmVzZXQgbGVzc29ucycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQWxsb3cgdGhlIEhlYXRtYXAgdG8gZ3Vlc3Mgd2hlbiB5b3UgZGlkIGxlc3NvbnMgZm9yIGl0ZW1zIHRoYXQgaGF2ZSBiZWVuIHJlc2V0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnQGxlc3NvbnMucmVjb3Zlcl9sZXNzb25zJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVjYXN0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGFnZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1JldmlldyBGb3JlY2FzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdTZXR0aW5ncyBwZXJ0YWluaW5nIHRvIHRoZSBmb3JlY2FzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWNhc3Rfc2V0dGluZ3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2dyb3VwJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdGb3JlY2FzdCBTZXR0aW5ncycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVjYXN0X3NlY3Rpb246IHsgdHlwZTogJ3NlY3Rpb24nLCBsYWJlbDogJ0ludGVydmFscycgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVjYXN0X2F1dG9fcmFuZ2U6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnQXV0byByYW5nZSBpbnRlcnZhbHMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnQXV0b21hdGljYWxseSBkZWNpZGUgd2hhdCB0aGUgaW50ZXJ2YWxzIHNob3VsZCBiZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ0Bmb3JlY2FzdC5hdXRvX3JhbmdlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlY2FzdF9ncmFkaWVudDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdVc2UgZ3JhZGllbnRzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJbnRlcnBvbGF0ZSBjb2xvcnMgYmFzZWQgb24gdGhlIGV4YWN0IG51bWJlciBvZiBpdGVtcyBvbiB0aGF0IGRheScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ0Bmb3JlY2FzdC5ncmFkaWVudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWNhc3RfZ2VuZXJhdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0dlbmVyYXRlIGNvbG9ycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0dlbmVyYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdHZW5lcmF0ZSBuZXcgY29sb3JzIGZyb20gdGhlIGZpcnN0IGFuZCBsYXN0IG5vbi16ZXJvIGludGVydmFsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbl9jbGljazogZ2VuZXJhdGVfY29sb3JzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgbGV0IGRpYWxvZyA9IG5ldyB3a29mLlNldHRpbmdzKGNvbmZpZykKICAgICAgICBjb25maWcucHJlX29wZW4gPSAoZWxlbSkgPT4gewogICAgICAgICAgICBkaWFsb2cucmVmcmVzaCgpCiAgICAgICAgICAgIG1vZGlmeV9zZXR0aW5ncyhlbGVtKQogICAgICAgIH0gLy8gUmVmcmVzaCB0byBwb3B1bGF0ZSBzZXR0aW5ncyBiZWZvcmUgbW9kaWZ5aW5nCiAgICAgICAgZGVsZXRlIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS53a29mc19hY3RpdmVfdGFicyAvLyBNYWtlIHNldHRpbmdzIGRpYWxvZyBhbHdheXMgb3BlbiBpbiBmaXJzdCB0YWIgYmVjYXVzZSBpdCBpcyBzbyBtdWNoIHRhbGxlcgogICAgICAgIGRpYWxvZy5vcGVuKCkKICAgIH0KCiAgICAvLyBGZXRjaGVzIHVzZXIncyB2MiBzZXR0aW5ncyBpZiB0aGV5IGV4aXN0CiAgICBhc3luYyBmdW5jdGlvbiBwb3J0X3NldHRpbmdzKHNldHRpbmdzKSB7CiAgICAgICAgaWYgKHdrb2YuZmlsZV9jYWNoZS5kaXJbJ3drb2Yuc2V0dGluZ3Mud2FuaWthbmlfaGVhdG1hcCddKSB7CiAgICAgICAgICAgIGxldCBvbGQgPSBhd2FpdCB3a29mLmZpbGVfY2FjaGUubG9hZCgnd2tvZi5zZXR0aW5ncy53YW5pa2FuaV9oZWF0bWFwJykKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5zdGFydF9kYXRlID0gb2xkLmdlbmVyYWwuc3RhcnRfZGF0ZQogICAgICAgICAgICBzZXR0aW5ncy5nZW5lcmFsLndlZWtfc3RhcnQgPSBvbGQuZ2VuZXJhbC53ZWVrX3N0YXJ0ID8gMCA6IDYKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5kYXlfc3RhcnQgPSBvbGQuZ2VuZXJhbC5ob3Vyc19vZmZzZXQKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5yZXZlcnNlX3llYXJzID0gb2xkLmdlbmVyYWwucmV2ZXJzZV95ZWFycwogICAgICAgICAgICBzZXR0aW5ncy5nZW5lcmFsLnNlZ21lbnRfeWVhcnMgPSBvbGQuZ2VuZXJhbC5zZWdtZW50X3llYXJzCiAgICAgICAgICAgIHNldHRpbmdzLmdlbmVyYWwuZGF5X2xhYmVscyA9IG9sZC5nZW5lcmFsLmRheV9sYWJlbHMKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5ub3dfaW5kaWNhdG9yID0gb2xkLmdlbmVyYWwudG9kYXkKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5jb2xvcl9ub3dfaW5kaWNhdG9yID0gb2xkLmdlbmVyYWwudG9kYXlfY29sb3IKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5sZXZlbF9pbmRpY2F0b3IgPSBvbGQuZ2VuZXJhbC5sZXZlbF91cHMKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5jb2xvcl9sZXZlbF9pbmRpY2F0b3IgPSBvbGQuZ2VuZXJhbC5sZXZlbF91cHNfY29sb3IKICAgICAgICAgICAgc2V0dGluZ3MucmV2aWV3cy5hdXRvX3JhbmdlID0gb2xkLnJldmlld3MuYXV0b19yYW5nZQogICAgICAgICAgICBzZXR0aW5ncy5yZXZpZXdzLmNvbG9ycyA9IFsKICAgICAgICAgICAgICAgIFswLCAnIzc0NzQ3NCddLAogICAgICAgICAgICAgICAgWzEsIG9sZC5yZXZpZXdzLmNvbG9yMV0sCiAgICAgICAgICAgICAgICBbb2xkLnJldmlld3MuaW50ZXJ2YWwxLCBvbGQucmV2aWV3cy5jb2xvcjJdLAogICAgICAgICAgICAgICAgW29sZC5yZXZpZXdzLmludGVydmFsMiwgb2xkLnJldmlld3MuY29sb3IzXSwKICAgICAgICAgICAgICAgIFtvbGQucmV2aWV3cy5pbnRlcnZhbDMsIG9sZC5yZXZpZXdzLmNvbG9yNF0sCiAgICAgICAgICAgICAgICBbb2xkLnJldmlld3MuaW50ZXJ2YWw0LCBvbGQucmV2aWV3cy5jb2xvcjVdLAogICAgICAgICAgICBdCiAgICAgICAgICAgIHNldHRpbmdzLmZvcmVjYXN0LmNvbG9ycyA9IFsKICAgICAgICAgICAgICAgIFswLCAnIzc0NzQ3NCddLAogICAgICAgICAgICAgICAgWzEsIG9sZC5yZXZpZXdzLmZvcmVjYXN0X2NvbG9yMV0sCiAgICAgICAgICAgICAgICBbb2xkLnJldmlld3MuaW50ZXJ2YWwxLCBvbGQucmV2aWV3cy5mb3JlY2FzdF9jb2xvcjJdLAogICAgICAgICAgICAgICAgW29sZC5yZXZpZXdzLmludGVydmFsMiwgb2xkLnJldmlld3MuZm9yZWNhc3RfY29sb3IzXSwKICAgICAgICAgICAgICAgIFtvbGQucmV2aWV3cy5pbnRlcnZhbDMsIG9sZC5yZXZpZXdzLmZvcmVjYXN0X2NvbG9yNF0sCiAgICAgICAgICAgICAgICBbb2xkLnJldmlld3MuaW50ZXJ2YWw0LCBvbGQucmV2aWV3cy5mb3JlY2FzdF9jb2xvcjVdLAogICAgICAgICAgICBdCiAgICAgICAgICAgIHNldHRpbmdzLmZvcmVjYXN0LmF1dG9fcmFuZ2UgPSBvbGQucmV2aWV3cy5hdXRvX3JhbmdlCiAgICAgICAgICAgIHNldHRpbmdzLmxlc3NvbnMuY29sb3JzID0gWwogICAgICAgICAgICAgICAgWzAsICcjNzQ3NDc0J10sCiAgICAgICAgICAgICAgICBbMSwgb2xkLmxlc3NvbnMuY29sb3IxXSwKICAgICAgICAgICAgICAgIFtvbGQubGVzc29ucy5pbnRlcnZhbDEsIG9sZC5sZXNzb25zLmNvbG9yMl0sCiAgICAgICAgICAgICAgICBbb2xkLmxlc3NvbnMuaW50ZXJ2YWwyLCBvbGQubGVzc29ucy5jb2xvcjNdLAogICAgICAgICAgICAgICAgW29sZC5sZXNzb25zLmludGVydmFsMywgb2xkLmxlc3NvbnMuY29sb3I0XSwKICAgICAgICAgICAgICAgIFtvbGQubGVzc29ucy5pbnRlcnZhbDQsIG9sZC5sZXNzb25zLmNvbG9yNV0sCiAgICAgICAgICAgIF0KICAgICAgICAgICAgc2V0dGluZ3MubGVzc29ucy5hdXRvX3JhbmdlID0gb2xkLmxlc3NvbnMuYXV0b19yYW5nZQogICAgICAgICAgICBzZXR0aW5ncy5sZXNzb25zLmNvdW50X3plcm9zID0gb2xkLmxlc3NvbnMuY291bnRfemVyb3MKICAgICAgICB9CiAgICAgICAgc2V0dGluZ3Mub3RoZXIucG9ydGVkID0gdHJ1ZQogICAgfQoKICAgIC8vIFJlbG9hZCB0aGUgaGVhdG1hcCBpZiBzZXR0aW5ncyBoYXZlIGJlZW4gY2hhbmdlZAogICAgZnVuY3Rpb24gcmVsb2FkX29uX2NoYW5nZShzZXR0aW5ncykgewogICAgICAgIGlmIChhcHBsaWVkKSByZWxvYWQoKQogICAgfQoKICAgIC8vIEdlbmVyYXRlcyBuZXcgY29sb3JzIGZvciB0aGUgaW50ZXJ2YWxzIGluIHRoZSBzZXR0aW5ncyBkaWFsb2cKICAgIGZ1bmN0aW9uIGdlbmVyYXRlX2NvbG9ycyhzZXR0aW5nX25hbWUpIHsKICAgICAgICAvLyBGaW5kIHRoZSBpbnRlcnZhbHMKICAgICAgICBsZXQgdHlwZSA9IHNldHRpbmdfbmFtZS5zcGxpdCgnXycpWzBdCiAgICAgICAgbGV0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2NyaXB0X2lkICsgJ18nICsgdHlwZSArICdfc2V0dGluZ3MnKS5xdWVyeVNlbGVjdG9yKCcucGFuZWwnKQogICAgICAgIGxldCBjb2xvcnMgPSB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF1bdHlwZV0uY29sb3JzCiAgICAgICAgLy8gSW50ZXJwb2xhdGUgYmV0d2VlbiBmaXJzdCBhbmQgbGFzdCBub24temVybyBpbnRlcnZhbAogICAgICAgIGxldCBmaXJzdCA9IGNvbG9yc1sxXQogICAgICAgIGxldCBsYXN0ID0gY29sb3JzW2NvbG9ycy5sZW5ndGggLSAxXQogICAgICAgIGZvciAobGV0IGkgPSAyOyBpIDwgY29sb3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbG9yc1tpXVsxXSA9IGludGVycG9sYXRlX2NvbG9yKGZpcnN0WzFdLCBsYXN0WzFdLCAoaSAtIDEpIC8gKGNvbG9ycy5sZW5ndGggLSAyKSkKICAgICAgICB9CiAgICAgICAgLy8gUmVmcmVzaCBzZXR0aW5ncwogICAgICAgIHBhbmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb2xvciBpbnB1dCcpLmZvckVhY2goKGlucHV0LCBpKSA9PiB7CiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gY29sb3JzW2ldWzFdCiAgICAgICAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSkKICAgICAgICB9KQogICAgfQoKICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogICAgLy8gRXh0cmFjdCB1cGNvbWluZyByZXZpZXdzIGFuZCBjb21wbGV0ZWQgbGVzc29ucyBmcm9tIHRoZSBXS09GIGNhY2hlCiAgICBmdW5jdGlvbiBnZXRfZm9yZWNhc3RfYW5kX2xlc3NvbnMoZGF0YSkgewogICAgICAgIGxldCBmb3JlY2FzdCA9IFtdLAogICAgICAgICAgICBsZXNzb25zID0gW10KICAgICAgICBsZXQgdmFjYXRpb25fb2Zmc2V0ID0gRGF0ZS5ub3coKSAtIG5ldyBEYXRlKHdrb2YudXNlci5jdXJyZW50X3ZhY2F0aW9uX3N0YXJ0ZWRfYXQgfHwgRGF0ZS5ub3coKSkKICAgICAgICBmb3IgKGxldCBpdGVtIG9mIGRhdGEpIHsKICAgICAgICAgICAgaWYgKGl0ZW0uYXNzaWdubWVudHMgJiYgaXRlbS5hc3NpZ25tZW50cy5zdGFydGVkX2F0ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgYXNzaWdubWVudCBoYXMgYmVlbiBzdGFydGVkIGFkZCBhIGxlc3NvbiBjb250YWluaW5nIHN0YXJpbmcgZGF0ZSwgaWQsIGxldmVsLCBhbmQgdW5sb2NrIGRhdGUKICAgICAgICAgICAgICAgIGxlc3NvbnMucHVzaChbCiAgICAgICAgICAgICAgICAgICAgRGF0ZS5wYXJzZShpdGVtLmFzc2lnbm1lbnRzLnN0YXJ0ZWRfYXQpLAogICAgICAgICAgICAgICAgICAgIGl0ZW0uaWQsCiAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhLmxldmVsLAogICAgICAgICAgICAgICAgICAgIERhdGUucGFyc2UoaXRlbS5hc3NpZ25tZW50cy51bmxvY2tlZF9hdCksCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgaWYgKERhdGUucGFyc2UoaXRlbS5hc3NpZ25tZW50cy5hdmFpbGFibGVfYXQpID4gRGF0ZS5ub3coKSkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBhc3NpZ25tZW50IGlzIHNjaGVkdWxlZCBhZGQgYSBmb3JlY2FzdCBpdGVtIHJlYWR5IGZvciBzZW5kaW5nIHRvIHRoZSBoZWF0bWFwIG1vZHVsZQogICAgICAgICAgICAgICAgICAgIGxldCBmb3JlY2FzdF9pdGVtID0gWwogICAgICAgICAgICAgICAgICAgICAgICBEYXRlLnBhcnNlKGl0ZW0uYXNzaWdubWVudHMuYXZhaWxhYmxlX2F0KSArIHZhY2F0aW9uX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgeyBmb3JlY2FzdDogMSB9LAogICAgICAgICAgICAgICAgICAgICAgICB7ICdmb3JlY2FzdC1pZHMnOiBpdGVtLmlkIH0sCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIGZvcmVjYXN0X2l0ZW1bMV1bJ2ZvcmVjYXN0LXNyczEtJyArIGl0ZW0uYXNzaWdubWVudHMuc3JzX3N0YWdlXSA9IDEKICAgICAgICAgICAgICAgICAgICBmb3JlY2FzdC5wdXNoKGZvcmVjYXN0X2l0ZW0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gU29ydCBsZXNzb25zIGJ5IHN0YXJ0ZWRfYXQgZm9yIGVhc3kgZXh0cmFjdGlvbiBvZiBjaHJvbm9sb2dpY2FsIGluZm8KICAgICAgICBsZXNzb25zLnNvcnQoKGEsIGIpID0+IChhWzBdIDwgYlswXSA/IC0xIDogMSkpCiAgICAgICAgcmV0dXJuIFtmb3JlY2FzdCwgbGVzc29uc10KICAgIH0KCiAgICAvLyBGZXRjaCByZWNvdmVyZWQgbGVzc29ucyBmcm9tIHN0b3JhZ2Ugb3IgcmVjb3ZlciBsZXNzb25zIHRoZW4gcmV0dXJuIHRoZW0KICAgIGFzeW5jIGZ1bmN0aW9uIGdldF9yZWNvdmVyZWRfbGVzc29ucyhpdGVtcywgcmV2aWV3cywgcmVhbF9sZXNzb25zKSB7CiAgICAgICAgaWYgKCF3a29mLmZpbGVfY2FjaGUuZGlyLnJlY292ZXJlZF9sZXNzb25zKSB7CiAgICAgICAgICAgIGxldCByZWNvdmVyZWRfbGVzc29ucyA9IGF3YWl0IHJlY292ZXJfbGVzc29ucyhpdGVtcywgcmV2aWV3cywgcmVhbF9sZXNzb25zKQogICAgICAgICAgICB3a29mLmZpbGVfY2FjaGUuc2F2ZSgncmVjb3ZlcmVkX2xlc3NvbnMnLCByZWNvdmVyZWRfbGVzc29ucykKICAgICAgICAgICAgcmV0dXJuIHJlY292ZXJlZF9sZXNzb25zCiAgICAgICAgfSBlbHNlIHJldHVybiBhd2FpdCB3a29mLmZpbGVfY2FjaGUubG9hZCgncmVjb3ZlcmVkX2xlc3NvbnMnKQogICAgfQoKICAgIC8vIFVzZSByZXZpZXcgZGF0YSB0byBndWVzcyB3aGVuIHRoZSBsZXNzb24gd2FzIGRvbmUgZm9yIGFsbCByZXNldCBpdGVtcwogICAgYXN5bmMgZnVuY3Rpb24gcmVjb3Zlcl9sZXNzb25zKGl0ZW1zLCByZXZpZXdzLCByZWFsX2xlc3NvbnMpIHsKICAgICAgICAvLyBGZXRjaCBhbmQgcHJlcGFyZSBkYXRhCiAgICAgICAgbGV0IHJlc2V0cyA9IGF3YWl0IHdrb2YuQXBpdjIuZ2V0X2VuZHBvaW50KCdyZXNldHMnKQogICAgICAgIGxldCBpdGVtc19pZCA9IHdrb2YuSXRlbURhdGEuZ2V0X2luZGV4KGl0ZW1zLCAnc3ViamVjdF9pZCcpCiAgICAgICAgbGV0IGRlbGF5ID0gNCAqIG1zaAogICAgICAgIGxldCBhcHAxX3Jldmlld3MgPSByZXZpZXdzCiAgICAgICAgICAgIC5maWx0ZXIoKGEpID0+IGFbMl0gPT0gMSkKICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gW2l0ZW1bMF0gLSBkZWxheSwgaXRlbVsxXSwgaXRlbXNfaWRbaXRlbVsxXV0uZGF0YS5sZXZlbCwgaXRlbVswXSAtIGRlbGF5XSkKICAgICAgICAvLyBDaGVjayByZXZpZXdzIGJhc2VkIG9uIHJlc2V0IGludGVydmFscwogICAgICAgIGxldCBsYXN0X2RhdGUgPSAwLAogICAgICAgICAgICByZWNvdmVyZWRfbGVzc29ucyA9IFtdCiAgICAgICAgT2JqZWN0LnZhbHVlcyhyZXNldHMpCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiAoYS5kYXRhLmNvbmZpcm1lZF9hdCA8IGIuZGF0YS5jb25maXJtZWRfYXQgPyAtMSA6IDEpKQogICAgICAgICAgICAuZm9yRWFjaCgocmVzZXQpID0+IHsKICAgICAgICAgICAgICAgIGxldCBpZHMgPSB7fSwKICAgICAgICAgICAgICAgICAgICBkYXRlID0gRGF0ZS5wYXJzZShyZXNldC5kYXRhLmNvbmZpcm1lZF9hdCkKICAgICAgICAgICAgICAgIC8vIEZpbHRlciBvdXQgaXRlbXMgbm90IGJlbG9uZ2luZyB0byB0aGUgY3VycmVudCByZXNldCBwZXJpb2QKICAgICAgICAgICAgICAgIGxldCByZXNldF9yZXZpZXdzID0gYXBwMV9yZXZpZXdzLmZpbHRlcigoYSkgPT4gYVswXSA+IGxhc3RfZGF0ZSAmJiBhWzBdIDwgZGF0ZSkKICAgICAgICAgICAgICAgIC8vIENob29zZSB0aGUgZWFybGllc3QgQXBwMSByZXZpZXcKICAgICAgICAgICAgICAgIHJlc2V0X3Jldmlld3MuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghaWRzW2l0ZW1bMV1dIHx8IGlkc1tpdGVtWzFdXVswXSA+IGl0ZW1bMF0pIGlkc1tpdGVtWzFdXSA9IGl0ZW0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgaXRlbXMgdGhhdCBzdGlsbCBoYXZlIGxlc3NvbiBkYXRhCiAgICAgICAgICAgICAgICByZWFsX2xlc3NvbnMuZmlsdGVyKChhKSA9PiBhWzBdIDwgZGF0ZSkuZm9yRWFjaCgoaXRlbSkgPT4gZGVsZXRlIGlkc1tpdGVtWzFdXSkKICAgICAgICAgICAgICAgIC8vIFNhdmUgcmVjb3ZlcmVkIGxlc3NvbnMgdG8gYXJyYXkKICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMoaWRzKS5mb3JFYWNoKChpdGVtKSA9PiByZWNvdmVyZWRfbGVzc29ucy5wdXNoKGl0ZW0pKQogICAgICAgICAgICAgICAgbGFzdF9kYXRlID0gZGF0ZQogICAgICAgICAgICB9KQogICAgICAgIHJldHVybiByZWNvdmVyZWRfbGVzc29ucwogICAgfQoKICAgIC8vIENhbGN1bGF0ZSBvdmVyYWxsIHN0YXRzIGZvciBsZXNzb25zIGFuZCByZXZpZXdzCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVfc3RhdHModHlwZSwgZGF0YSkgewogICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgIGxldCBzdHJlYWtzID0gZ2V0X3N0cmVha3ModHlwZSwgZGF0YSkKICAgICAgICBsZXQgbG9uZ2VzdF9zdHJlYWsgPSBNYXRoLm1heCguLi5PYmplY3QudmFsdWVzKHN0cmVha3MpKQogICAgICAgIGxldCBjdXJyZW50X3N0cmVhayA9IHN0cmVha3NbbmV3IERhdGUoRGF0ZS5ub3coKSAtIG1zaCAqIHNldHRpbmdzLmdlbmVyYWwuZGF5X3N0YXJ0KS50b0RhdGVTdHJpbmcoKV0KICAgICAgICBsZXQgc3RhdHMgPSB7CiAgICAgICAgICAgIHRvdGFsOiBbMCwgMCwgMCwgMCwgMCwgMF0sIC8vIFt0b3RhbCwgeWVhciwgbW9udGgsIHdlZWssIGRheSwgdG9kYXldCiAgICAgICAgICAgIGRheXNfc3R1ZGllZDogWzAsIDBdLCAvLyBbZGF5cyBzdHVkaWVkLCBwZXJjZW50YWdlXQogICAgICAgICAgICBhdmVyYWdlOiBbMCwgMCwgMF0sIC8vIFthdmVyYWdlLCBwZXIgc3R1ZGllZCwgc3RhbmRhcmQgZGV2aWF0aW9uXQogICAgICAgICAgICBzdHJlYWs6IFtsb25nZXN0X3N0cmVhaywgY3VycmVudF9zdHJlYWtdLCAvLyBbbG9uZ2VzdCBzdHJlYWssIGN1cnJlbnQgc3RyZWFrXQogICAgICAgICAgICBzZXNzaW9uczogMCwgLy8gTnVtYmVyIG9mIHNlc3Npb25zCiAgICAgICAgICAgIHRpbWU6IFswLCAwLCAwLCAwLCAwLCAwXSwgLy8gW3RvdGFsLCB5ZWFyLCBtb250aCwgd2VlaywgZGF5LCB0b2RheV0KICAgICAgICAgICAgZGF5czogMCwgLy8gTnVtYmVyIG9mIGRheXMgc2luY2UgZmlyc3QgcmV2aWV3CiAgICAgICAgICAgIG1heF9kb25lOiBbMCwgMF0sIC8vIE1heCBkb25lIGluIG9uZSBkYXkgW2NvdW50LCBkYXRlXQogICAgICAgICAgICBzdHJlYWtzLCAvLyBTdHJlYWtzIG9iamVjdAogICAgICAgIH0KICAgICAgICBsZXQgbGFzdF9kYXkgPSBuZXcgRGF0ZSgwKSAvLyBMYXN0IGl0ZW0ncyBkYXRlCiAgICAgICAgbGV0IHRvZGF5ID0gbmV3IERhdGUoKSAvLyBUb2RheQogICAgICAgIGxldCBkID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIG1zZCkgLy8gMjQgaG91cnMgYWdvCiAgICAgICAgbGV0IHdlZWsgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gNyAqIG1zZCkgLy8gNyBkYXlzIGFnbwogICAgICAgIGxldCBtb250aCA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAzMCAqIG1zZCkgLy8gMzAgZGF5cyBhZ28KICAgICAgICBsZXQgeWVhciA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAzNjUgKiBtc2QpIC8vIDM2NSBkYXlzIGFnbwogICAgICAgIGxldCBsYXN0X3RpbWUgPSAwIC8vIExhc3QgaXRlbSdzIHRpbWVzdGFtcAogICAgICAgIGxldCBkb25lX2RheSA9IDAgLy8gVG90YWwgZG9uZSBvbiB0aGUgZGF0ZSBvZiB0aGUgaXRlbQogICAgICAgIGxldCBkb25lX2RheXMgPSBbXSAvLyBMaXN0IG9mIHRvdGFsIGRvbmUgb24gZWFjaCBkYXkKICAgICAgICBsZXQgc3RhcnRfZGF0ZSA9IG5ldyBEYXRlKHNldHRpbmdzLmdlbmVyYWwuc3RhcnRfZGF5KSAvLyBVc2VyJ3Mgc3RhcnQgZGF0ZQogICAgICAgIGZvciAobGV0IGl0ZW0gb2YgZGF0YSkgewogICAgICAgICAgICBsZXQgZGF5ID0gbmV3IERhdGUoaXRlbVswXSAtIG1zaCAqIHNldHRpbmdzLmdlbmVyYWwuZGF5X3N0YXJ0KQogICAgICAgICAgICBpZiAoZGF5IDwgc3RhcnRfZGF0ZSkgY29udGludWUgLy8gSWYgaXRlbSBpcyBiZWZvcmUgc3RhcnQsIGRpc2NhcmQgaXQKICAgICAgICAgICAgLy8gSWYgaXQncyBhIG5ldyBkYXkKICAgICAgICAgICAgaWYgKGxhc3RfZGF5LnRvRGF0ZVN0cmluZygpICE9IGRheS50b0RhdGVTdHJpbmcoKSkgewogICAgICAgICAgICAgICAgc3RhdHMuZGF5c19zdHVkaWVkWzBdKysKICAgICAgICAgICAgICAgIGRvbmVfZGF5cy5wdXNoKGRvbmVfZGF5KQogICAgICAgICAgICAgICAgZG9uZV9kYXkgPSAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gVXBkYXRlIGRvbmUgdGhpcyBkYXkKICAgICAgICAgICAgZG9uZV9kYXkrKwogICAgICAgICAgICBpZiAoZG9uZV9kYXkgPiBzdGF0cy5tYXhfZG9uZVswXSkgc3RhdHMubWF4X2RvbmUgPSBbZG9uZV9kYXksIGRheS50b0RhdGVTdHJpbmcoKS5yZXBsYWNlKC8uLi4gLywgJycpXQogICAgICAgICAgICBsZXQgbWludXRlcyA9IChpdGVtWzBdIC0gbGFzdF90aW1lKSAvIDYwMDAwCiAgICAgICAgICAgIC8vIFVwZGF0ZSBzZXNzaW9ucwogICAgICAgICAgICBpZiAobWludXRlcyA+IHNldHRpbmdzLmdlbmVyYWwuc2Vzc2lvbl9saW1pdCkgewogICAgICAgICAgICAgICAgc3RhdHMuc2Vzc2lvbnMrKwogICAgICAgICAgICAgICAgbWludXRlcyA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBVcGRhdGUgdG90YWxzCiAgICAgICAgICAgIHN0YXRzLnRvdGFsWzBdKysKICAgICAgICAgICAgc3RhdHMudGltZVswXSArPSBtaW51dGVzCiAgICAgICAgICAgIC8vIERvbmUgaW4gdGhlIGxhc3QgeWVhcgogICAgICAgICAgICBpZiAoeWVhciA8IGRheSkgewogICAgICAgICAgICAgICAgc3RhdHMudG90YWxbMV0rKwogICAgICAgICAgICAgICAgc3RhdHMudGltZVsxXSArPSBtaW51dGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRG9uZSBpbiB0aGUgbGFzdCBtb250aAogICAgICAgICAgICBpZiAobW9udGggPCBkYXkpIHsKICAgICAgICAgICAgICAgIHN0YXRzLnRvdGFsWzJdKysKICAgICAgICAgICAgICAgIHN0YXRzLnRpbWVbMl0gKz0gbWludXRlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIERvbmUgaW4gdGhlIGxhc3Qgd2VlawogICAgICAgICAgICBpZiAod2VlayA8IGRheSkgewogICAgICAgICAgICAgICAgc3RhdHMudG90YWxbM10rKwogICAgICAgICAgICAgICAgc3RhdHMudGltZVszXSArPSBtaW51dGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRG9uZSBpbiB0aGUgbGFzdCAyNCBob3VycwogICAgICAgICAgICBpZiAoZCA8IGRheSkgewogICAgICAgICAgICAgICAgc3RhdHMudG90YWxbNF0rKwogICAgICAgICAgICAgICAgc3RhdHMudGltZVs0XSArPSBtaW51dGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRG9uZSB0b2RheQogICAgICAgICAgICBpZiAodG9kYXkudG9EYXRlU3RyaW5nKCkgPT0gZGF5LnRvRGF0ZVN0cmluZygpKSB7CiAgICAgICAgICAgICAgICBzdGF0cy50b3RhbFs1XSsrCiAgICAgICAgICAgICAgICBzdGF0cy50aW1lWzVdICs9IG1pbnV0ZXMKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBTdG9yZSB2YWx1ZXMgZm9yIG5leHQgaXRlbQogICAgICAgICAgICBsYXN0X2RheSA9IGRheQogICAgICAgICAgICBsYXN0X3RpbWUgPSBpdGVtWzBdCiAgICAgICAgfQogICAgICAgIC8vIFVwZGF0ZSBhdmVyYWdlcwogICAgICAgIGRvbmVfZGF5cy5wdXNoKGRvbmVfZGF5KQogICAgICAgIHN0YXRzLmRheXMgPQogICAgICAgICAgICBNYXRoLnJvdW5kKAogICAgICAgICAgICAgICAgKERhdGUucGFyc2UobmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKSkgLQogICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KAogICAgICAgICAgICAgICAgICAgICAgICBEYXRlLnBhcnNlKG5ldyBEYXRlKGRhdGFbMF1bMF0pLnRvRGF0ZVN0cmluZygpKSwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUoc2V0dGluZ3MuZ2VuZXJhbC5zdGFydF9kYXkpLmdldFRpbWUoKSwKICAgICAgICAgICAgICAgICAgICApKSAvCiAgICAgICAgICAgICAgICAgICAgbXNkLAogICAgICAgICAgICApICsgMQogICAgICAgIHN0YXRzLmRheXNfc3R1ZGllZFsxXSA9IE1hdGgucm91bmQoKHN0YXRzLmRheXNfc3R1ZGllZFswXSAvIHN0YXRzLmRheXMpICogMTAwKQogICAgICAgIHN0YXRzLmF2ZXJhZ2VbMF0gPSBNYXRoLnJvdW5kKHN0YXRzLnRvdGFsWzBdIC8gc3RhdHMuZGF5cykKICAgICAgICBzdGF0cy5hdmVyYWdlWzFdID0gTWF0aC5yb3VuZChzdGF0cy50b3RhbFswXSAvIHN0YXRzLmRheXNfc3R1ZGllZFswXSkKICAgICAgICBzdGF0cy5hdmVyYWdlWzJdID0gTWF0aC5zcXJ0KAogICAgICAgICAgICAoMSAvIHN0YXRzLmRheXNfc3R1ZGllZFswXSkgKgogICAgICAgICAgICAgICAgZG9uZV9kYXlzLm1hcCgoeCkgPT4gTWF0aC5wb3coeCAtIHN0YXRzLmF2ZXJhZ2VbMV0sIDIpKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIHN0YXRzCiAgICB9CgogICAgLy8gRmluZHMgc3RyZWFrcwogICAgZnVuY3Rpb24gZ2V0X3N0cmVha3ModHlwZSwgZGF0YSkgewogICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgIGxldCBkYXlfc3RhcnRfYWRqdXN0ID0gbXNoICogc2V0dGluZ3MuZ2VuZXJhbC5kYXlfc3RhcnQgLy8gQWRqdXN0IGZvciB0aGUgdXNlcidzIHN0YXJ0IG9mIGRheSBzZXR0aW5nCiAgICAgICAgLy8gSW5pdGlhdGUgZGF0ZXMKICAgICAgICBsZXQgc3RyZWFrcyA9IHt9LAogICAgICAgICAgICB6ZXJvcyA9IHt9CiAgICAgICAgZm9yICgKICAgICAgICAgICAgbGV0IGRheSA9IG5ldyBEYXRlKE1hdGgubWF4KGRhdGFbMF1bMF0gLSBkYXlfc3RhcnRfYWRqdXN0LCBuZXcgRGF0ZShzZXR0aW5ncy5nZW5lcmFsLnN0YXJ0X2RheSkuZ2V0VGltZSgpKSk7CiAgICAgICAgICAgIGRheSA8PSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkYXkuc2V0RGF0ZShkYXkuZ2V0RGF0ZSgpICsgMSkKICAgICAgICApIHsKICAgICAgICAgICAgc3RyZWFrc1tkYXkudG9EYXRlU3RyaW5nKCldID0gMAogICAgICAgICAgICB6ZXJvc1tkYXkudG9EYXRlU3RyaW5nKCldID0gdHJ1ZQogICAgICAgIH0KICAgICAgICAvLyBGb3IgYWxsIGRhdGVzIHdoZXJlIHNvbWV0aGluZyB3YXMgZG9uZSwgc2V0IHN0cmVhayB0byAxCiAgICAgICAgZm9yIChsZXQgW2RhdGVdIG9mIGRhdGEpCiAgICAgICAgICAgIGlmIChuZXcgRGF0ZShkYXRlKSA+IG5ldyBEYXRlKHNldHRpbmdzLmdlbmVyYWwuc3RhcnRfZGF5KSkKICAgICAgICAgICAgICAgIHN0cmVha3NbbmV3IERhdGUoZGF0ZSAtIGRheV9zdGFydF9hZGp1c3QpLnRvRGF0ZVN0cmluZygpXSA9IDEKICAgICAgICAvLyBJZiB1c2VyIHdhbnRzIHRvIGNvdW50IGRheXMgd2hlcmUgbm8gbGVzc29ucyB3ZXJlIGF2YWlsYWJsZSwgc2V0IHRob3NlIHN0cmVha3MgdG8gMSBhcyB3ZWxsCiAgICAgICAgaWYgKHR5cGUgPT09ICdsZXNzb25zJyAmJiBzZXR0aW5ncy5sZXNzb25zLmNvdW50X3plcm9zKSB7CiAgICAgICAgICAgIC8vIERlbGV0ZSBkYXRlcyB3aGVyZSBsZXNzb25zIHdlcmUgYXZhaWxhYmxlCiAgICAgICAgICAgIGZvciAobGV0IFtzdGFydGVkX2F0LCBpZCwgbGV2ZWwsIHVubG9ja2VkX2F0XSBvZiBkYXRhKSB7CiAgICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgICAgIGxldCBkYXkgPSBuZXcgRGF0ZSh1bmxvY2tlZF9hdCAtIGRheV9zdGFydF9hZGp1c3QpOwogICAgICAgICAgICAgICAgICAgIGRheSA8PSBuZXcgRGF0ZShzdGFydGVkX2F0IC0gZGF5X3N0YXJ0X2FkanVzdCk7CiAgICAgICAgICAgICAgICAgICAgZGF5LnNldERhdGUoZGF5LmdldERhdGUoKSArIDEpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgemVyb3NbZGF5LnRvRGF0ZVN0cmluZygpXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNldCBhbGwgcmVtYWluaW5nIGRhdGVzIHRvIHN0cmVhayAxCiAgICAgICAgICAgIGZvciAobGV0IGRhdGUgb2YgT2JqZWN0LmtleXMoemVyb3MpKSBzdHJlYWtzW2RhdGVdID0gMQogICAgICAgIH0KICAgICAgICAvLyBDdW11bGF0ZSBzdHJlYWtzCiAgICAgICAgbGV0IHN0cmVhayA9IDAKICAgICAgICBmb3IgKAogICAgICAgICAgICBsZXQgZGF5ID0gbmV3IERhdGUoTWF0aC5tYXgoZGF0YVswXVswXSAtIGRheV9zdGFydF9hZGp1c3QsIG5ldyBEYXRlKHNldHRpbmdzLmdlbmVyYWwuc3RhcnRfZGF5KS5nZXRUaW1lKCkpKTsKICAgICAgICAgICAgZGF5IDw9IG5ldyBEYXRlKCkuc2V0SG91cnMoMjQpOwogICAgICAgICAgICBkYXkuc2V0RGF0ZShkYXkuZ2V0RGF0ZSgpICsgMSkKICAgICAgICApIHsKICAgICAgICAgICAgaWYgKHN0cmVha3NbZGF5LnRvRGF0ZVN0cmluZygpXSA9PT0gMSkgc3RyZWFrKysKICAgICAgICAgICAgZWxzZSBzdHJlYWsgPSAwCiAgICAgICAgICAgIHN0cmVha3NbZGF5LnRvRGF0ZVN0cmluZygpXSA9IHN0cmVhawogICAgICAgIH0KICAgICAgICBpZiAoc3RyZWFrc1tuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpXSA9PSAwKQogICAgICAgICAgICBzdHJlYWtzW25ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCldID0gc3RyZWFrc1tuZXcgRGF0ZShuZXcgRGF0ZSgpLnNldEhvdXJzKC0xMikpLnRvRGF0ZVN0cmluZygpXSB8fCAwCiAgICAgICAgcmV0dXJuIHN0cmVha3MKICAgIH0KCiAgICAvLyBHZXQgbGV2ZWwgdXAgZGF0ZXMgZnJvbSBBUEkgYW5kIGxlc3NvbiBoaXN0b3J5CiAgICBhc3luYyBmdW5jdGlvbiBnZXRfbGV2ZWxfdXBzKGl0ZW1zKSB7CiAgICAgICAgbGV0IGxldmVsX3Byb2dyZXNzaW9ucyA9IGF3YWl0IHdrb2YuQXBpdjIuZ2V0X2VuZHBvaW50KCdsZXZlbF9wcm9ncmVzc2lvbnMnKQogICAgICAgIGxldCBmaXJzdF9yZWNvcmRlZF9kYXRlID0gbGV2ZWxfcHJvZ3Jlc3Npb25zW01hdGgubWluKC4uLk9iamVjdC5rZXlzKGxldmVsX3Byb2dyZXNzaW9ucykpXS5kYXRhLnVubG9ja2VkX2F0CiAgICAgICAgLy8gRmluZCBpbmRlZmluaXRlIGxldmVsIHVwcyBieSBsb29raW5nIGF0IGxlc3NvbiBoaXN0b3J5CiAgICAgICAgbGV0IGxldmVscyA9IHt9CiAgICAgICAgLy8gU29ydCBsZXNzb25zIGJ5IGxldmVsIHRoZW4gdW5sb2NrZWQgZGF0ZQogICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgaXRlbS5vYmplY3QgIT09ICdrYW5qaScgfHwKICAgICAgICAgICAgICAgICFpdGVtLmFzc2lnbm1lbnRzIHx8CiAgICAgICAgICAgICAgICAhaXRlbS5hc3NpZ25tZW50cy51bmxvY2tlZF9hdCB8fAogICAgICAgICAgICAgICAgaXRlbS5hc3NpZ25tZW50cy51bmxvY2tlZF9hdCA+PSBmaXJzdF9yZWNvcmRlZF9kYXRlCiAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKGl0ZW0uYXNzaWdubWVudHMudW5sb2NrZWRfYXQpLnRvRGF0ZVN0cmluZygpCiAgICAgICAgICAgIGlmICghbGV2ZWxzW2l0ZW0uZGF0YS5sZXZlbF0pIGxldmVsc1tpdGVtLmRhdGEubGV2ZWxdID0ge30KICAgICAgICAgICAgaWYgKCFsZXZlbHNbaXRlbS5kYXRhLmxldmVsXVtkYXRlXSkgbGV2ZWxzW2l0ZW0uZGF0YS5sZXZlbF1bZGF0ZV0gPSAxCiAgICAgICAgICAgIGVsc2UgbGV2ZWxzW2l0ZW0uZGF0YS5sZXZlbF1bZGF0ZV0rKwogICAgICAgIH0pCiAgICAgICAgLy8gRGlzY2FyZCBkYXRlcyB3aXRoIGxlc3MgdGhhbiAxMCB1bmxvY2tlZAogICAgICAgIC8vIHRoZW4gZGlzY2FyZCBsZXZlbHMgd2l0aCBubyBkYXRlcwogICAgICAgIC8vIHRoZW4ga2VlcCBlYXJsaWVzdCBkYXRlIGZvciBlYWNoIGxldmVsCiAgICAgICAgZm9yIChsZXQgW2xldmVsLCBkYXRhXSBvZiBPYmplY3QuZW50cmllcyhsZXZlbHMpKSB7CiAgICAgICAgICAgIGZvciAobGV0IFtkYXRlLCBjb3VudF0gb2YgT2JqZWN0LmVudHJpZXMoZGF0YSkpIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCA8IDEwKSBkZWxldGUgZGF0YVtkYXRlXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhsZXZlbHNbbGV2ZWxdKS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgZGVsZXRlIGxldmVsc1tsZXZlbF0KICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV2ZWxzW2xldmVsXSA9IE9iamVjdC5rZXlzKGRhdGEpLnJlZHVjZSgobG93LCBjdXJyKSA9PiAobG93IDwgY3VyciA/IGxvdyA6IGN1cnIpLCBEYXRlLm5vdygpKQogICAgICAgIH0KICAgICAgICAvLyBNYXAgdG8gYXJyYXkgb2YgW1tsZXZlbDAsIGRhdGUwXSwgW2xldmVsMSwgZGF0ZTFdLCAuLi5dIEZvcm1hdAogICAgICAgIGxldmVscyA9IE9iamVjdC5lbnRyaWVzKGxldmVscykubWFwKChbbGV2ZWwsIGRhdGVdKSA9PiBbTnVtYmVyKGxldmVsKSwgZGF0ZV0pCiAgICAgICAgLy8gQWRkIGRlZmluaXRlIGxldmVsIHVwcyBmcm9tIEFQSQogICAgICAgIE9iamVjdC52YWx1ZXMobGV2ZWxfcHJvZ3Jlc3Npb25zKS5mb3JFYWNoKChsZXZlbCkgPT4KICAgICAgICAgICAgbGV2ZWxzLnB1c2goW2xldmVsLmRhdGEubGV2ZWwsIG5ldyBEYXRlKGxldmVsLmRhdGEudW5sb2NrZWRfYXQpLnRvRGF0ZVN0cmluZygpXSksCiAgICAgICAgKQogICAgICAgIHJldHVybiBsZXZlbHMKICAgIH0KCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAgIC8vIENyZWF0ZSBhbmQgaW5zdGFsbCB0aGUgaGVhdG1hcAogICAgYXN5bmMgZnVuY3Rpb24gaW5zdGFsbF9oZWF0bWFwKHJldmlld3MsIGZvcmVjYXN0LCBsZXNzb25zLCBzdGF0cywgaXRlbXMpIHsKICAgICAgICBsZXQgc2V0dGluZ3MgPSB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0KICAgICAgICAvLyBDcmVhdGUgZWxlbWVudHMKICAgICAgICBsZXQgaGVhdG1hcCA9CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWF0bWFwJykgfHwKICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgdHlwZTogJ3NlY3Rpb24nLAogICAgICAgICAgICAgICAgaWQ6ICdoZWF0bWFwJywKICAgICAgICAgICAgICAgIGNsYXNzOiAnaGVhdG1hcCAnICsgKHNldHRpbmdzLm90aGVyLnZpc2libGVfbWFwID09PSAncmV2aWV3cycgPyAncmV2aWV3cycgOiAnJyksCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogc2V0dGluZ3MuZ2VuZXJhbC5wb3NpdGlvbiwKICAgICAgICAgICAgICAgIG9uY2xpY2s6IGRheV9jbGljayh7IHJldmlld3MsIGZvcmVjYXN0LCBsZXNzb25zIH0pLAogICAgICAgICAgICB9KQogICAgICAgIGxldCBidXR0b25zID0gY3JlYXRlX2J1dHRvbnMoKQogICAgICAgIGxldCB2aWV3cyA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAndmlld3MnIH0pCiAgICAgICAgaGVhdG1hcC5vbm1vdXNlZG93biA9IGhlYXRtYXAub25tb3VzZXVwID0gaGVhdG1hcC5vbm1vdXNlb3ZlciA9IGNsaWNrX2FuZF9kcmFnKHsgcmV2aWV3cywgZm9yZWNhc3QsIGxlc3NvbnMgfSkKICAgICAgICBoZWF0bWFwLnNldEF0dHJpYnV0ZSgndGhlbWUnLCBzZXR0aW5ncy5nZW5lcmFsLnRoZW1lKQogICAgICAgIGhlYXRtYXAuc3R5bGUuc2V0UHJvcGVydHkoCiAgICAgICAgICAgICctLWNvbG9yLW5vdycsCiAgICAgICAgICAgIHNldHRpbmdzLmdlbmVyYWwubm93X2luZGljYXRvciA/IHNldHRpbmdzLmdlbmVyYWwuY29sb3Jfbm93X2luZGljYXRvciA6ICd0cmFuc3BhcmVudCcsCiAgICAgICAgKQogICAgICAgIGhlYXRtYXAuc3R5bGUuc2V0UHJvcGVydHkoCiAgICAgICAgICAgICctLWNvbG9yLWxldmVsJywKICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5sZXZlbF9pbmRpY2F0b3IgPyBzZXR0aW5ncy5nZW5lcmFsLmNvbG9yX2xldmVsX2luZGljYXRvciA6ICd0cmFuc3BhcmVudCcsCiAgICAgICAgKQogICAgICAgIC8vIENyZWF0ZSBoZWF0bWFwcwogICAgICAgIGxldCBjb29rZWRfcmV2aWV3cyA9IGNvb2tfZGF0YSgncmV2aWV3cycsIHJldmlld3MpCiAgICAgICAgbGV0IGNvb2tlZF9sZXNzb25zID0gY29va19kYXRhKCdsZXNzb25zJywgbGVzc29ucykKICAgICAgICBsZXQgbGV2ZWxfdXBzID0gYXdhaXQgZ2V0X2xldmVsX3VwcyhpdGVtcykKICAgICAgICBsZXQgcmV2aWV3c192aWV3ID0gY3JlYXRlX3ZpZXcoCiAgICAgICAgICAgICdyZXZpZXdzJywKICAgICAgICAgICAgc3RhdHMsCiAgICAgICAgICAgIGxldmVsX3VwcywKICAgICAgICAgICAgcmV2aWV3c1swXVswXSwKICAgICAgICAgICAgZm9yZWNhc3QucmVkdWNlKChtYXgsIGEpID0+IChtYXggPiBhWzBdID8gbWF4IDogYVswXSksIDApLAogICAgICAgICAgICBjb29rZWRfcmV2aWV3cy5jb25jYXQoZm9yZWNhc3QpLAogICAgICAgICkKICAgICAgICBsZXQgbGVzc29uc192aWV3ID0gY3JlYXRlX3ZpZXcoCiAgICAgICAgICAgICdsZXNzb25zJywKICAgICAgICAgICAgc3RhdHMsCiAgICAgICAgICAgIGxldmVsX3VwcywKICAgICAgICAgICAgbGVzc29uc1swXVswXSwKICAgICAgICAgICAgbGVzc29ucy5yZWR1Y2UoKG1heCwgYSkgPT4gKG1heCA+IGFbMF0gPyBtYXggOiBhWzBdKSwgMCksCiAgICAgICAgICAgIGNvb2tlZF9sZXNzb25zLAogICAgICAgICkKICAgICAgICBsZXQgcG9wcGVyID0gY3JlYXRlX3BvcHBlcih7IHJldmlld3M6IGNvb2tlZF9yZXZpZXdzLCBmb3JlY2FzdCwgbGVzc29uczogY29va2VkX2xlc3NvbnMgfSkKICAgICAgICB2aWV3cy5hcHBlbmQocmV2aWV3c192aWV3LCBsZXNzb25zX3ZpZXcsIHBvcHBlcikKICAgICAgICAvLyBJbnN0YWxsCiAgICAgICAgaGVhdG1hcC5pbm5lckhUTUwgPSAnJwogICAgICAgIGhlYXRtYXAuYXBwZW5kKGJ1dHRvbnMsIHZpZXdzKQogICAgICAgIGxldCBwb3NpdGlvbiA9IFsKICAgICAgICAgICAgWycucHJvZ3Jlc3MtYW5kLWZvcmVjYXN0JywgJ2JlZm9yZWJlZ2luJ10sCiAgICAgICAgICAgIFsnLnByb2dyZXNzLWFuZC1mb3JlY2FzdCcsICdhZnRlcmVuZCddLAogICAgICAgICAgICBbJy5zcnMtcHJvZ3Jlc3MnLCAnYWZ0ZXJlbmQnXSwKICAgICAgICAgICAgWycuc3BhbjEyIC5yb3c6bm90KCNsZWFkZXJib2FyZCknLCAnYWZ0ZXJlbmQnXSwKICAgICAgICAgICAgWycuc3BhbjEyIC5yb3c6bGFzdC1vZi10eXBlJywgJ2FmdGVyZW5kJ10sCiAgICAgICAgXVtzZXR0aW5ncy5nZW5lcmFsLnBvc2l0aW9uXQogICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYXRtYXAnKSB8fCBoZWF0bWFwLmdldEF0dHJpYnV0ZSgncG9zaXRpb24nKSAhPSBzZXR0aW5ncy5nZW5lcmFsLnBvc2l0aW9uKQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvc2l0aW9uWzBdKS5pbnNlcnRBZGphY2VudEVsZW1lbnQocG9zaXRpb25bMV0sIGhlYXRtYXApCiAgICAgICAgaGVhdG1hcC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgc2V0dGluZ3MuZ2VuZXJhbC5wb3NpdGlvbikKICAgICAgICAvLyBGaXJlIGV2ZW50IHRvIGxldCBwZW9wbGUga25vdyBpdCdzIGZpbmlzaGVkIGxvYWRpbmcKICAgICAgICBmaXJlX2V2ZW50KCdoZWF0bWFwLWxvYWRlZCcsIGhlYXRtYXApCiAgICB9CgogICAgLy8gQ3JlYXRlcyB0aGUgYnV0dG9ucyBhdCB0aGUgdG9wIG9mIHRoZSBoZWF0bWFwCiAgICBmdW5jdGlvbiBjcmVhdGVfYnV0dG9ucygpIHsKICAgICAgICBsZXQgYnV0dG9ucyA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAnYnV0dG9ucycgfSkKICAgICAgICBhZGRfdHJhbnNpdGlvbnMoYnV0dG9ucykKICAgICAgICBsZXQgc2V0dGluZ3NfYnV0dG9uID0gY3JlYXRlX2VsZW0oewogICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgY2xhc3M6ICdzZXR0aW5ncy1idXR0b24gaG92ZXItd3JhcHBlci10YXJnZXQnLAogICAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdob3Zlci13cmFwcGVyIGFib3ZlJywgY2hpbGQ6ICdTZXR0aW5ncycgfSksCiAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7IHR5cGU6ICdpJywgY2xhc3M6ICdmYSBmYS1nZWFyJyB9KSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb25jbGljazogb3Blbl9zZXR0aW5ncywKICAgICAgICB9KQogICAgICAgIGxldCB0b2dnbGVfYnV0dG9uID0gY3JlYXRlX2VsZW0oewogICAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgICAgY2xhc3M6ICd0b2dnbGUtYnV0dG9uIGhvdmVyLXdyYXBwZXItdGFyZ2V0JywKICAgICAgICAgICAgY2hpbGRyZW46IFsKICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAnaG92ZXItd3JhcHBlciBhYm92ZScsIGNoaWxkOiAnVG9nZ2xlIHZpZXcnIH0pLAogICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnaScsIGNsYXNzOiAnZmEgZmEtaW5ib3gnIH0pLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvbmNsaWNrOiB0b2dnbGVfdmlzaWJsZV9tYXAsCiAgICAgICAgfSkKICAgICAgICBidXR0b25zLmFwcGVuZChzZXR0aW5nc19idXR0b24sIHRvZ2dsZV9idXR0b24pCiAgICAgICAgcmV0dXJuIGJ1dHRvbnMKICAgIH0KCiAgICAvLyBQcmVwYXJlcyBkYXRhIGZvciB0aGUgaGVhdG1hcAogICAgZnVuY3Rpb24gY29va19kYXRhKHR5cGUsIGRhdGEpIHsKICAgICAgICBpZiAodHlwZSA9PT0gJ3Jldmlld3MnKSB7CiAgICAgICAgICAgIGxldCBhbnMgPSAoc3JzLCBlcnIpID0+IHsKICAgICAgICAgICAgICAgIGxldCBzcnMyID0gc3JzIC0gTWF0aC5jZWlsKGVyciAvIDIpICogKHNycyA8IDUgPyAxIDogMikgKyAoZXJyID09IDAgPyAxIDogMCkKICAgICAgICAgICAgICAgIHJldHVybiBzcnMyIDwgMSA/IDEgOiBzcnMyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRhdGEubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgY29va2VkID0gWwogICAgICAgICAgICAgICAgICAgIGl0ZW1bMF0sCiAgICAgICAgICAgICAgICAgICAgeyByZXZpZXdzOiAxLCBwYXNzOiBpdGVtWzNdICsgaXRlbVs0XSA9PSAwID8gMSA6IDAsIGluY29ycmVjdDogaXRlbVszXSArIGl0ZW1bNF0sIHN0cmVhazogaXRlbVs1XSB9LAogICAgICAgICAgICAgICAgICAgIHsgJ3Jldmlld3MtaWRzJzogaXRlbVsxXSB9LAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgY29va2VkWzFdW3R5cGUgKyAnLXNyczEtJyArIGl0ZW1bMl1dID0gMQogICAgICAgICAgICAgICAgY29va2VkWzFdW3R5cGUgKyAnLXNyczItJyArIGFucyhpdGVtWzJdLCBpdGVtWzNdICsgaXRlbVs0XSldID0gMQogICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tlZAogICAgICAgICAgICB9KQogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2xlc3NvbnMnKQogICAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoKGl0ZW0pID0+IFtpdGVtWzBdLCB7IGxlc3NvbnM6IDEsIHN0cmVhazogaXRlbVs0XSB9LCB7ICdsZXNzb25zLWlkcyc6IGl0ZW1bMV0gfV0pCiAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZvcmVjYXN0JykgcmV0dXJuIGRhdGEKICAgIH0KCiAgICAvLyBDcmVhdGUgaGVhdG1hcHMgYW5kIHBlcmlwaGVyYWxzIHN1Y2ggYXMgc3RhdHMKICAgIGZ1bmN0aW9uIGNyZWF0ZV92aWV3KHR5cGUsIHN0YXRzLCBsZXZlbF91cHMsIGZpcnN0X2RhdGUsIGxhc3RfZGF0ZSwgZGF0YSkgewogICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgIGxldCBsZXZlbF9tYXJrcyA9IGxldmVsX3Vwcy5tYXAoKFtsZXZlbCwgZGF0ZV0pID0+IFtkYXRlLCAnbGV2ZWwtdXAnICsgKGxldmVsID09IDYwID8gJyBsZXZlbC02MCcgOiAnJyldKQogICAgICAgIC8vIE5ldyBoZWF0bWFwIGluc3RhbmNlCiAgICAgICAgbGV0IGhlYXRtYXAgPSBuZXcgSGVhdG1hcCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHlwZTogJ3llYXInLAogICAgICAgICAgICAgICAgaWQ6IHR5cGUsCiAgICAgICAgICAgICAgICB3ZWVrX3N0YXJ0OiBzZXR0aW5ncy5nZW5lcmFsLndlZWtfc3RhcnQsCiAgICAgICAgICAgICAgICBkYXlfc3RhcnQ6IHNldHRpbmdzLmdlbmVyYWwuZGF5X3N0YXJ0LAogICAgICAgICAgICAgICAgZmlyc3RfZGF0ZToKICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChuZXcgRGF0ZShzZXR0aW5ncy5nZW5lcmFsLnN0YXJ0X2RheSkuZ2V0VGltZSgpLCBmaXJzdF9kYXRlKSAtCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuZ2VuZXJhbC5kYXlfc3RhcnQgKiBtc2gsCiAgICAgICAgICAgICAgICBsYXN0X2RhdGU6IGxhc3RfZGF0ZSwKICAgICAgICAgICAgICAgIHNlZ21lbnRfeWVhcnM6IHNldHRpbmdzLmdlbmVyYWwuc2VnbWVudF95ZWFycywKICAgICAgICAgICAgICAgIHplcm9fZ2FwOiBzZXR0aW5ncy5nZW5lcmFsLnplcm9fZ2FwLAogICAgICAgICAgICAgICAgbWFya2luZ3M6IFtbbmV3IERhdGUoRGF0ZS5ub3coKSAtIG1zaCAqIHNldHRpbmdzLmdlbmVyYWwuZGF5X3N0YXJ0KSwgJ3RvZGF5J10sIC4uLmxldmVsX21hcmtzXSwKICAgICAgICAgICAgICAgIGRheV9ob3Zlcl9jYWxsYmFjazogKGRhdGUsIGRheV9kYXRhKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUyID0gdHlwZQogICAgICAgICAgICAgICAgICAgIGxldCB0aW1lID0gbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIDAsIDApLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTIgPT09ICdyZXZpZXdzJyAmJgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lID4gRGF0ZS5ub3coKSAtIG1zaCAqIHNldHRpbmdzLmdlbmVyYWwuZGF5X3N0YXJ0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGRheV9kYXRhLmNvdW50cy5mb3JlY2FzdAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTIgPSAnZm9yZWNhc3QnCiAgICAgICAgICAgICAgICAgICAgbGV0IHN0cmluZyA9IGAkeyhkYXlfZGF0YS5jb3VudHNbdHlwZTJdIHx8IDApLnRvTG9jYWxlU3RyaW5nKCl9ICR7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUyID09PSAnZm9yZWNhc3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyZXZpZXdzIHVwY29taW5nJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBkYXlfZGF0YS5jb3VudHNbdHlwZTJdID09PSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHR5cGUyLnNsaWNlKDAsIC0xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0eXBlMgogICAgICAgICAgICAgICAgICAgIH0gb24gJHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUodGltZSkudG9EYXRlU3RyaW5nKCkucmVwbGFjZSgvLi4uIC8sICcnKSArICcgJyArIGthbmppX2RheShuZXcgRGF0ZSh0aW1lKS5nZXREYXkoKSkKICAgICAgICAgICAgICAgICAgICB9YAogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lID49IG5ldyBEYXRlKHNldHRpbmdzLmdlbmVyYWwuc3RhcnRfZGF5KS5nZXRUaW1lKCkgJiYgdGltZSA+IGZpcnN0X2RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSBgXG5EYXkgJHsoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aW1lIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0ZS5wYXJzZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KGRhdGFbMF1bMF0sIG5ldyBEYXRlKHNldHRpbmdzLmdlbmVyYWwuc3RhcnRfZGF5KS5nZXRUaW1lKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS50b0RhdGVTdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSkgLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApICsgMQogICAgICAgICAgICAgICAgICAgICAgICApLnRvTG9jYWxlU3RyaW5nKCl9YAogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA8IERhdGUubm93KCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA+PSBuZXcgRGF0ZShzZXR0aW5ncy5nZW5lcmFsLnN0YXJ0X2RheSkuZ2V0VGltZSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUgPiBmaXJzdF9kYXRlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gYCwgU3RyZWFrICR7c3RhdHNbdHlwZV0uc3RyZWFrc1tuZXcgRGF0ZSh0aW1lKS50b0RhdGVTdHJpbmcoKV0gfHwgMH1gCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9ICdcbicKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUyID09PSAncmV2aWV3cycgJiYKICAgICAgICAgICAgICAgICAgICAgICAgZGF5X2RhdGEuY291bnRzLmZvcmVjYXN0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKHRpbWUpLnRvRGF0ZVN0cmluZygpID09IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IGBcbiR7ZGF5X2RhdGEuY291bnRzLmZvcmVjYXN0fSBtb3JlIHJldmlld3MgdXBjb21pbmdgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlMiAhPT0gJ2xlc3NvbnMnICYmIGRheV9kYXRhLmNvdW50c1t0eXBlMiArICctc3JzJyArICh0eXBlMiA9PT0gJ3Jldmlld3MnID8gJzItOScgOiAnMS04JyldKQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gJ1xuQnVybnMgJyArIGRheV9kYXRhLmNvdW50c1t0eXBlMiArICctc3JzJyArICh0eXBlMiA9PT0gJ3Jldmlld3MnID8gJzItOScgOiAnMS04JyldCiAgICAgICAgICAgICAgICAgICAgbGV0IGxldmVsID0gKGxldmVsX3Vwcy5maW5kKChhKSA9PiBhWzFdID09IG5ldyBEYXRlKHRpbWUpLnRvRGF0ZVN0cmluZygpKSB8fCBbdW5kZWZpbmVkXSlbMF0KICAgICAgICAgICAgICAgICAgICBpZiAobGV2ZWwpIHN0cmluZyArPSAnXG5Zb3UgcmVhY2hlZCBsZXZlbCAnICsgbGV2ZWwgKyAnIScKICAgICAgICAgICAgICAgICAgICBpZiAod2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLm90aGVyLnRpbWVzX3BvcHBlZCA8IDUgJiYgT2JqZWN0LmtleXMoZGF5X2RhdGEuY291bnRzKS5sZW5ndGggIT09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSAnXG5DbGljayBmb3IgZGV0YWlscyEnCiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0ub3RoZXIudGltZXNfcG9wcGVkID49IDUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLm90aGVyLnRpbWVzX2RyYWdnZWQgPCAzICYmCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRheV9kYXRhLmNvdW50cykubGVuZ3RoICE9PSAwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gJ1xuRGlkIHlvdSBrbm93IHRoYXQgeW91IGNhbiBjbGljayBhbmQgZHJhZywgdG9vPycKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3N0cmluZ10KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb2xvcl9jYWxsYmFjazogKGRhdGUsIGRheV9kYXRhKSA9PiBjb2xvcl9waWNrZXIodHlwZSwgZGF0ZSwgZGF5X2RhdGEpLAogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXRhLAogICAgICAgICkKICAgICAgICBtb2RpZnlfaGVhdG1hcCh0eXBlLCBoZWF0bWFwKQogICAgICAgIC8vIENyZWF0ZSBsYXlvdXQKICAgICAgICBsZXQgdmlldyA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiB0eXBlICsgJyB2aWV3JyB9KQogICAgICAgIGxldCB0aXRsZSA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAndGl0bGUnLCBjaGlsZDogdHlwZS50b1Byb3BlcigpIH0pCiAgICAgICAgbGV0IFtoZWFkX3N0YXRzLCBmb290X3N0YXRzXSA9IGNyZWF0ZV9zdGF0c19lbGVtZW50cyh0eXBlLCBzdGF0c1t0eXBlXSkKICAgICAgICBsZXQgeWVhcnMgPSBjcmVhdGVfZWxlbSh7IHR5cGU6ICdkaXYnLCBjbGFzczogJ3llYXJzJyArIChzZXR0aW5ncy5nZW5lcmFsLnJldmVyc2VfeWVhcnMgPyAnIHJldmVyc2UnIDogJycpIH0pCiAgICAgICAgaWYgKE1hdGgubWF4KC4uLk9iamVjdC5rZXlzKGhlYXRtYXAubWFwcykpID4gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5vdGhlci52aXNpYmxlX3llYXJzW3R5cGVdW25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSArIDFdICE9PSBmYWxzZSkKICAgICAgICAgICAgICAgIHllYXJzLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUtZnV0dXJlJykKICAgICAgICAgICAgeWVhcnMuY2xhc3NMaXN0LmFkZCgnaGFzLWZ1dHVyZScpCiAgICAgICAgfQogICAgICAgIHllYXJzLnNldEF0dHJpYnV0ZSgnbW9udGgtbGFiZWxzJywgc2V0dGluZ3MuZ2VuZXJhbC5tb250aF9sYWJlbHMpCiAgICAgICAgeWVhcnMuc2V0QXR0cmlidXRlKCdkYXktbGFiZWxzJywgc2V0dGluZ3MuZ2VuZXJhbC5kYXlfbGFiZWxzKQogICAgICAgIGZvciAobGV0IHllYXIgb2YgT2JqZWN0LnZhbHVlcyhoZWF0bWFwLm1hcHMpLnJldmVyc2UoKSkgeWVhcnMucHJlcGVuZCh5ZWFyKQogICAgICAgIHZpZXcuYXBwZW5kKHRpdGxlLCBoZWFkX3N0YXRzLCB5ZWFycywgZm9vdF9zdGF0cykKICAgICAgICByZXR1cm4gdmlldwogICAgfQoKICAgIC8vIE1ha2UgY2hhbmdlcyB0byB0aGUgaGVhdG1hcCBvYmplY3QgYmVmb3JlIGl0IGlzIGRpc3BsYXllZAogICAgZnVuY3Rpb24gbW9kaWZ5X2hlYXRtYXAodHlwZSwgaGVhdG1hcCkgewogICAgICAgIGZvciAobGV0IFt5ZWFyLCBtYXBdIG9mIE9iamVjdC5lbnRyaWVzKGhlYXRtYXAubWFwcykpIHsKICAgICAgICAgICAgbGV0IHRhcmdldCA9IG1hcC5xdWVyeVNlbGVjdG9yKCcueWVhci1sYWJlbHMnKQogICAgICAgICAgICBsZXQgdXAgPSBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICB0eXBlOiAnYScsCiAgICAgICAgICAgICAgICBjbGFzczogJ3RvZ2dsZS15ZWFyIHVwIGhvdmVyLXdyYXBwZXItdGFyZ2V0JywKICAgICAgICAgICAgICAgIG9uY2xpY2s6IHRvZ2dsZV95ZWFyLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IFsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogJ2hvdmVyLXdyYXBwZXIgYWJvdmUnLAogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDogY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ2xpY2sgdG8gJyArICh5ZWFyID09IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSA/ICdzaG93IG5leHQnIDogJ2hpZGUgdGhpcycpICsgJyB5ZWFyJywKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnaScsIGNsYXNzOiAnZmEgZmEtY2hldnJvbi11cCcgfSksCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9KQogICAgICAgICAgICBsZXQgZG93biA9IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdhJywKICAgICAgICAgICAgICAgIGNsYXNzOiAndG9nZ2xlLXllYXIgZG93biBob3Zlci13cmFwcGVyLXRhcmdldCcsCiAgICAgICAgICAgICAgICBvbmNsaWNrOiB0b2dnbGVfeWVhciwKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JywKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdob3Zlci13cmFwcGVyIGJlbG93JywKICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQ6IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NsaWNrIHRvICcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh5ZWFyIDw9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSA/ICdzaG93IHByZXZpb3VzJyA6ICdoaWRlIHRoaXMnKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyB5ZWFyJywKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnaScsIGNsYXNzOiAnZmEgZmEtY2hldnJvbi1kb3duJyB9KSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRhcmdldC5hcHBlbmQodXAsIGRvd24pCiAgICAgICAgICAgIGlmICh3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0ub3RoZXIudmlzaWJsZV95ZWFyc1t0eXBlXVt5ZWFyXSA9PT0gZmFsc2UpIG1hcC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKQogICAgICAgIH0KICAgIH0KCiAgICAvLyBDcmVhdGUgdGhlIGhlYWRlciBhbmQgZm9vdGVyIHN0YXRzIGZvciBhIHZpZXcKICAgIGZ1bmN0aW9uIGNyZWF0ZV9zdGF0c19lbGVtZW50cyh0eXBlLCBzdGF0cykgewogICAgICAgIC8vIENyZWF0ZSBhbiBzaW5nbGUgc3RhdCBlbGVtZW50IGNvbXBsZXRlIHdpdGggaG92ZXIgaW5mbwogICAgICAgIGxldCBjcmVhdGVfc3RhdF9lbGVtZW50ID0gKGxhYmVsLCB2YWx1ZSwgaG92ZXIpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgY2xhc3M6ICdzdGF0IGhvdmVyLXdyYXBwZXItdGFyZ2V0JywKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdob3Zlci13cmFwcGVyIGFib3ZlJywgY2hpbGQ6IGhvdmVyIH0pLAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsgdHlwZTogJ3NwYW4nLCBjbGFzczogJ3N0YXQtbGFiZWwnLCBjaGlsZDogbGFiZWwgfSksCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnc3BhbicsIGNsYXNzOiAndmFsdWUnLCBjaGlsZDogdmFsdWUgfSksCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICAvLyBDcmVhdGUgdGhlIGVsZW1lbnRzCiAgICAgICAgbGV0IGhlYWRfc3RhdHMgPSBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICBjbGFzczogJ2hlYWQtc3RhdHMgc3RhdHMnLAogICAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICAgICAgY3JlYXRlX3N0YXRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICAnRGF5cyBTdHVkaWVkJywKICAgICAgICAgICAgICAgICAgICBzdGF0cy5kYXlzX3N0dWRpZWRbMV0gKyAnJScsCiAgICAgICAgICAgICAgICAgICAgc3RhdHMuZGF5c19zdHVkaWVkWzBdLnRvTG9jYWxlU3RyaW5nKCkgKyAnIG91dCBvZiAnICsgc3RhdHMuZGF5cy50b0xvY2FsZVN0cmluZygpLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIGNyZWF0ZV9zdGF0X2VsZW1lbnQoCiAgICAgICAgICAgICAgICAgICAgJ0RvbmUgRGFpbHknLAogICAgICAgICAgICAgICAgICAgIHN0YXRzLmF2ZXJhZ2VbMF0gKyAnIC8gJyArIChzdGF0cy5hdmVyYWdlWzFdIHx8IDApLAogICAgICAgICAgICAgICAgICAgICdQZXIgRGF5IC8gRGF5cyBzdHVkaWVkXG5NYXg6ICcgKyBzdGF0cy5tYXhfZG9uZVswXS50b0xvY2FsZVN0cmluZygpICsgJyBvbiAnICsgc3RhdHMubWF4X2RvbmVbMV0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgY3JlYXRlX3N0YXRfZWxlbWVudCgnU3RyZWFrJywgc3RhdHMuc3RyZWFrWzFdICsgJyAvICcgKyBzdGF0cy5zdHJlYWtbMF0sICdDdXJyZW50IC8gTG9uZ2VzdCcpLAogICAgICAgICAgICBdLAogICAgICAgIH0pCiAgICAgICAgbGV0IGZvb3Rfc3RhdHMgPSBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICBjbGFzczogJ2Zvb3Qtc3RhdHMgc3RhdHMnLAogICAgICAgICAgICBjaGlsZHJlbjogWwogICAgICAgICAgICAgICAgY3JlYXRlX3N0YXRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICAnU2Vzc2lvbnMnLAogICAgICAgICAgICAgICAgICAgIHN0YXRzLnNlc3Npb25zLnRvTG9jYWxlU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgKE1hdGguZmxvb3Ioc3RhdHMudG90YWxbMF0gLyBzdGF0cy5zZXNzaW9ucykgfHwgMCkgKyAnIHBlciBzZXNzaW9uJywKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBjcmVhdGVfc3RhdF9lbGVtZW50KAogICAgICAgICAgICAgICAgICAgIHR5cGUudG9Qcm9wZXIoKSwKICAgICAgICAgICAgICAgICAgICBzdGF0cy50b3RhbFswXS50b0xvY2FsZVN0cmluZygpLAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZV90YWJsZSgnbGVmdCcsIFsKICAgICAgICAgICAgICAgICAgICAgICAgWydZZWFyJywgc3RhdHMudG90YWxbMV0udG9Mb2NhbGVTdHJpbmcoKV0sCiAgICAgICAgICAgICAgICAgICAgICAgIFsnTW9udGgnLCBzdGF0cy50b3RhbFsyXS50b0xvY2FsZVN0cmluZygpXSwKICAgICAgICAgICAgICAgICAgICAgICAgWydXZWVrJywgc3RhdHMudG90YWxbM10udG9Mb2NhbGVTdHJpbmcoKV0sCiAgICAgICAgICAgICAgICAgICAgICAgIFsnMjRoJywgc3RhdHMudG90YWxbNF0udG9Mb2NhbGVTdHJpbmcoKV0sCiAgICAgICAgICAgICAgICAgICAgXSksCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgY3JlYXRlX3N0YXRfZWxlbWVudCgKICAgICAgICAgICAgICAgICAgICAnVGltZScsCiAgICAgICAgICAgICAgICAgICAgbV90b19obShzdGF0cy50aW1lWzBdKSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVfdGFibGUoJ2xlZnQnLCBbCiAgICAgICAgICAgICAgICAgICAgICAgIFsnWWVhcicsIG1fdG9faG0oc3RhdHMudGltZVsxXSldLAogICAgICAgICAgICAgICAgICAgICAgICBbJ01vbnRoJywgbV90b19obShzdGF0cy50aW1lWzJdKV0sCiAgICAgICAgICAgICAgICAgICAgICAgIFsnV2VlaycsIG1fdG9faG0oc3RhdHMudGltZVszXSldLAogICAgICAgICAgICAgICAgICAgICAgICBbJzI0aCcsIG1fdG9faG0oc3RhdHMudGltZVs0XSldLAogICAgICAgICAgICAgICAgICAgIF0pLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgXSwKICAgICAgICB9KQogICAgICAgIGFkZF90cmFuc2l0aW9ucyhoZWFkX3N0YXRzKQogICAgICAgIGFkZF90cmFuc2l0aW9ucyhmb290X3N0YXRzKQogICAgICAgIHJldHVybiBbaGVhZF9zdGF0cywgZm9vdF9zdGF0c10KICAgIH0KCiAgICAvLyBBZGQgaG92ZXIgdHJhbnNpdGlvbgogICAgZnVuY3Rpb24gYWRkX3RyYW5zaXRpb25zKGVsZW0pIHsKICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChldmVudCkgPT4gewogICAgICAgICAgICBjb25zdCBlbGVtID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5ob3Zlci13cmFwcGVyLXRhcmdldCcpCiAgICAgICAgICAgIGlmICghZWxlbSkgcmV0dXJuCiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnaGVhdG1hcC10cmFuc2l0aW9uJykKICAgICAgICAgICAgc2V0VGltZW91dCgoXykgPT4gZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdoZWF0bWFwLXRyYW5zaXRpb24nKSwgMjApCiAgICAgICAgfSkKICAgIH0KCiAgICAvLyBJbml0aWF0ZXMgdGhlIHBvcHBlciBlbGVtZW50CiAgICBmdW5jdGlvbiBjcmVhdGVfcG9wcGVyKGRhdGEpIHsKICAgICAgICAvLyBDcmVhdGUgbGF5b3V0CiAgICAgICAgbGV0IHBvcHBlciA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGlkOiAncG9wcGVyJyB9KQogICAgICAgIGxldCBoZWFkZXIgPSBjcmVhdGVfZWxlbSh7IHR5cGU6ICdkaXYnLCBjbGFzczogJ2hlYWRlcicgfSkKICAgICAgICBsZXQgbWluaW1hcCA9IGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgIGNsYXNzOiAnbWluaW1hcCcsCiAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7IHR5cGU6ICdzcGFuJywgY2xhc3M6ICdtaW5pbWFwLWxhYmVsJywgY2hpbGQ6ICdIb3VycyBtaW5pbWFwJyB9KSwKICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAnaG91cnMtbWFwJyB9KSwKICAgICAgICAgICAgXSwKICAgICAgICB9KQogICAgICAgIGxldCBzdGF0cyA9IGNyZWF0ZV9lbGVtKHsgdHlwZTogJ2RpdicsIGNsYXNzOiAnc3RhdHMnIH0pCiAgICAgICAgbGV0IGl0ZW1zID0gY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdpdGVtcycgfSkKICAgICAgICBwb3BwZXIuYXBwZW5kKGhlYWRlciwgbWluaW1hcCwgc3RhdHMsIGl0ZW1zKQogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGlmICghZXZlbnQuY29tcG9zZWRQYXRoKCkuZmluZCgoYSkgPT4gYSA9PT0gcG9wcGVyIHx8IChhLmNsYXNzTGlzdCAmJiBhLmNsYXNzTGlzdC5jb250YWlucygneWVhcnMnKSkpKQogICAgICAgICAgICAgICAgcG9wcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHBlZCcpCiAgICAgICAgfSkKICAgICAgICAvLyBDcmVhdGUgaGVhZGVyCiAgICAgICAgaGVhZGVyLmFwcGVuZCgKICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdkYXRlJyB9KSwKICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICBjbGFzczogJ3N1YmhlYWRlcicsCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW2NyZWF0ZV9lbGVtKHsgdHlwZTogJ3NwYW4nLCBjbGFzczogJ2NvdW50JyB9KSwgY3JlYXRlX2VsZW0oeyB0eXBlOiAnc3BhbicsIGNsYXNzOiAndGltZScgfSldLAogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsCiAgICAgICAgICAgICAgICBjbGFzczogJ3Njb3JlIGhvdmVyLXdyYXBwZXItdGFyZ2V0JywKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdob3Zlci13cmFwcGVyIGFib3ZlJywgY2hpbGQ6ICdOZXQgcHJvZ3Jlc3Mgb2YgU1JTIGxldmVscycgfSksCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oeyB0eXBlOiAnc3BhbicgfSksCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9KSwKICAgICAgICApCiAgICAgICAgLy8gQ3JlYXRlIG1pbmltYXAgYW5kIHN0YXRzCiAgICAgICAgc3RhdHMuYXBwZW5kKAogICAgICAgICAgICBjcmVhdGVfdGFibGUoCiAgICAgICAgICAgICAgICAnbGVmdCcsCiAgICAgICAgICAgICAgICBbWydMZXZlbHMnXSwgWycgMS0xMCcsIDBdLCBbJzExLTIwJywgMF0sIFsnMjEtMzAnLCAwXSwgWyczMS00MCcsIDBdLCBbJzQxLTUwJywgMF0sIFsnNTEtNjAnLCAwXV0sCiAgICAgICAgICAgICAgICB7IGNsYXNzOiAnbGV2ZWxzJyB9LAogICAgICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgY3JlYXRlX3RhYmxlKAogICAgICAgICAgICAgICAgJ2xlZnQnLAogICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgIFsnU1JTJ10sCiAgICAgICAgICAgICAgICAgICAgWydCZWZvcmUgLyBBZnRlciddLAogICAgICAgICAgICAgICAgICAgIFsnQXBwJywgMCwgMF0sCiAgICAgICAgICAgICAgICAgICAgWydHdXInLCAwLCAwXSwKICAgICAgICAgICAgICAgICAgICBbJ01hcycsIDAsIDBdLAogICAgICAgICAgICAgICAgICAgIFsnRW5sJywgMCwgMF0sCiAgICAgICAgICAgICAgICAgICAgWydCdXInLCAwLCAwXSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzcnMgaG92ZXItd3JhcHBlci10YXJnZXQnLAogICAgICAgICAgICAgICAgICAgIGNoaWxkOiBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogJ2hvdmVyLXdyYXBwZXIgYmVsb3cnLAogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDogY3JlYXRlX2VsZW0oeyB0eXBlOiAndGFibGUnIH0pLAogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgY3JlYXRlX3RhYmxlKCdsZWZ0JywgW1snVHlwZSddLCBbJ1JhZCcsIDBdLCBbJ0thbicsIDBdLCBbJ1ZvYycsIDBdXSwgeyBjbGFzczogJ3R5cGUnIH0pLAogICAgICAgICAgICBjcmVhdGVfdGFibGUoJ2xlZnQnLCBbWydTdW1tYXJ5J10sIFsnUGFzcycsIDBdLCBbJ0ZhaWwnLCAwXSwgWydBY2MnLCAwXV0sIHsgY2xhc3M6ICdzdW1tYXJ5JyB9KSwKICAgICAgICAgICAgY3JlYXRlX3RhYmxlKCdsZWZ0JywgW1snQW5zd2VycyddLCBbJ1JpZ2h0JywgMF0sIFsnV3JvbmcnLCAwXSwgWydBY2MnLCAwXV0sIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAnYW5zd2VycyBob3Zlci13cmFwcGVyLXRhcmdldCcsCiAgICAgICAgICAgICAgICBjaGlsZDogY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnaG92ZXItd3JhcHBlciBhYm92ZScsCiAgICAgICAgICAgICAgICAgICAgY2hpbGQ6ICdUaGUgdG90YWwgbnVtYmVyIG9mIGNvcnJlY3QgYW5kIGluY29ycmVjdCBhbnN3ZXJzJywKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICB9KSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIHBvcHBlcgogICAgfQoKICAgIC8vIENyZWF0ZXMgYSBuZXcgbWluaW1hcCBmb3IgdGhlIHBvcHBlcgogICAgZnVuY3Rpb24gY3JlYXRlX21pbmltYXAodHlwZSwgZGF0YSkgewogICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgIGxldCBtdWx0aXBsaWVyID0gMgogICAgICAgIHJldHVybiBuZXcgSGVhdG1hcCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHlwZTogJ2RheScsCiAgICAgICAgICAgICAgICBpZDogJ2hvdXJzLW1hcCcsCiAgICAgICAgICAgICAgICBmaXJzdF9kYXRlOiBEYXRlLnBhcnNlKG5ldyBEYXRlKGRhdGFbMF1bMF0gLSBzZXR0aW5ncy5nZW5lcmFsLmRheV9zdGFydCAqIG1zaCkudG9EYXRlU3RyaW5nKCkpLAogICAgICAgICAgICAgICAgbGFzdF9kYXRlOiBEYXRlLnBhcnNlKG5ldyBEYXRlKGRhdGFbMF1bMF0gKyBtc2QgLSBzZXR0aW5ncy5nZW5lcmFsLmRheV9zdGFydCAqIG1zaCkudG9EYXRlU3RyaW5nKCkpLAogICAgICAgICAgICAgICAgZGF5X3N0YXJ0OiBzZXR0aW5ncy5nZW5lcmFsLmRheV9zdGFydCwKICAgICAgICAgICAgICAgIGRheV9ob3Zlcl9jYWxsYmFjazogKGRhdGUsIGRheV9kYXRhKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUyID0gdHlwZQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlMiA9PT0gJ3Jldmlld3MnICYmIERhdGUucGFyc2UoZGF0ZS5qb2luKCctJykpID4gRGF0ZS5ub3coKSAmJiBkYXlfZGF0YS5jb3VudHMuZm9yZWNhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUyID0gJ2ZvcmVjYXN0JwogICAgICAgICAgICAgICAgICAgIGxldCBzdHJpbmcgPSBbCiAgICAgICAgICAgICAgICAgICAgICAgIGAkeyhkYXlfZGF0YS5jb3VudHNbdHlwZTJdIHx8IDApLnRvTG9jYWxlU3RyaW5nKCl9ICR7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlMiA9PT0gJ2ZvcmVjYXN0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gJ3Jldmlld3MgdXBjb21pbmcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBkYXlfZGF0YS5jb3VudHNbdHlwZTJdID09PSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0eXBlMi5zbGljZSgwLCAtMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHR5cGUyCiAgICAgICAgICAgICAgICAgICAgICAgIH0gYXQgJHtkYXRlWzNdfTowMGAsCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlMiAhPT0gJ2xlc3NvbnMnICYmIGRheV9kYXRhLmNvdW50c1t0eXBlMiArICctc3JzJyArICh0eXBlMiA9PT0gJ3Jldmlld3MnID8gJzItOScgOiAnMS04JyldKQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gJ1xuQnVybnMgJyArIGRheV9kYXRhLmNvdW50c1t0eXBlMiArICctc3JzJyArICh0eXBlMiA9PT0gJ3Jldmlld3MnID8gJzItOScgOiAnMS04JyldCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbG9yX2NhbGxiYWNrOiAoZGF0ZSwgZGF5X2RhdGEpID0+IGNvbG9yX3BpY2tlcih0eXBlLCBkYXRlLCBkYXlfZGF0YSwgMiksCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgKQogICAgfQoKICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogICAgLy8gQXV0b21hdGljYWxseSBkZXRlcm1pbmVzIHdoYXQgdGhlIHVzZXIncyBpbnRlcnZhbCBib3VuZHMgc2hvdWxkIGJlIHVzaW5nIHF1YW50aWxlcwogICAgZnVuY3Rpb24gYXV0b19yYW5nZShzdGF0cywgZm9yZWNhc3RfaXRlbXMpIHsKICAgICAgICBsZXQgc2V0dGluZ3MgPSB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0KICAgICAgICAvLyBGb3JlY2FzdCBuZWVkcyB0byBoYXZlIHNvbWUgY2FsY3VsYXRpb25zIGRvbmUKICAgICAgICBsZXQgZm9yZWNhc3RfZGF5cyA9IHt9CiAgICAgICAgZm9yIChsZXQgW2RhdGVdIG9mIE9iamVjdC52YWx1ZXMoZm9yZWNhc3RfaXRlbXMpKSB7CiAgICAgICAgICAgIGxldCBzdHJpbmcgPSBuZXcgRGF0ZShkYXRlKS50b0RhdGVTdHJpbmcoKQogICAgICAgICAgICBpZiAoIWZvcmVjYXN0X2RheXNbc3RyaW5nXSkgZm9yZWNhc3RfZGF5c1tzdHJpbmddID0gMQogICAgICAgICAgICBlbHNlIGZvcmVjYXN0X2RheXNbc3RyaW5nXSsrCiAgICAgICAgfQogICAgICAgIGxldCBmb3JlY2FzdF9tZWFuID0gZm9yZWNhc3RfaXRlbXMubGVuZ3RoIC8gT2JqZWN0LmtleXMoZm9yZWNhc3RfZGF5cykubGVuZ3RoCiAgICAgICAgbGV0IGZvcmVjYXN0X3NkID0KICAgICAgICAgICAgTWF0aC5zcXJ0KAogICAgICAgICAgICAgICAgKDEgLyAoZm9yZWNhc3RfaXRlbXMubGVuZ3RoIC8gZm9yZWNhc3RfbWVhbikpICoKICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGZvcmVjYXN0X2RheXMpCiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKHgpID0+IE1hdGgucG93KHggLSBmb3JlY2FzdF9tZWFuLCAyKSkKICAgICAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApLAogICAgICAgICAgICApIHx8IDEKICAgICAgICAvLyBHZXQgaW50ZXJ2YWxzCiAgICAgICAgbGV0IHJhbmdlID0gKGxlbmd0aCwgZ3JhZGllbnQsIG1lYW4sIHNkKSA9PiBbCiAgICAgICAgICAgIDEsCiAgICAgICAgICAgIC4uLkFycmF5KChsZW5ndGggPCAyID8gMiA6IGxlbmd0aCkgLSAyKQogICAgICAgICAgICAgICAgLmZpbGwobnVsbCkKICAgICAgICAgICAgICAgIC5tYXAoKF8sIGkpID0+CiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChpZmNkZigoKGdyYWRpZW50ID8gMC45IDogMSkgKiAoaSArIDEpKSAvIChsZW5ndGggLSAoZ3JhZGllbnQgPyAxIDogMCkpLCBtZWFuLCBzZCkpLAogICAgICAgICAgICAgICAgKSwKICAgICAgICBdCiAgICAgICAgbGV0IHJldmlld3MgPSByYW5nZSgKICAgICAgICAgICAgc2V0dGluZ3MucmV2aWV3cy5jb2xvcnMubGVuZ3RoLAogICAgICAgICAgICBzZXR0aW5ncy5yZXZpZXdzLmdyYWRpZW50LAogICAgICAgICAgICBzdGF0cy5yZXZpZXdzLmF2ZXJhZ2VbMV0sCiAgICAgICAgICAgIHN0YXRzLnJldmlld3MuYXZlcmFnZVsyXSwKICAgICAgICApCiAgICAgICAgbGV0IGxlc3NvbnMgPSByYW5nZSgKICAgICAgICAgICAgc2V0dGluZ3MubGVzc29ucy5jb2xvcnMubGVuZ3RoLAogICAgICAgICAgICBzZXR0aW5ncy5sZXNzb25zLmdyYWRpZW50LAogICAgICAgICAgICBzdGF0cy5sZXNzb25zLmF2ZXJhZ2VbMV0sCiAgICAgICAgICAgIHN0YXRzLmxlc3NvbnMuYXZlcmFnZVsyXSwKICAgICAgICApCiAgICAgICAgbGV0IGZvcmVjYXN0ID0gcmFuZ2Uoc2V0dGluZ3MuZm9yZWNhc3QuY29sb3JzLmxlbmd0aCwgc2V0dGluZ3MuZm9yZWNhc3QuZ3JhZGllbnQsIGZvcmVjYXN0X21lYW4sIGZvcmVjYXN0X3NkKQogICAgICAgIGlmIChzZXR0aW5ncy5yZXZpZXdzLmF1dG9fcmFuZ2UpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc2V0dGluZ3MucmV2aWV3cy5jb2xvcnMubGVuZ3RoOyBpKyspIHNldHRpbmdzLnJldmlld3MuY29sb3JzW2ldWzBdID0gcmV2aWV3c1tpIC0gMV0KICAgICAgICBpZiAoc2V0dGluZ3MubGVzc29ucy5hdXRvX3JhbmdlKQogICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNldHRpbmdzLmxlc3NvbnMuY29sb3JzLmxlbmd0aDsgaSsrKSBzZXR0aW5ncy5sZXNzb25zLmNvbG9yc1tpXVswXSA9IGxlc3NvbnNbaSAtIDFdCiAgICAgICAgaWYgKHNldHRpbmdzLmZvcmVjYXN0LmF1dG9fcmFuZ2UpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc2V0dGluZ3MuZm9yZWNhc3QuY29sb3JzLmxlbmd0aDsgaSsrKSBzZXR0aW5ncy5mb3JlY2FzdC5jb2xvcnNbaV1bMF0gPSBmb3JlY2FzdFtpIC0gMV0KICAgICAgICB3a29mLlNldHRpbmdzLnNhdmUoc2NyaXB0X2lkKQogICAgfQoKICAgIC8vIFBpY2tzIGNvbG9ycyBmb3IgdGhlIGhlYXRtYXAgZGF5cwogICAgZnVuY3Rpb24gY29sb3JfcGlja2VyKHR5cGUsIGRhdGUsIGRheV9kYXRhLCBtdWx0aXBsaWVyID0gMSkgewogICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgIGxldCB0eXBlMiA9IHR5cGUKICAgICAgICBpZiAoCiAgICAgICAgICAgIHR5cGUyID09PSAncmV2aWV3cycgJiYKICAgICAgICAgICAgbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIDAsIDApLmdldFRpbWUoKSA+IERhdGUubm93KCkgLSBtc2ggKiBzZXR0aW5ncy5nZW5lcmFsLmRheV9zdGFydCAmJgogICAgICAgICAgICBkYXlfZGF0YS5jb3VudHMuZm9yZWNhc3QKICAgICAgICApCiAgICAgICAgICAgIHR5cGUyID0gJ2ZvcmVjYXN0JwogICAgICAgIGxldCBjb2xvcnMgPSBzZXR0aW5nc1t0eXBlMl0uY29sb3JzCiAgICAgICAgLy8gSWYgZ3JhZGllbnRzIGFyZSBub3QgZW5hYmxlZCwgdXNlIGludGVydmFscwogICAgICAgIGlmICghc2V0dGluZ3NbdHlwZTJdLmdyYWRpZW50KSB7CiAgICAgICAgICAgIGZvciAobGV0IFtib3VuZCwgY29sb3JdIG9mIGNvbG9ycy5zbGljZSgpLnJldmVyc2UoKSkgewogICAgICAgICAgICAgICAgaWYgKGRheV9kYXRhLmNvdW50c1t0eXBlMl0gKiBtdWx0aXBsaWVyID49IGJvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbG9yc1swXVsxXQogICAgICAgICAgICAvLyBJZiBncmFkaWVudHMgYXJlIGVuYWJsZWQsIGludGVycG9sYXRlIGNvbG9ycwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE11bHRpcGxpZXIgaXMgdXNlZCBmb3IgbWluaW1hcCB0byBnZXQgYmV0dGVyIHJhbmdlcwogICAgICAgICAgICBpZiAoIWRheV9kYXRhLmNvdW50c1t0eXBlMl0gKiBtdWx0aXBsaWVyKSByZXR1cm4gY29sb3JzWzBdWzFdCiAgICAgICAgICAgIGlmIChkYXlfZGF0YS5jb3VudHNbdHlwZTJdICogbXVsdGlwbGllciA+PSBjb2xvcnNbY29sb3JzLmxlbmd0aCAtIDFdWzBdKSByZXR1cm4gY29sb3JzW2NvbG9ycy5sZW5ndGggLSAxXVsxXQogICAgICAgICAgICBmb3IgKGxldCBpID0gMjsgaSA8IGNvbG9ycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGRheV9kYXRhLmNvdW50c1t0eXBlMl0gKiBtdWx0aXBsaWVyIDw9IGNvbG9yc1tpXVswXSkgewogICAgICAgICAgICAgICAgICAgIGxldCBwZXJjZW50YWdlID0KICAgICAgICAgICAgICAgICAgICAgICAgKGRheV9kYXRhLmNvdW50c1t0eXBlMl0gKiBtdWx0aXBsaWVyIC0gY29sb3JzW2kgLSAxXVswXSkgLyAoY29sb3JzW2ldWzBdIC0gY29sb3JzW2kgLSAxXVswXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50ZXJwb2xhdGVfY29sb3IoY29sb3JzW2kgLSAxXVsxXSwgY29sb3JzW2ldWzFdLCBwZXJjZW50YWdlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRvZ2dsZXMgYmV0d2VlbiBsZXNzb25zIGFuZCByZXZpZXdzCiAgICBmdW5jdGlvbiB0b2dnbGVfdmlzaWJsZV9tYXAoKSB7CiAgICAgICAgbGV0IGhlYXRtYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhdG1hcCcpCiAgICAgICAgaGVhdG1hcC5jbGFzc0xpc3QudG9nZ2xlKCdyZXZpZXdzJykKICAgICAgICB3a29mLnNldHRpbmdzW3NjcmlwdF9pZF0ub3RoZXIudmlzaWJsZV9tYXAgPSBoZWF0bWFwLmNsYXNzTGlzdC5jb250YWlucygncmV2aWV3cycpID8gJ3Jldmlld3MnIDogJ2xlc3NvbnMnCiAgICAgICAgd2tvZi5TZXR0aW5ncy5zYXZlKHNjcmlwdF9pZCkKICAgIH0KCiAgICAvLyBUb2dnbGVzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSB5ZWFycwogICAgZnVuY3Rpb24gdG9nZ2xlX3llYXIoZXZlbnQpIHsKICAgICAgICBsZXQgdmlzaWJsZV95ZWFycyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5vdGhlci52aXNpYmxlX3llYXJzCiAgICAgICAgbGV0IHllYXJfZWxlbSA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcueWVhcicpCiAgICAgICAgbGV0IHVwID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy50b2dnbGUteWVhcicpLmNsYXNzTGlzdC5jb250YWlucygndXAnKQogICAgICAgIGxldCB5ZWFyID0gTnVtYmVyKHllYXJfZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEteWVhcicpKQogICAgICAgIGxldCBmdXR1cmUgPSB5ZWFyID4gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpCiAgICAgICAgbGV0IHR5cGUgPSB5ZWFyX2VsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXZpZXdzJykgPyAncmV2aWV3cycgOiAnbGVzc29ucycKICAgICAgICBpZiAodXAgfHwgKCF1cCAmJiBmdXR1cmUpKSB7CiAgICAgICAgICAgIGlmICh5ZWFyID09IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSkgewogICAgICAgICAgICAgICAgdmlzaWJsZV95ZWFyc1t0eXBlXVt5ZWFyICsgMV0gPSB0cnVlCiAgICAgICAgICAgICAgICB5ZWFyX2VsZW0ubmV4dEVsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpCiAgICAgICAgICAgICAgICB5ZWFyX2VsZW0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlLWZ1dHVyZScpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2aXNpYmxlX3llYXJzW3R5cGVdW3llYXJdID0gZmFsc2UKICAgICAgICAgICAgICAgIHllYXJfZWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKQogICAgICAgICAgICAgICAgaWYgKCF1cCAmJiBmdXR1cmUpIHllYXJfZWxlbS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUtZnV0dXJlJykKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZpc2libGVfeWVhcnNbdHlwZV1beWVhciAtIDFdID0gdHJ1ZQogICAgICAgICAgICB5ZWFyX2VsZW0ucHJldmlvdXNFbGVtZW50U2libGluZy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKQogICAgICAgIH0KICAgICAgICAvLyBNYWtlIHN1cmUgYXQgbGVhc3Qgb25lIHllYXIgaXMgdmlzaWJsZQogICAgICAgIGlmICghT2JqZWN0LnZhbHVlcyh2aXNpYmxlX3llYXJzW3R5cGVdKS5maW5kKChhKSA9PiBhID09IHRydWUpKSB7CiAgICAgICAgICAgIHZpc2libGVfeWVhcnNbdHlwZV1beWVhcl0gPSB0cnVlCiAgICAgICAgfQogICAgICAgIHdrb2YuU2V0dGluZ3Muc2F2ZShzY3JpcHRfaWQpCiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgcG9wcGVyIHdpdGggbmV3IGluZm8KICAgIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZV9wb3BwZXIoZXZlbnQsIHR5cGUsIHRpdGxlLCBpbmZvLCBtaW5pbWFwX2RhdGEsIGJ1cm5zLCB0aW1lKSB7CiAgICAgICAgbGV0IGl0ZW1zX2lkID0gYXdhaXQgd2tvZi5JdGVtRGF0YS5nZXRfaW5kZXgoYXdhaXQgd2tvZi5JdGVtRGF0YS5nZXRfaXRlbXMoJ2luY2x1ZGVfaGlkZGVuJyksICdzdWJqZWN0X2lkJykKICAgICAgICBsZXQgcG9wcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHBlcicpCiAgICAgICAgLy8gR2V0IGluZm8KICAgICAgICBsZXQgbGV2ZWxzID0gbmV3IEFycmF5KDYxKS5maWxsKDApCiAgICAgICAgbGV2ZWxzWzBdID0gbmV3IEFycmF5KDYpLmZpbGwoMCkKICAgICAgICBsZXQgaXRlbV90eXBlcyA9IHsgcmFkOiAwLCBrYW46IDAsIHZvYzogMCB9CiAgICAgICAgZm9yIChsZXQgaWQgb2YgaW5mby5saXN0c1t0eXBlICsgJy1pZHMnXSkgewogICAgICAgICAgICBsZXQgaXRlbSA9IGl0ZW1zX2lkW2lkXQogICAgICAgICAgICBsZXZlbHNbMF1bTWF0aC5mbG9vcigoaXRlbS5kYXRhLmxldmVsIC0gMSkgLyAxMCldKysKICAgICAgICAgICAgbGV2ZWxzW2l0ZW0uZGF0YS5sZXZlbF0rKwogICAgICAgICAgICBpdGVtX3R5cGVzW2l0ZW0ub2JqZWN0LnNsaWNlKDAsIDMpXSsrCiAgICAgICAgfQogICAgICAgIGxldCBzcnMgPSBuZXcgQXJyYXkoMTApLmZpbGwobnVsbCkubWFwKChfKSA9PiBbMCwgMF0pCiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIHNyc1tpXVswXSA9IGluZm8uY291bnRzW3R5cGUgKyAnLXNyczEtJyArIGldIHx8IDAKICAgICAgICAgICAgc3JzW2ldWzFdID0gaW5mby5jb3VudHNbdHlwZSArICctc3JzMi0nICsgaV0gfHwgMAogICAgICAgIH0KICAgICAgICBsZXQgc3JzX2NvdW50ZXIgPSAoaW5kZXgsIHN0YXJ0LCBlbmQpID0+CiAgICAgICAgICAgIHNycy5tYXAoKGEsIGkpID0+IChpID49IHN0YXJ0ID8gKGkgPD0gZW5kID8gYVtpbmRleF0gOiAwKSA6IDApKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKQogICAgICAgIHNyc1swXSA9IFsKICAgICAgICAgICAgW3Nyc19jb3VudGVyKDAsIDEsIDQpLCBzcnNfY291bnRlcigxLCAxLCA0KV0sCiAgICAgICAgICAgIFtzcnNfY291bnRlcigwLCA1LCA2KSwgc3JzX2NvdW50ZXIoMSwgNSwgNildLAogICAgICAgICAgICBzcnNbN10sCiAgICAgICAgICAgIHNyc1s4XSwKICAgICAgICAgICAgc3JzWzldLAogICAgICAgIF0KICAgICAgICBsZXQgc3JzX2RpZmYgPSBPYmplY3QuZW50cmllcyhzcnMuc2xpY2UoMSkpLnJlZHVjZSgoYSwgYikgPT4gYSArIGJbMF0gKiAoYlsxXVsxXSAtIGJbMV1bMF0pLCAwKQogICAgICAgIGxldCBwYXNzID0gWwogICAgICAgICAgICBpbmZvLmNvdW50cy5wYXNzLAogICAgICAgICAgICBpbmZvLmNvdW50cy5yZXZpZXdzIC0gaW5mby5jb3VudHMucGFzcywKICAgICAgICAgICAgTWF0aC5mbG9vcigoaW5mby5jb3VudHMucGFzcyAvIGluZm8uY291bnRzLnJldmlld3MpICogMTAwKSwKICAgICAgICBdCiAgICAgICAgbGV0IGFuc3dlcnMgPSBbCiAgICAgICAgICAgIGluZm8uY291bnRzLnJldmlld3MgKiAyIC0gaXRlbV90eXBlcy5yYWQsCiAgICAgICAgICAgIGluZm8uY291bnRzLmluY29ycmVjdCwKICAgICAgICAgICAgTWF0aC5mbG9vcigKICAgICAgICAgICAgICAgICgoaW5mby5jb3VudHMucmV2aWV3cyAqIDIgLSBpdGVtX3R5cGVzLnJhZCkgLwogICAgICAgICAgICAgICAgICAgIChpbmZvLmNvdW50cy5pbmNvcnJlY3QgKyBpbmZvLmNvdW50cy5yZXZpZXdzICogMiAtIGl0ZW1fdHlwZXMucmFkKSkgKgogICAgICAgICAgICAgICAgICAgIDEwMCwKICAgICAgICAgICAgKSwKICAgICAgICBdCiAgICAgICAgbGV0IGl0ZW1fZWxlbXMgPSBbXQogICAgICAgIGNvbnN0IGlkcyA9IFsuLi5uZXcgU2V0KGluZm8ubGlzdHNbdHlwZSArICctaWRzJ10pXQogICAgICAgIGNvbnN0IHN2Z3MgPSB7fQogICAgICAgIGNvbnN0IHN2Z1Byb21pc2VzID0gW10KICAgICAgICBmb3IgKGNvbnN0IGlkIG9mIGlkcykgewogICAgICAgICAgICBpZiAoaXRlbXNfaWRbaWRdLmRhdGEuY2hhcmFjdGVycykgY29udGludWUKICAgICAgICAgICAgc3ZnUHJvbWlzZXMucHVzaCgKICAgICAgICAgICAgICAgIHdrb2YKICAgICAgICAgICAgICAgICAgICAubG9hZF9maWxlKAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtc19pZFtpZF0uZGF0YS5jaGFyYWN0ZXJfaW1hZ2VzLmZpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSkgPT4gYS5jb250ZW50X3R5cGUgPT0gJ2ltYWdlL3N2Zyt4bWwnICYmIGEubWV0YWRhdGEuaW5saW5lX3N0eWxlcywKICAgICAgICAgICAgICAgICAgICAgICAgKS51cmwsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIC50aGVuKChzdmcpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN2Z0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykKICAgICAgICAgICAgICAgICAgICAgICAgc3ZnRWxlbS5pbm5lckhUTUwgPSBzdmcucmVwbGFjZSgvPHN2ZyAvLCBgPHN2ZyBjbGFzcz0icmFkaWNhbC1zdmciIGApCiAgICAgICAgICAgICAgICAgICAgICAgIHN2Z3NbaWRdID0gc3ZnRWxlbS5maXJzdENoaWxkCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHN2Z1Byb21pc2VzKQogICAgICAgIGZvciAobGV0IGlkIG9mIGlkcykgewogICAgICAgICAgICBsZXQgaXRlbSA9IGl0ZW1zX2lkW2lkXQogICAgICAgICAgICBsZXQgYnVybiA9IGJ1cm5zLmluY2x1ZGVzKGlkKQogICAgICAgICAgICBpdGVtX2VsZW1zLnB1c2goCiAgICAgICAgICAgICAgICBjcmVhdGVfZWxlbSh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2EnLAogICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnaXRlbSAnICsgaXRlbS5vYmplY3QgKyAnIGhvdmVyLXdyYXBwZXItdGFyZ2V0JyArIChidXJuID8gJyBidXJuJyA6ICcnKSwKICAgICAgICAgICAgICAgICAgICBocmVmOiBpdGVtLmRhdGEuZG9jdW1lbnRfdXJsLAogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZV9lbGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdob3Zlci13cmFwcGVyIGFib3ZlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnY2hhcmFjdGVycycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhyZWY6IGl0ZW0uZGF0YS5kb2N1bWVudF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkOiBpdGVtLmRhdGEuY2hhcmFjdGVycyB8fCBzdmdzW2lkXS5jbG9uZU5vZGUodHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlX3RhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVmdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnTWVhbmluZ3MnLCBpdGVtLmRhdGEubWVhbmluZ3MubWFwKChpKSA9PiBpLm1lYW5pbmcpLmpvaW4oJywgJyldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSZWFkaW5ncycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhLnJlYWRpbmdzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gaXRlbS5kYXRhLnJlYWRpbmdzLm1hcCgoaSkgPT4gaS5yZWFkaW5nKS5qb2luKCfjgIEgJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnLScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWydMZXZlbCcsIGl0ZW0uZGF0YS5sZXZlbF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY2xhc3M6ICdpbmZvJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlX2VsZW0oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2EnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdjaGFyYWN0ZXJzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkOiBpdGVtLmRhdGEuY2hhcmFjdGVycyB8fCBzdmdzW2lkXS5jbG9uZU5vZGUodHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBsZXQgdGltZV9zdHIgPSBtc190b19obXModGltZSkKICAgICAgICBsZXQgY291bnQgPSBpbmZvLmxpc3RzW3R5cGUgKyAnLWlkcyddLmxlbmd0aAogICAgICAgIGxldCBjb3VudF9zdHIgPQogICAgICAgICAgICAodHlwZSA9PT0gJ2ZvcmVjYXN0JyA/ICd1cGNvbWluZyByZXZpZXcnIDogdHlwZS5zbGljZSgwLCB0eXBlLmxlbmd0aCAtIDEpKSArIChjb3VudCA9PT0gMSA/ICcnIDogJ3MnKQogICAgICAgIC8vIFBvcHVsYXRlIHBvcHBlcgogICAgICAgIHBvcHBlci5jbGFzc05hbWUgPSB0eXBlCiAgICAgICAgcG9wcGVyLnF1ZXJ5U2VsZWN0b3IoJy5kYXRlJykuaW5uZXJUZXh0ID0gdGl0bGUKICAgICAgICBwb3BwZXIucXVlcnlTZWxlY3RvcignLmNvdW50JykuaW5uZXJUZXh0ID0gY291bnQudG9Mb2NhbGVTdHJpbmcoKSArICcgJyArIGNvdW50X3N0cgogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yKCcudGltZScpLmlubmVyVGV4dCA9IHR5cGUgPT0gJ2ZvcmVjYXN0JyA/ICcnIDogdGltZV9zdHIgPyAnICgnICsgdGltZV9zdHIgKyAnKScgOiAnJwogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yKCcuc2NvcmUgPiBzcGFuJykuaW5uZXJUZXh0ID0gKHNyc19kaWZmIDwgMCA/ICcnIDogJysnKSArIHNyc19kaWZmLnRvTG9jYWxlU3RyaW5nKCkKICAgICAgICBwb3BwZXIucXVlcnlTZWxlY3RvckFsbCgnLmxldmVscyAuaG92ZXItd3JhcHBlciA+IConKS5mb3JFYWNoKChlKSA9PiBlLnJlbW92ZSgpKQogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcubGV2ZWxzID4gdHIgPiB0ZCcpLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgICAgICAgZS5pbm5lclRleHQgPSBsZXZlbHNbMF1baV0udG9Mb2NhbGVTdHJpbmcoKQogICAgICAgICAgICBlLnBhcmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNvdW50JywgbGV2ZWxzWzBdW2ldKQogICAgICAgICAgICBlLnBhcmVudEVsZW1lbnQuY2hpbGRyZW5bMF0uYXBwZW5kKAogICAgICAgICAgICAgICAgY3JlYXRlX3RhYmxlKAogICAgICAgICAgICAgICAgICAgICdsZWZ0JywKICAgICAgICAgICAgICAgICAgICBsZXZlbHMKICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGEsIGopID0+IFtqICsgMSwgYS50b0xvY2FsZVN0cmluZygpXSkKICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoYSkgPT4gTWF0aC5mbG9vcigoYVswXSAtIDEpIC8gMTApID09IGkgJiYgYVsxXSAhPSAwKSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICB9KQogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuc3JzID4gdHIgPiB0ZCcpLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgICAgICAgZS5pbm5lclRleHQgPSBzcnNbMF1bTWF0aC5mbG9vcihpIC8gMildW2kgJSAyXS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgfSkKICAgICAgICBwb3BwZXIKICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5zcnMgLmhvdmVyLXdyYXBwZXIgdGFibGUnKQogICAgICAgICAgICAucmVwbGFjZVdpdGgoCiAgICAgICAgICAgICAgICBjcmVhdGVfdGFibGUoJ2xlZnQnLCBbCiAgICAgICAgICAgICAgICAgICAgWydTUlMnXSwKICAgICAgICAgICAgICAgICAgICBbJ0JlZm9yZSAvIEFmdGVyJ10sCiAgICAgICAgICAgICAgICAgICAgLi4uc3JzCiAgICAgICAgICAgICAgICAgICAgICAgIC5zbGljZSgxKQogICAgICAgICAgICAgICAgICAgICAgICAubWFwKChhLCBpKSA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ0FwcCAxJywgJ0FwcCAyJywgJ0FwcCAzJywgJ0FwcCA0JywgJ0d1ciAxJywgJ0d1ciAyJywgJ01hcycsICdFbmwnLCAnQnVyJ11baV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5hLm1hcCgoXykgPT4gXy50b0xvY2FsZVN0cmluZygpKSwKICAgICAgICAgICAgICAgICAgICAgICAgXSksCiAgICAgICAgICAgICAgICBdKSwKICAgICAgICAgICAgKQogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcudHlwZSB0ZCcpLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgICAgICAgZS5pbm5lclRleHQgPSBpdGVtX3R5cGVzW1sncmFkJywgJ2thbicsICd2b2MnXVtpXV0udG9Mb2NhbGVTdHJpbmcoKQogICAgICAgIH0pCiAgICAgICAgcG9wcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdW1tYXJ5IHRkJykuZm9yRWFjaCgoZSwgaSkgPT4gewogICAgICAgICAgICBlLmlubmVyVGV4dCA9IChwYXNzW2ldIHx8IDApLnRvTG9jYWxlU3RyaW5nKCkKICAgICAgICB9KQogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuYW5zd2VycyB0ZCcpLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgICAgICAgZS5pbm5lclRleHQgPSAoYW5zd2Vyc1tpXSB8fCAwKS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgfSkKICAgICAgICBwb3BwZXIucXVlcnlTZWxlY3RvcignLml0ZW1zJykucmVwbGFjZVdpdGgoY3JlYXRlX2VsZW0oeyB0eXBlOiAnZGl2JywgY2xhc3M6ICdpdGVtcycsIGNoaWxkcmVuOiBpdGVtX2VsZW1zIH0pKQogICAgICAgIHBvcHBlci5xdWVyeVNlbGVjdG9yKCcubWluaW1hcCA+IC5ob3Vycy1tYXAnKS5yZXBsYWNlV2l0aChjcmVhdGVfbWluaW1hcCh0eXBlLCBtaW5pbWFwX2RhdGEpLm1hcHMuZGF5KQogICAgICAgIHBvcHBlci5zdHlsZS50b3AgPSBldmVudC5wYWdlWSArIDUwICsgJ3B4JwogICAgICAgIHBvcHBlci5jbGFzc0xpc3QuYWRkKCdwb3BwZWQnKQogICAgICAgIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5vdGhlci50aW1lc19wb3BwZWQrKwogICAgICAgIHdrb2YuU2V0dGluZ3Muc2F2ZShzY3JpcHRfaWQpCiAgICB9CgogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCiAgICAvLyBSZXR1cm5zIHRoZSBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgY2xpY2tzIG9uIGRheXMuIFdyYXBwZWQgZm9yIGRhdGEgc3RvcmFnZQogICAgZnVuY3Rpb24gZGF5X2NsaWNrKGRhdGEpIHsKICAgICAgICBmdW5jdGlvbiBldmVudF9oYW5kbGVyKGV2ZW50KSB7CiAgICAgICAgICAgIGxldCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgICAgICAgICBsZXQgZWxlbSA9IGV2ZW50LnRhcmdldAogICAgICAgICAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2RheScpKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnKS5zcGxpdCgnLScpCiAgICAgICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIDAsIDApCiAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IGVsZW0uY2xvc2VzdCgnLnZpZXcnKS5jbGFzc0xpc3QuY29udGFpbnMoJ3Jldmlld3MnKQogICAgICAgICAgICAgICAgICAgID8gZGF0ZSA8IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgPyAncmV2aWV3cycKICAgICAgICAgICAgICAgICAgICAgICAgOiAnZm9yZWNhc3QnCiAgICAgICAgICAgICAgICAgICAgOiAnbGVzc29ucycKICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhlbGVtLmluZm8ubGlzdHMpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGxldCB0aXRsZSA9IGAke2RhdGUudG9EYXRlU3RyaW5nKCkuc2xpY2UoNCl9ICR7a2FuamlfZGF5KGRhdGUuZ2V0RGF5KCkpfWAKICAgICAgICAgICAgICAgICAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLmdlbmVyYWwuZGF5X3N0YXJ0ICogbXNoCiAgICAgICAgICAgICAgICAgICAgbGV0IGRheV9kYXRhID0gZGF0YVt0eXBlXS5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIChhKSA9PiBhWzBdID49IGRhdGUuZ2V0VGltZSgpICsgb2Zmc2V0ICYmIGFbMF0gPCBkYXRlLmdldFRpbWUoKSArIG1zZCArIG9mZnNldCwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgbGV0IG1pbmltYXBfZGF0YSA9IGNvb2tfZGF0YSh0eXBlLCBkYXlfZGF0YSkKICAgICAgICAgICAgICAgICAgICBsZXQgYnVybnMgPSBkYXlfZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiBpdGVtWzJdID09PSA4ICYmIGl0ZW1bM10gKyBpdGVtWzRdID09PSAwKQogICAgICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiBpdGVtWzFdKQogICAgICAgICAgICAgICAgICAgIGxldCB0aW1lID0gbWluaW1hcF9kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGEsIGkpID0+IGFbMF0gLSAobWluaW1hcF9kYXRhW2kgLSAxXSB8fCBbMF0pWzBdKQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChhKSA9PiBhIDwgc2V0dGluZ3MuZ2VuZXJhbC5zZXNzaW9uX2xpbWl0ICogNjAgKiAxMDAwKQogICAgICAgICAgICAgICAgICAgICAgICAucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkKICAgICAgICAgICAgICAgICAgICB1cGRhdGVfcG9wcGVyKGV2ZW50LCB0eXBlLCB0aXRsZSwgZWxlbS5pbmZvLCBtaW5pbWFwX2RhdGEsIGJ1cm5zLCB0aW1lKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBldmVudF9oYW5kbGVyCiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIGNsaWNrIGFuZCBkcmFnLiBXcmFwcGVkIGZvciBkYXRhIHN0b3JhZ2UKICAgIGZ1bmN0aW9uIGNsaWNrX2FuZF9kcmFnKGRhdGEpIHsKICAgICAgICBsZXQgZG93biwKICAgICAgICAgICAgZmlyc3RfZGF5LAogICAgICAgICAgICBmaXJzdF9kYXRlLAogICAgICAgICAgICBtYXJrZWQgPSBbXQogICAgICAgIGZ1bmN0aW9uIGV2ZW50X2hhbmRsZXIoZXZlbnQpIHsKICAgICAgICAgICAgbGV0IGVsZW0gPSBldmVudC50YXJnZXQKICAgICAgICAgICAgLy8gSWYgZXZlbnQgY29uY2VybnMgYSBkYXkgZWxlbWVudCwgcHJvY2VlZAogICAgICAgICAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2RheScpKSB7CiAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnKS5zcGxpdCgnLScpCiAgICAgICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIDAsIDApCiAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IGVsZW0uY2xvc2VzdCgnLnZpZXcnKS5jbGFzc0xpc3QuY29udGFpbnMoJ3Jldmlld3MnKQogICAgICAgICAgICAgICAgICAgID8gZGF0ZSA8IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgPyAncmV2aWV3cycKICAgICAgICAgICAgICAgICAgICAgICAgOiAnZm9yZWNhc3QnCiAgICAgICAgICAgICAgICAgICAgOiAnbGVzc29ucycKICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHNlbGVjdGlvbgogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdtb3VzZWRvd24nKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgIGRvd24gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZmlyc3RfZGF5ID0gZWxlbQogICAgICAgICAgICAgICAgICAgIGZpcnN0X2RhdGUgPSBuZXcgRGF0ZShlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBFbmQgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNldXAnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0X2RheSAhPT0gZWxlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBHYXRoZXIgdGhlIGRhdGEgdGhlbiB1cGRhdGUgcG9wcGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZWNvbmRfZGF0ZSA9IG5ldyBEYXRlKGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWRhdGUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0X2RhdGUgPSBmaXJzdF9kYXRlIDwgc2Vjb25kX2RhdGUgPyBmaXJzdF9kYXRlIDogc2Vjb25kX2RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVuZF9kYXRlID0gZmlyc3RfZGF0ZSA8IHNlY29uZF9kYXRlID8gc2Vjb25kX2RhdGUgOiBmaXJzdF9kYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBlbGVtLmNsb3Nlc3QoJy52aWV3JykuY2xhc3NMaXN0LmNvbnRhaW5zKCdyZXZpZXdzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gc3RhcnRfZGF0ZSA8IG5ldyBEYXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdyZXZpZXdzJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJ2ZvcmVjYXN0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAnbGVzc29ucycKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRpdGxlID0gYCR7c3RhcnRfZGF0ZS50b0RhdGVTdHJpbmcoKS5zbGljZSg0KX0gJHtrYW5qaV9kYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydF9kYXRlLmdldERheSgpLAogICAgICAgICAgICAgICAgICAgICAgICApfSAtICR7ZW5kX2RhdGUudG9EYXRlU3RyaW5nKCkuc2xpY2UoNCl9ICR7a2FuamlfZGF5KGVuZF9kYXRlLmdldERheSgpKX1gCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0b2RheSA9IG5ldyBEYXRlKG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkpLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gd2tvZi5zZXR0aW5nc1tzY3JpcHRfaWRdLmdlbmVyYWwuZGF5X3N0YXJ0ICogbXNoCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXlfZGF0YSA9IGRhdGFbdHlwZV0uZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEpID0+IGFbMF0gPiBzdGFydF9kYXRlLmdldFRpbWUoKSArIG9mZnNldCAmJiBhWzBdIDwgZW5kX2RhdGUuZ2V0VGltZSgpICsgbXNkICsgb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXBwZWRfZGF5X2RhdGEgPSBkYXlfZGF0YS5tYXAoKGEpID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZGF5ICsgbmV3IERhdGUoYVswXSkuZ2V0SG91cnMoKSAqIG1zaCArIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5nZW5lcmFsLmRheV9zdGFydCAqIG1zaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLmEuc2xpY2UoMSksCiAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtaW5pbWFwX2RhdGEgPSBjb29rX2RhdGEodHlwZSwgbWFwcGVkX2RheV9kYXRhKQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcG9wcGVyX2luZm8gPSB7IGNvdW50czoge30sIGxpc3RzOiB7fSB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGl0ZW0gb2YgbWluaW1hcF9kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoaXRlbVsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBvcHBlcl9pbmZvLmNvdW50c1trZXldKSBwb3BwZXJfaW5mby5jb3VudHNba2V5XSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3BwZXJfaW5mby5jb3VudHNba2V5XSArPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGl0ZW1bMl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwb3BwZXJfaW5mby5saXN0c1trZXldKSBwb3BwZXJfaW5mby5saXN0c1trZXldID0gW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3BwZXJfaW5mby5saXN0c1trZXldLnB1c2godmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJ1cm5zID0gZGF5X2RhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGl0ZW0pID0+IGl0ZW1bMl0gPT09IDggJiYgaXRlbVszXSArIGl0ZW1bNF0gPT09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiBpdGVtWzFdKQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGltZSA9IGRheV9kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChhLCBpKSA9PiBNYXRoLmZsb29yKChhWzBdIC0gKGRheV9kYXRhW2kgLSAxXSB8fCBbMF0pWzBdKSAvICg2MCAqIDEwMDApKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGEpID0+IGEgPCAxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKQogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVfcG9wcGVyKGV2ZW50LCB0eXBlLCB0aXRsZSwgcG9wcGVyX2luZm8sIG1pbmltYXBfZGF0YSwgYnVybnMsIHRpbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXS5vdGhlci50aW1lc19kcmFnZ2VkKysKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlb3ZlcicgJiYgZG93bikgewogICAgICAgICAgICAgICAgICAgIGxldCB2aWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hlYXRtYXAgLnZpZXcuJyArICh0eXBlID09PSAnZm9yZWNhc3QnID8gJ3Jldmlld3MnIDogdHlwZSkpCiAgICAgICAgICAgICAgICAgICAgaWYgKCF2aWV3KSByZXR1cm4KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBtIG9mIG1hcmtlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBtLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbWFya2VkID0gW10KICAgICAgICAgICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJykKICAgICAgICAgICAgICAgICAgICBtYXJrZWQucHVzaChlbGVtKQogICAgICAgICAgICAgICAgICAgIGxldCBkID0gbmV3IERhdGUoZmlyc3RfZGF0ZS5nZXRUaW1lKCkpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGQudG9EYXRlU3RyaW5nKCkgIT09IGRhdGUudG9EYXRlU3RyaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGUgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgLmRheVtkYXRhLWRhdGU9IiR7ZC5nZXRGdWxsWWVhcigpfS0ke2QuZ2V0TW9udGgoKSArIDF9LSR7ZC5nZXREYXRlKCl9Il1gLAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIGUuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKQogICAgICAgICAgICAgICAgICAgICAgICBtYXJrZWQucHVzaChlKQogICAgICAgICAgICAgICAgICAgICAgICBkLnNldERhdGUoZC5nZXREYXRlKCkgKyAoZCA8IGRhdGUgPyAxIDogLTEpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBJZiBtb3VzZSBpcyBsZXQgZ28sIHJlbW92ZSBzZWxlY3Rpb24KICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdtb3VzZXVwJykgewogICAgICAgICAgICAgICAgZG93biA9IGZhbHNlCiAgICAgICAgICAgICAgICBmb3IgKGxldCBtIG9mIG1hcmtlZCkgewogICAgICAgICAgICAgICAgICAgIG0uY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWFya2VkID0gW10KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXZlbnRfaGFuZGxlcgogICAgfQoKICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogICAgLy8gU2hvcnRoYW5kIGZvciBjcmVhdGluZyBuZXcgZWxlbWVudHMuIEtleXMgdGhhdCBkbyBub3QgaGF2ZSBhIHNwZWNpYWwgZnVuY3Rpb24gd2lsbCBiZSBhZGRlZCBhcyBhdHRyaWJ1dGVzCiAgICBmdW5jdGlvbiBjcmVhdGVfZWxlbShjb25maWcpIHsKICAgICAgICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjb25maWcudHlwZSkKICAgICAgICBmb3IgKGxldCBbYXR0ciwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZykpIHsKICAgICAgICAgICAgaWYgKGF0dHIgPT09ICd0eXBlJykgY29udGludWUKICAgICAgICAgICAgZWxzZSBpZiAoYXR0ciA9PT0gJ2NoaWxkJykgZGl2LmFwcGVuZCh2YWx1ZSkKICAgICAgICAgICAgZWxzZSBpZiAoYXR0ciA9PT0gJ2NoaWxkcmVuJykgZGl2LmFwcGVuZCguLi52YWx1ZSkKICAgICAgICAgICAgZWxzZSBpZiAoYXR0ciA9PT0gJ3ZhbHVlJykgZGl2LnZhbHVlID0gdmFsdWUKICAgICAgICAgICAgZWxzZSBpZiAoYXR0ciA9PT0gJ2lucHV0JykgZGl2LnNldEF0dHJpYnV0ZSgndHlwZScsIHZhbHVlKQogICAgICAgICAgICBlbHNlIGlmIChhdHRyID09PSAnb25jbGljaycpIGRpdi5vbmNsaWNrID0gdmFsdWUKICAgICAgICAgICAgZWxzZSBpZiAoYXR0ciA9PT0gJ2NhbGxiYWNrJykgY29udGludWUKICAgICAgICAgICAgZWxzZSBkaXYuc2V0QXR0cmlidXRlKGF0dHIsIHZhbHVlKQogICAgICAgIH0KICAgICAgICBpZiAoY29uZmlnLmNhbGxiYWNrKSBjb25maWcuY2FsbGJhY2soZGl2KQogICAgICAgIHJldHVybiBkaXYKICAgIH0KCiAgICAvLyBDcmVhdGVzIGEgdGFibGUgZnJvbSBhIG1hdHJpeAogICAgZnVuY3Rpb24gY3JlYXRlX3RhYmxlKGhlYWRlciwgZGF0YSwgdGFibGVfYXR0ciwgdHJfaG92ZXIpIHsKICAgICAgICBsZXQgdGFibGUgPSBjcmVhdGVfZWxlbShPYmplY3QuYXNzaWduKHsgdHlwZTogJ3RhYmxlJyB9LCB0YWJsZV9hdHRyKSkKICAgICAgICBmb3IgKGxldCBbaSwgcm93XSBvZiBPYmplY3QuZW50cmllcyhkYXRhKSkgewogICAgICAgICAgICBsZXQgdHJfY29uZmlnID0geyB0eXBlOiAndHInIH0KICAgICAgICAgICAgaWYgKHRyX2hvdmVyKSB7CiAgICAgICAgICAgICAgICB0cl9jb25maWcuY2xhc3MgPSAnaG92ZXItd3JhcHBlci10YXJnZXQnCiAgICAgICAgICAgICAgICB0cl9jb25maWcuY2hpbGQgPSBjcmVhdGVfZWxlbSh7IHR5cGU6ICdkaXYnLCBjbGFzczogJ2hvdmVyLXdyYXBwZXIgYmVsb3cnIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IHRyID0gY3JlYXRlX2VsZW0odHJfY29uZmlnKQogICAgICAgICAgICBmb3IgKGxldCBbaiwgY2VsbF0gb2YgT2JqZWN0LmVudHJpZXMocm93KSkgewogICAgICAgICAgICAgICAgbGV0IGNlbGxfdHlwZSA9IChoZWFkZXIgPT0gJ3RvcCcgJiYgaSA9PSAwKSB8fCAoaGVhZGVyID09ICdsZWZ0JyAmJiBqID09IDApID8gJ3RoJyA6ICd0ZCcKICAgICAgICAgICAgICAgIHRyLmFwcGVuZChjcmVhdGVfZWxlbSh7IHR5cGU6IGNlbGxfdHlwZSwgY2hpbGQ6IGNlbGwgfSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFibGUuYXBwZW5kKHRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFibGUKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBrYW5paiBmb3IgdGhlIGRheQogICAgZnVuY3Rpb24ga2FuamlfZGF5KGRheSkgewogICAgICAgIHJldHVybiBbJ+aXpScsICfmnIgnLCAn54GrJywgJ+awtCcsICfmnKgnLCAn6YeRJywgJ+WcnyddW2RheV0KICAgIH0KICAgIC8vIENvbnZlcnRzIG1pbnV0ZXMgdG8gYSB0aW1lc3RhbXAgc3RyaW5nICIjaCAjbSIKICAgIGZ1bmN0aW9uIG1fdG9faG0obWludXRlcykgewogICAgICAgIHJldHVybiBNYXRoLmZsb29yKG1pbnV0ZXMgLyA2MCkgKyAnaCAnICsgTWF0aC5mbG9vcihtaW51dGVzICUgNjApICsgJ20nCiAgICB9CiAgICAvLyBDb252ZXJ0cyBtcyB0byBhIHRpbWVzdGFtcCBzdHJpbmcgIiNoICNtICNzIiB3aGVyZSBvbmx5IHRoZSBmaXJzdCB0d28gbm9uLXplcm8gdmFsdWVzIGFyZSBpbmNsdWRlZAogICAgZnVuY3Rpb24gbXNfdG9faG1zKG1zKSB7CiAgICAgICAgY29uc3QgaG1zID0gWwogICAgICAgICAgICBbbXMgKyAxLCBtc2gsICdoJ10sCiAgICAgICAgICAgIFttc2gsIDYwICogMTAwMCwgJ20nXSwKICAgICAgICAgICAgWzYwICogMTAwMCwgMTAwMCwgJ3MnXSwKICAgICAgICBdCiAgICAgICAgcmV0dXJuIGhtcwogICAgICAgICAgICAubWFwKChhKSA9PiBNYXRoLmZsb29yKChtcyAlIGFbMF0pIC8gYVsxXSkgKyBhWzJdKQogICAgICAgICAgICAuZmlsdGVyKChhKSA9PiBhWzBdICE9PSAnMCcpCiAgICAgICAgICAgIC5zbGljZSgwLCAyKQogICAgICAgICAgICAuam9pbignICcpCiAgICB9CgogICAgLy8gQ2FwaXRhbGl6ZXMgdGhlIGZpcnN0IGNoYXJhY3RlciBpbiBhIHN0cmluZy4gInByb3BlciIg4oaSICJQcm9wZXIiCiAgICBTdHJpbmcucHJvdG90eXBlLnRvUHJvcGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLnNsaWNlKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyB0aGlzLnNsaWNlKDEpCiAgICB9CiAgICAvLyBSZXR1cm5zIGEgaGV4IGNvbG9yIGJldHdlZW4gdGhlIGxlZnQgYW5kIHJpZ2h0IGhleCBjb2xvcnMKICAgIGZ1bmN0aW9uIGludGVycG9sYXRlX2NvbG9yKGxlZnQsIHJpZ2h0LCBpbmRleCkgewogICAgICAgIGlmIChpc05hTihpbmRleCkpIHJldHVybiBsZWZ0CiAgICAgICAgbGVmdCA9IGhleF90b19yZ2IobGVmdCkKICAgICAgICByaWdodCA9IGhleF90b19yZ2IocmlnaHQpCiAgICAgICAgbGV0IHJlc3VsdCA9IFswLCAwLCAwXQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKSByZXN1bHRbaV0gPSBNYXRoLnJvdW5kKGxlZnRbaV0gKyBpbmRleCAqIChyaWdodFtpXSAtIGxlZnRbaV0pKQogICAgICAgIHJldHVybiByZ2JfdG9faGV4KHJlc3VsdCkKICAgIH0KICAgIC8vIENvbnZlcnRzIGEgaGV4IGNvbG9yIHRvIHJnYgogICAgZnVuY3Rpb24gaGV4X3RvX3JnYihoZXgpIHsKICAgICAgICBsZXQgcmVzdWx0ID0gL14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaS5leGVjKGhleCkKICAgICAgICByZXR1cm4gW3BhcnNlSW50KHJlc3VsdFsxXSwgMTYpLCBwYXJzZUludChyZXN1bHRbMl0sIDE2KSwgcGFyc2VJbnQocmVzdWx0WzNdLCAxNildCiAgICB9CiAgICAvLyBDb252ZXJ0cyBhbiByZ2IgY29sb3IgdG8gaGV4CiAgICBmdW5jdGlvbiByZ2JfdG9faGV4KGNvbHMpIHsKICAgICAgICBsZXQgcmdiID0gY29sc1syXSB8IChjb2xzWzFdIDw8IDgpIHwgKGNvbHNbMF0gPDwgMTYpCiAgICAgICAgcmV0dXJuICcjJyArICgweDEwMDAwMDAgKyByZ2IpLnRvU3RyaW5nKDE2KS5zbGljZSgxKQogICAgfQogICAgLy8gQ3J1ZGUgYXBwcm94aW1hdGlvbiBvZiBpbnZlcnNlIGZvbGRlZCBjdW11bGF0aXZlIGRpc3RyaWJ1dGlvbiBmdW5jdGlvbgogICAgLy8gVXNlZCBmb3IgdGhlIHF1YW50aWxlcyBpbiBhdXRvLXJhbmdpbmcKICAgIGZ1bmN0aW9uIGlmY2RmKHAsIG0sIHNkKSB7CiAgICAgICAgLy8gRm9sZGVkIGN1bXVsYXRpdmUgZGlzdHJpYnV0aW9uIGZ1bmN0aW9uCiAgICAgICAgZnVuY3Rpb24gZmNkZih4LCBtZWFuLCBzZCkgewogICAgICAgICAgICAvLyBFcnJvciBmdW5jdGlvbgogICAgICAgICAgICBmdW5jdGlvbiBlcmYoeCkgewogICAgICAgICAgICAgICAgbGV0IHNpZ24gPSB4ID49IDAgPyAxIDogLTEKICAgICAgICAgICAgICAgIHggPSBNYXRoLmFicyh4KQogICAgICAgICAgICAgICAgbGV0IGExID0gMC4yNTQ4Mjk1OTIsCiAgICAgICAgICAgICAgICAgICAgYTIgPSAtMC4yODQ0OTY3MzYKICAgICAgICAgICAgICAgIGxldCBhMyA9IDEuNDIxNDEzNzQxLAogICAgICAgICAgICAgICAgICAgIGE0ID0gLTEuNDUzMTUyMDI3CiAgICAgICAgICAgICAgICBsZXQgYTUgPSAxLjA2MTQwNTQyOSwKICAgICAgICAgICAgICAgICAgICBwID0gMC4zMjc1OTExCiAgICAgICAgICAgICAgICBsZXQgdCA9IDEgLyAoMSArIHAgKiB4KQogICAgICAgICAgICAgICAgbGV0IHkgPSAxLjAgLSAoKCgoYTUgKiB0ICsgYTQpICogdCArIGEzKSAqIHQgKyBhMikgKiB0ICsgYTEpICogdCAqIE1hdGguZXhwKC14ICogeCkKICAgICAgICAgICAgICAgIHJldHVybiBzaWduICogeQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwLjUgKiAoZXJmKCh4ICsgbWVhbikgLyAoc2QgKiBNYXRoLnNxcnQoMikpKSArIGVyZigoeCAtIG1lYW4pIC8gKHNkICogTWF0aC5zcXJ0KDIpKSkpCiAgICAgICAgfQogICAgICAgIGxldCBwMiA9IDAsCiAgICAgICAgICAgIGl0ZW1zID0gMCwKICAgICAgICAgICAgc3RlcCA9IE1hdGguY2VpbChzZCAvIDEwKQogICAgICAgIHdoaWxlIChwMiA8IHApIHsKICAgICAgICAgICAgaXRlbXMgKz0gc3RlcAogICAgICAgICAgICBwMiA9IGZjZGYoaXRlbXMsIG0sIHNkKQogICAgICAgIH0KICAgICAgICByZXR1cm4gaXRlbXMKICAgIH0KCiAgICAvLyBGaXJlcyBhIGN1c3RvbSBldmVudCBvbiBhbiBlbGVtZW50CiAgICBmdW5jdGlvbiBmaXJlX2V2ZW50KGV2ZW50X25hbWUsIGVsZW0pIHsKICAgICAgICBjb25zdCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpCiAgICAgICAgZXZlbnQuaW5pdEV2ZW50KGV2ZW50X25hbWUsIHRydWUsIHRydWUpCiAgICAgICAgZWxlbS5kaXNwYXRjaEV2ZW50KGV2ZW50KQogICAgfQp9KSh3aW5kb3cud2tvZiwgd2luZG93LnJldmlld19jYWNoZSwgd2luZG93LkhlYXRtYXApCg==","requires":[{"meta":{"name":"Wanikani:%20Review%20Cache.js","url":"https://greasyfork.org/scripts/410909-wanikani-review-cache/code/Wanikani:%20Review%20Cache.js?version=952556","ts":1648186038330,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBXYW5pa2FuaTogUmV2aWV3IENhY2hlCi8vIEB2ZXJzaW9uICAgICAgMS4wLjExCi8vIEBkZXNjcmlwdGlvbiAgTWFuYWdlcyBhIGNhY2hlIG9mIGFsbCB0aGUgdXNlcidzIHJldmlld3MKLy8gQGF1dGhvciAgICAgICBLdW1pcmVpCi8vID09L1VzZXJTY3JpcHQ9PQoKKGZ1bmN0aW9uKHdrb2YpIHsKICAgIC8vIE1hbnVhbGx5IGluY3JlbWVudCB0byBpbml0aWF0ZSByZWxvYWQgZm9yIGFsbCB1c2VycwogICAgY29uc3QgY2FjaGVfdmVyc2lvbiA9IDEKCiAgICAvLyBSZXZlYWwgZnVuY3Rpb25zIHRvIHdpbmRvdwogICAgaWYgKCF3aW5kb3cucmV2aWV3X2NhY2hlIHx8ICF3aW5kb3cucmV2aWV3X2NhY2hlLnZlcnNpb24gfHwgd2luZG93LnJldmlld19jYWNoZS52ZXJzaW9uIDwgR01faW5mby5zY3JpcHQudmVyc2lvbikgewogICAgICAgIHdpbmRvdy5yZXZpZXdfY2FjaGUgPSB7Z2V0X3Jldmlld3MsIHJlbG9hZCwgdmVyc2lvbjogR01faW5mby5zY3JpcHQudmVyc2lvbn07CiAgICB9CgogICAgLy8gRmV0Y2ggcmV2aWV3cyBmcm9tIHN0b3JhZ2UKICAgIGZ1bmN0aW9uIGdldF9yZXZpZXdzKCkgewogICAgICAgIHdrb2YuaW5jbHVkZSgnQXBpdjInKTsKICAgICAgICByZXR1cm4gd2tvZi5yZWFkeSgnQXBpdjInKS50aGVuKGxvYWRfZGF0YSkudGhlbih1cGRhdGVfZGF0YSk7CiAgICB9CgogICAgLy8gRGVsZXRlcyBjYWNoZSBhbmQgcmVmZXRjaGVzIHJldmlld3MKICAgIGZ1bmN0aW9uIHJlbG9hZCgpIHsKICAgICAgICByZXR1cm4gd2tvZi5maWxlX2NhY2hlLmRlbGV0ZSgncmV2aWV3X2NhY2hlJykudGhlbihnZXRfcmV2aWV3cyk7CiAgICB9CgogICAgLy8gTG9hZHMgZGF0YSBmcm9tIGNhY2hlCiAgICBmdW5jdGlvbiBsb2FkX2RhdGEoKSB7CiAgICAgICAgcmV0dXJuIHdrb2YuZmlsZV9jYWNoZS5sb2FkKCdyZXZpZXdfY2FjaGUnKS50aGVuKGRlY29tcHJlc3MsIF89PntyZXR1cm4ge2NhY2hlX3ZlcnNpb24sIGRhdGU6ICIxOTcwLTAxLTAxVDAwOjAwOjAwLjAwMFoiLCByZXZpZXdzOiBbXSx9O30pOwogICAgfQoKICAgIC8vIFNhdmUgY2FjaGUKICAgIGZ1bmN0aW9uIHNhdmUoZGF0YSkgewogICAgICAgIHJldHVybiB3a29mLmZpbGVfY2FjaGUuc2F2ZSgncmV2aWV3X2NhY2hlJywgY29tcHJlc3MoZGF0YSkpLnRoZW4oXz0+ZGF0YSk7CiAgICB9CgogICAgLy8gQ29tcHJlc3MgYW5kIGRlY29tcHJlc3MgdGhlIGRhdGVzIGZvciBiZXR0ZXIgdXNlIG9mIHN0b3JhZ2Ugc3BhY2UuCiAgICAvLyBEYXRlcyBhcmUgc3RvcmVkIGFzIHRpbWUgZWxhcGVzZWQgYmV0d2VlbiBpdGVtcywgYnV0IGFyZSByZXR1cm5lZCBhcyBhYnNvbHV0ZSBkYXRlcwogICAgZnVuY3Rpb24gY29tcHJlc3MoZGF0YSkge3JldHVybiBwcmVzcyh0cnVlLCBkYXRhKTt9CiAgICBmdW5jdGlvbiBkZWNvbXByZXNzKGRhdGEpIHtyZXR1cm4gcHJlc3MoZmFsc2UsIGRhdGEpO30KICAgIGZ1bmN0aW9uIHByZXNzKGNvbSwgZGF0YSkgewogICAgICAgIGxldCBsYXN0ID0gMDsKICAgICAgICBsZXQgcHJlc3NlZCA9IGRhdGEucmV2aWV3cy5tYXAoaXRlbSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgbWFwID0gW2NvbSA/IChpdGVtWzBdLWxhc3QpIDogKGxhc3QraXRlbVswXSksIC4uLml0ZW0uc2xpY2UoMSldOwogICAgICAgICAgICAgICAgbGFzdCA9IGNvbSA/IGl0ZW1bMF0gOiBsYXN0K2l0ZW1bMF07CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwOwogICAgICAgICAgICB9KTsKICAgICAgICByZXR1cm4ge2NhY2hlX3ZlcnNpb246IGRhdGEuY2FjaGVfdmVyc2lvbiwgZGF0ZTogZGF0YS5kYXRlLCByZXZpZXdzOiBwcmVzc2VkfTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSBjYWNoZQogICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlX2RhdGEoZGF0YSkgewogICAgICAgIGlmICghZGF0YS5jYWNoZV92ZXJzaW9uIHx8IGRhdGEuY2FjaGVfdmVyc2lvbiA8IGNhY2hlX3ZlcnNpb24pIGRhdGEgPSB7Y2FjaGVfdmVyc2lvbiwgZGF0ZTogIjE5NzAtMDEtMDFUMDA6MDA6MDAuMDAwWiIsIHJldmlld3M6IFtdLH0KICAgICAgICBsZXQgW2RhdGUsIG5ld19yZXZpZXdzXSA9IGF3YWl0IGZldGNoX25ld19yZXZpZXdzKGRhdGEuZGF0ZSk7CiAgICAgICAgaWYgKG5ld19yZXZpZXdzLmxlbmd0aCkgewogICAgICAgICAgICBmb3IgKGxldCBuZXdfcmV2aWV3IG9mIG5ld19yZXZpZXdzKSBkYXRhLnJldmlld3MucHVzaChuZXdfcmV2aWV3KTsKICAgICAgICAgICAgZGF0YS5yZXZpZXdzLnNvcnQoKGEsYikgPT4gYVswXTxiWzBdID8gLTEgOiAxKTsKICAgICAgICAgICAgZGF0YS5kYXRlID0gZGF0ZTsKICAgICAgICAgICAgc2F2ZShkYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGEucmV2aWV3czsKICAgIH0KCiAgICAvLyBGZXRjaGVzIGFueSBuZXcgcmV2aWV3cyBmcm9tIHRoZSBBUEkKICAgIGFzeW5jIGZ1bmN0aW9uIGZldGNoX25ld19yZXZpZXdzKGxhc3RfZmV0Y2gpIHsKICAgICAgICBsZXQgdXBkYXRlZF9yZXZpZXdzID0gYXdhaXQgd2tvZi5BcGl2Mi5mZXRjaF9lbmRwb2ludCgncmV2aWV3cycsIHtmaWx0ZXJzOiB7dXBkYXRlZF9hZnRlcjogbGFzdF9mZXRjaH19KTsKICAgICAgICBsZXQgbmV3X3Jldmlld3MgPSB1cGRhdGVkX3Jldmlld3MuZGF0YS5maWx0ZXIoaXRlbSA9PiBsYXN0X2ZldGNoPGl0ZW0uZGF0YS5jcmVhdGVkX2F0KTsKICAgICAgICBuZXdfcmV2aWV3cyA9IG5ld19yZXZpZXdzLm1hcChpdGVtID0+IFsKICAgICAgICAgICAgRGF0ZS5wYXJzZShpdGVtLmRhdGEuY3JlYXRlZF9hdCksCiAgICAgICAgICAgIGl0ZW0uZGF0YS5zdWJqZWN0X2lkLAogICAgICAgICAgICBpdGVtLmRhdGEuc3RhcnRpbmdfc3JzX3N0YWdlLAogICAgICAgICAgICBpdGVtLmRhdGEuaW5jb3JyZWN0X21lYW5pbmdfYW5zd2VycywKICAgICAgICAgICAgaXRlbS5kYXRhLmluY29ycmVjdF9yZWFkaW5nX2Fuc3dlcnMsCiAgICAgICAgXSk7CiAgICAgICAgcmV0dXJuIFt1cGRhdGVkX3Jldmlld3MuZGF0YV91cGRhdGVkX2F0LCBuZXdfcmV2aWV3c107CiAgICB9Cn0pKHdpbmRvdy53a29mKTs="},{"meta":{"name":"Heatmap.js","url":"https://greasyfork.org/scripts/410910-heatmap/code/Heatmap.js?version=888244","ts":1648186038495,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBIZWF0bWFwCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMS4wLjYKLy8gQGRlc2NyaXB0aW9uICBTaW1wbGUgc2NyaXB0IHRoYXQgY2FuIGdlbmVyYXRlIGhlYXRtYXBzCi8vIEBhdXRob3IgICAgICAgS3VtaXJlaQovLyBAaW5jbHVkZSAgICAgIC9eaHR0cHM6Ly8od3d3fHByZXZpZXcpLndhbmlrYW5pLmNvbS8oZGFzaGJvYXJkKT8kLwovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09Ci8qanNoaW50IGVzdmVyc2lvbjogOCAqLwoKKGZ1bmN0aW9uKCQpIHsKICAgIC8vIFRoZSBoZWF0bWFwIG9iamVjdAogICAgY2xhc3MgSGVhdG1hcCB7CiAgICAgICAgY29uc3RydWN0b3IoY29uZmlnLCBkYXRhKSB7CiAgICAgICAgICAgIHRoaXMubWFwcyA9IHt9OwogICAgICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZzsKICAgICAgICAgICAgdGhpcy5kYXRhID0ge307CgogICAgICAgICAgICAvLyBJZiBkYXRhIGlzIHByb3ZpZGVkLCBpbml0aWF0ZSByaWdodCBhd2F5CiAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHRoaXMuaW5pdGlhdGUoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyBDcmVhdGVzIGhlYXRtYXBzIGZvciB0aGUgZGF0YQogICAgICAgIGluaXRpYXRlKGRhdGEpIHsKICAgICAgICAgICAgbGV0IGRhdGVzID0gdGhpcy5fZ2V0X2RhdGVzKGRhdGEpOwogICAgICAgICAgICBsZXQgcGFyc2VkX2RhdGEgPSB0aGlzLl9wYXJzZV9kYXRhKGRhdGEsIGRhdGVzKTsKICAgICAgICAgICAgdGhpcy5kYXRhID0gcGFyc2VkX2RhdGE7CiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy50eXBlID09PSAieWVhciIpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHllYXI9ZGF0ZXMuZmlyc3RfeWVhcjsgeWVhcjw9ZGF0ZXMubGFzdF95ZWFyOyB5ZWFyKyspIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcHNbeWVhcl0gPSB0aGlzLl9pbml0X3llYXIoeWVhciwgcGFyc2VkX2RhdGEsIGRhdGVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2FkZF9tYXJraW5ncyh0aGlzLmNvbmZpZy5tYXJraW5ncywgdGhpcy5tYXBzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5jb25maWcudHlwZSA9PT0gImRheSIpIHsKICAgICAgICAgICAgICAgIHRoaXMubWFwcy5kYXkgPSB0aGlzLl9pbml0X3NpbmdsZV9kYXkocGFyc2VkX2RhdGEsIGRhdGVzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUGFyc2VzIGRhdGEgaW50byBhIGRhdGUgc3RydWN0dXJlCiAgICAgICAgX3BhcnNlX2RhdGEoZGF0YSwgZGF0ZXMpIHsKICAgICAgICAgICAgLy8gUHJlcGFyZSB2ZXNzZWwKICAgICAgICAgICAgbGV0IHBhcnNlZF9kYXRhID0ge307CiAgICAgICAgICAgIGZvciAobGV0IHllYXI9ZGF0ZXMuZmlyc3RfeWVhcjsgeWVhcjw9ZGF0ZXMubGFzdF95ZWFyOyB5ZWFyKyspIHsKICAgICAgICAgICAgICAgIHBhcnNlZF9kYXRhW3llYXJdID0ge307CiAgICAgICAgICAgICAgICBmb3IgKGxldCBtb250aD0xOyBtb250aDw9MTI7IG1vbnRoKyspIHsKICAgICAgICAgICAgICAgICAgICBwYXJzZWRfZGF0YVt5ZWFyXVttb250aF0gPSB7fTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBkYXk9MDsgZGF5PD0zMTsgZGF5KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VkX2RhdGFbeWVhcl1bbW9udGhdW2RheV0gPSB7Y291bnRzOiB7fSwgbGlzdHM6IHt9LCBob3VyczogbmV3IEFycmF5KDI0KS5maWxsKCkubWFwKCgpPT57cmV0dXJuIHtjb3VudHM6IHt9LCBsaXN0czoge319O30pfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUG9wdWxhdGUgdmVzc2VsCiAgICAgICAgICAgIGZvciAobGV0IFtkYXRlLCBjb3VudHMsIGxpc3RzXSBvZiBkYXRhKSB7CiAgICAgICAgICAgICAgICBsZXQgW3llYXIsIG1vbnRoLCBkYXksIGhvdXJdID0gdGhpcy5fZ2V0X3ltZGgoZGF0ZS0xMDAwKjYwKjYwKnRoaXMuY29uZmlnLmRheV9zdGFydCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0ZS0xMDAwKjYwKjYwKnRoaXMuY29uZmlnLmRheV9zdGFydCA8IG5ldyBEYXRlKHRoaXMuY29uZmlnLmZpcnN0X2RhdGUpLmdldFRpbWUoKSB8fCBkYXRlLTEwMDAqNjAqNjAqdGhpcy5jb25maWcuZGF5X3N0YXJ0ID4gbmV3IERhdGUodGhpcy5jb25maWcubGFzdF9kYXRlIHx8IGRhdGUrMSkuZ2V0VGltZSgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGxldCBwYXJzZWRfZGF5ID0gcGFyc2VkX2RhdGFbeWVhcl1bbW9udGhdW2RheV07CiAgICAgICAgICAgICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY291bnRzKSkgewogICAgICAgICAgICAgICAgICAgIGlmICghcGFyc2VkX2RheS5jb3VudHNba2V5XSkgcGFyc2VkX2RheS5jb3VudHNba2V5XSA9IHZhbHVlIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBwYXJzZWRfZGF5LmNvdW50c1trZXldICs9IHZhbHVlIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJzZWRfZGF5LmhvdXJzW2hvdXJdLmNvdW50c1trZXldKSBwYXJzZWRfZGF5LmhvdXJzW2hvdXJdLmNvdW50c1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBwYXJzZWRfZGF5LmhvdXJzW2hvdXJdLmNvdW50c1trZXldICs9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGxpc3RzKSkgewogICAgICAgICAgICAgICAgICAgIGlmICghcGFyc2VkX2RheS5saXN0c1trZXldKSBwYXJzZWRfZGF5Lmxpc3RzW2tleV0gPSBbdmFsdWVdOwogICAgICAgICAgICAgICAgICAgIGVsc2UgcGFyc2VkX2RheS5saXN0c1trZXldLnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmICghcGFyc2VkX2RheS5ob3Vyc1tob3VyXS5saXN0c1trZXldKSBwYXJzZWRfZGF5LmhvdXJzW2hvdXJdLmxpc3RzW2tleV0gPSBbdmFsdWVdOwogICAgICAgICAgICAgICAgICAgIGVsc2UgcGFyc2VkX2RheS5ob3Vyc1tob3VyXS5saXN0c1trZXldLnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXJzZWRfZGF0YTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZSBhIHllYXIgZWxlbWVudCBmb3IgdGhlIGhlYXRtYXAKICAgICAgICBfaW5pdF95ZWFyKHllYXIsIGRhdGEsIGRhdGVzKSB7CiAgICAgICAgICAgIGxldCBjbHMgPSAneWVhciBoZWF0bWFwICcgKyB0aGlzLmNvbmZpZy5pZCArICh0aGlzLmNvbmZpZy5zZWdtZW50X3llYXJzPycgc2VnbWVudF95ZWFycyc6JycpICsgKHRoaXMuY29uZmlnLnplcm9fZ2FwPycgemVyb19nYXAnOicnKSArICh5ZWFyPm5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKT8nIGZ1dHVyZSc6JycpICsgKHllYXI9PW5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKT8nIGN1cnJlbnQnOicnKTsKICAgICAgICAgICAgbGV0IHllYXJfZWxlbSA9IHRoaXMuX2NyZWF0ZV9lbGVtKHt0eXBlOiAnZGl2JywgY2xhc3M6IGNscyx9KTsKICAgICAgICAgICAgeWVhcl9lbGVtLnNldEF0dHJpYnV0ZSgnZGF0YS15ZWFyJywgeWVhcik7CiAgICAgICAgICAgIGxldCBsYWJlbHMgPSB0aGlzLl9jcmVhdGVfZWxlbSh7dHlwZTogJ2RpdicsIGNsYXNzOiAneWVhci1sYWJlbHMnLCBjaGlsZHJlbjogdGhpcy5fZ2V0X3llYXJfbGFiZWxzKHllYXIpfSk7CiAgICAgICAgICAgIGxldCBtb250aHMgPSB0aGlzLl9jcmVhdGVfZWxlbSh7dHlwZTogJ2RpdicsIGNsYXNzOiAnbW9udGhzJ30pOwogICAgICAgICAgICBmb3IgKGxldCBtb250aD0xOyBtb250aDw9MTI7IG1vbnRoKyspIHsKICAgICAgICAgICAgICAgIG1vbnRocy5hcHBlbmQodGhpcy5faW5pdF9tb250aCh5ZWFyLCBtb250aCwgZGF0YSwgZGF0ZXMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB5ZWFyX2VsZW0uYXBwZW5kKGxhYmVscywgbW9udGhzKTsKICAgICAgICAgICAgcmV0dXJuIHllYXJfZWxlbTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZSBsYWJlbHMgZm9yIHRoZSB5ZWFycwogICAgICAgIF9nZXRfeWVhcl9sYWJlbHMoeWVhcikgewogICAgICAgICAgICBsZXQgeWVhcl9sYWJlbCA9IHRoaXMuX2NyZWF0ZV9lbGVtKHt0eXBlOiAnZGl2JywgY2xhc3M6ICd5ZWFyLWxhYmVsIGhvdmVyLXdyYXBwZXItdGFyZ2V0JywgY2hpbGQ6IFN0cmluZyh5ZWFyKX0pOwogICAgICAgICAgICBsZXQgZGF5X2xhYmVscyA9IHRoaXMuX2NyZWF0ZV9lbGVtKHt0eXBlOiAnZGl2JywgY2xhc3M6ICdkYXktbGFiZWxzJ30pOwogICAgICAgICAgICBmb3IgKGxldCBkYXk9MDsgZGF5PDc7IGRheSsrKSB7CiAgICAgICAgICAgICAgICBkYXlfbGFiZWxzLmFwcGVuZCh0aGlzLl9jcmVhdGVfZWxlbSh7dHlwZTogJ2RpdicsIGNsYXNzOiAnZGF5LWxhYmVsJywgY2hpbGQ6IFsnTScsJ1QnLCdXJywnVCcsJ0YnLCdTJywnUyddWyhkYXkrTnVtYmVyKHRoaXMuY29uZmlnLndlZWtfc3RhcnQpKSU3XX0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gW3llYXJfbGFiZWwsIGRheV9sYWJlbHNdOwogICAgICAgIH0KCiAgICAgICAgLy8gQ3JlYXRlIGEgbW9udGggZWxlbWVudCBmb3IgdGhlIHllYXIKICAgICAgICBfaW5pdF9tb250aCh5ZWFyLCBtb250aCwgZGF0YSwgZGF0ZXMpIHsKICAgICAgICAgICAgbGV0IG9mZnNldCA9IChuZXcgRGF0ZSh5ZWFyLCBtb250aC0xLCAxLCAwLCAwKS5nZXREYXkoKSs2LXRoaXMuY29uZmlnLndlZWtfc3RhcnQpJTc7CiAgICAgICAgICAgIGxldCBtb250aF9lbGVtID0gdGhpcy5fY3JlYXRlX2VsZW0oe3R5cGU6ICdkaXYnLCBjbGFzczogJ21vbnRoIG9mZnNldC0nK29mZnNldH0pOwogICAgICAgICAgICBpZiAoeWVhcj09PWRhdGVzLmZpcnN0X3llYXIgJiYgbW9udGg8ZGF0ZXMuZmlyc3RfbW9udGgpIG1vbnRoX2VsZW0uY2xhc3NMaXN0LmFkZCgnbm8tZGF0YScpOwogICAgICAgICAgICBsZXQgbGFiZWwgPSB0aGlzLl9jcmVhdGVfZWxlbSh7dHlwZTogJ2RpdicsIGNsYXNzOiAnbW9udGgtbGFiZWwnLCBjaGlsZDogWydKYW4nLCdGZWInLCdNYXInLCdBcHInLCdNYXknLCdKdW4nLCdKdWwnLCdBdWcnLCdTZXAnLCdPY3QnLCdOb3YnLCdEZWMnXVttb250aC0xXX0pOwogICAgICAgICAgICBsZXQgZGF5cyA9IHRoaXMuX2NyZWF0ZV9lbGVtKHt0eXBlOiAnZGl2JywgY2xhc3M6ICdkYXlzJ30pOwogICAgICAgICAgICBsZXQgZGF5c19pbl9tb250aCA9IHRoaXMuX2dldF9kYXlzX2luX21vbnRoKHllYXIsIG1vbnRoKTsKICAgICAgICAgICAgZm9yIChsZXQgZGF5PTE7IGRheTw9ZGF5c19pbl9tb250aDsgZGF5KyspIHsKICAgICAgICAgICAgICAgIGRheXMuYXBwZW5kKHRoaXMuX2luaXRfZGF5KHllYXIsIG1vbnRoLCBkYXksIGRhdGEsIGRhdGVzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbW9udGhfZWxlbS5hcHBlbmQobGFiZWwsIGRheXMpOwogICAgICAgICAgICByZXR1cm4gbW9udGhfZWxlbTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZSBhIGRheSBlbGVtZW50IGZvciB0aGUgbW9udGgKICAgICAgICBfaW5pdF9kYXkoeWVhciwgbW9udGgsIGRheSwgZGF0YSwgZGF0ZXMpIHsKICAgICAgICAgICAgbGV0IGRheV9kYXRhID0gZGF0YVt5ZWFyXVttb250aF1bZGF5XTsKICAgICAgICAgICAgbGV0IGRheV9lbGVtID0gdGhpcy5fY3JlYXRlX2VsZW0oe3R5cGU6ICdkaXYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdkYXkgaG92ZXItd3JhcHBlci10YXJnZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbzoge2NvdW50czogZGF5X2RhdGEuY291bnRzLCBsaXN0czogZGF5X2RhdGEubGlzdHN9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQ6IHRoaXMuX2NyZWF0ZV9lbGVtKHt0eXBlOiAnZGl2JywgY2xhc3M6ICdob3Zlci13cmFwcGVyJywgY2hpbGQ6IHRoaXMuY29uZmlnLmRheV9ob3Zlcl9jYWxsYmFjayhbeWVhciwgbW9udGgsIGRheV0sIGRheV9kYXRhKX0pfSk7CiAgICAgICAgICAgIGRheV9lbGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJywgYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YCk7CiAgICAgICAgICAgIGlmICh5ZWFyPT09ZGF0ZXMuZmlyc3RfeWVhciAmJiBtb250aD09PWRhdGVzLmZpcnN0X21vbnRoICYmIGRheTxkYXRlcy5maXJzdF9kYXkpIGRheV9lbGVtLmNsYXNzTGlzdC5hZGQoJ25vLWRhdGEnKTsKICAgICAgICAgICAgZGF5X2VsZW0uc3R5bGUuc2V0UHJvcGVydHkoJ2JhY2tncm91bmQtY29sb3InLCB0aGlzLmNvbmZpZy5jb2xvcl9jYWxsYmFjayhbeWVhciwgbW9udGgsIGRheV0sIGRheV9kYXRhKSk7CiAgICAgICAgICAgIHJldHVybiBkYXlfZWxlbTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZXMgYSBzaW1wbGUgaGVhdG1hcCB3aXRoIDI0IHNxdWFyZXMgdGhhdCByZXByZXNlbnQgYSBzaW5nbGUgZGF5CiAgICAgICAgX2luaXRfc2luZ2xlX2RheShkYXRhLCBkYXRlcykgewogICAgICAgICAgICBsZXQgZGF5ID0gdGhpcy5fY3JlYXRlX2VsZW0oe3R5cGU6ICdkaXYnLCBjbGFzczogJ3NpbmdsZS1kYXkgJyt0aGlzLmNvbmZpZy5pZH0pOwogICAgICAgICAgICBsZXQgaG91cl9kYXRhID0gZGF0YVtkYXRlcy5maXJzdF95ZWFyXVtkYXRlcy5maXJzdF9tb250aF1bZGF0ZXMuZmlyc3RfZGF5XS5ob3VyczsKICAgICAgICAgICAgbGV0IGN1cnJlbnRfaG91ciA9IG5ldyBEYXRlKCkuZ2V0SG91cnMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaT0wOyBpPDI0OyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCBqID0gKGkrdGhpcy5jb25maWcuZGF5X3N0YXJ0KSUyNDsKICAgICAgICAgICAgICAgIGxldCBob3VyID0gdGhpcy5fY3JlYXRlX2VsZW0oe3R5cGU6ICdkaXYnLCBjbGFzczogJ2hvdXIgaG92ZXItd3JhcHBlci10YXJnZXQnKyhqPT09Y3VycmVudF9ob3VyJiZEYXRlLnBhcnNlKG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCkpPT10aGlzLmNvbmZpZy5maXJzdF9kYXRlPycgdG9kYXkgbWFya2VkJzonJyksIGluZm86IHtjb3VudHM6IGhvdXJfZGF0YVtpXS5jb3VudHMsIGxpc3RzOiBob3VyX2RhdGFbaV0ubGlzdHN9fSk7CiAgICAgICAgICAgICAgICBsZXQgaG92ZXIgPSB0aGlzLl9jcmVhdGVfZWxlbSh7dHlwZTogJ2RpdicsIGNsYXNzOiAnaG92ZXItd3JhcHBlcicsIGNoaWxkOiB0aGlzLmNvbmZpZy5kYXlfaG92ZXJfY2FsbGJhY2soW2RhdGVzLmZpcnN0X3llYXIsIGRhdGVzLmZpcnN0X21vbnRoLCBkYXRlcy5maXJzdF9kYXksIGpdLCBob3VyX2RhdGFbaV0pfSk7CiAgICAgICAgICAgICAgICBob3VyLmFwcGVuZChob3Zlcik7CiAgICAgICAgICAgICAgICBob3VyLnN0eWxlLnNldFByb3BlcnR5KCdiYWNrZ3JvdW5kLWNvbG9yJywgdGhpcy5jb25maWcuY29sb3JfY2FsbGJhY2soW2RhdGVzLmZpcnN0X3llYXIsIGRhdGVzLmZpcnN0X21vbnRoLCBkYXRlcy5maXJzdF9kYXksIGpdLCBob3VyX2RhdGFbaV0pKTsKICAgICAgICAgICAgICAgIGRheS5hcHBlbmQoaG91cik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF5Lmluc3RhbmNlID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIGRheTsKICAgICAgICB9CgogICAgICAgIC8vIE1hcmtzIHByb3ZpZGVkIGRhdGVzIHdpdGggYSBib3JkZXIKICAgICAgICBfYWRkX21hcmtpbmdzKG1hcmtpbmdzLCB5ZWFycykgewogICAgICAgICAgICBmb3IgKGxldCBbZGF0ZSwgbWFya10gb2YgbWFya2luZ3MpIHsKICAgICAgICAgICAgICAgIGxldCBbeWVhciwgbW9udGgsIGRheV0gPSB0aGlzLl9nZXRfeW1kaChkYXRlKTsKICAgICAgICAgICAgICAgIGlmICh5ZWFyc1t5ZWFyXSkgeWVhcnNbeWVhcl0ucXVlcnlTZWxlY3RvcihgLmRheVtkYXRhLWRhdGU9IiR7eWVhcn0tJHttb250aH0tJHtkYXl9Il1gKS5jbGFzc0xpc3QuYWRkKC4uLm1hcmsuc3BsaXQoJyAnKSwgJ21hcmtlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBOdW1iZXIgb2YgZGF5cyBpbiBlYWNoIG1vbnRoCiAgICAgICAgX2dldF9kYXlzX2luX21vbnRoKHllYXIsIG1vbnRoKSB7cmV0dXJuIFszMSwgdGhpcy5faXNfbGVhcF95ZWFyKHllYXIpPzI5OjI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV1bbW9udGgtMV07fQoKICAgICAgICAvLyBDaGVja3MgZm9yIGxlYXAgeWVhcgogICAgICAgIF9pc19sZWFwX3llYXIoeWVhcikge3JldHVybiB5ZWFyJTQ9PTAgJiYgKHllYXIlMTAwIT0wIHx8IHllYXIlNDAwPT0wKTt9CgogICAgICAgIC8vIFNob3J0aGFuZCBmb3IgY3JlYXRpbmcgbmV3IGVsZW1lbnRzCiAgICAgICAgX2NyZWF0ZV9lbGVtKGNvbmZpZykgewogICAgICAgICAgICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjb25maWcudHlwZSk7CiAgICAgICAgICAgIGZvciAobGV0IFthdHRyLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnKSkgewogICAgICAgICAgICAgICAgaWYgKGF0dHIgPT09ICJ0eXBlIikgY29udGludWU7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhdHRyID09PSAiY2xhc3MiKSBkaXYuY2xhc3NOYW1lID0gdmFsdWU7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhdHRyID09PSAiY2hpbGQiKSBkaXYuYXBwZW5kKHZhbHVlKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF0dHIgPT09ICJjaGlsZHJlbiIpIGRpdi5hcHBlbmQoLi4udmFsdWUpOwogICAgICAgICAgICAgICAgZWxzZSBkaXZbYXR0cl0gPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGl2OwogICAgICAgIH0KCiAgICAgICAgLy8gR2V0IGZpcnN0IGFuZCBsYXN0IGRhdGVzIHRoYXQgc2hvdWxkIGJlIHZpc2libGUgaW4gdGhlIGhlYXRtYXAKICAgICAgICBfZ2V0X2RhdGVzKCkgewogICAgICAgICAgICBsZXQgW2ZpcnN0X3llYXIsIGZpcnN0X21vbnRoLCBmaXJzdF9kYXldID0gdGhpcy5fZ2V0X3ltZGgodGhpcy5jb25maWcuZmlyc3RfZGF0ZSk7CiAgICAgICAgICAgIGxldCBbbGFzdF95ZWFyLCBsYXN0X21vbnRoLCBsYXN0X2RheV0gPSB0aGlzLl9nZXRfeW1kaCh0aGlzLmNvbmZpZy5sYXN0X2RhdGUgfHwgRGF0ZS5ub3coKSk7CiAgICAgICAgICAgIHJldHVybiB7Zmlyc3RfeWVhciwgZmlyc3RfbW9udGgsIGZpcnN0X2RheSwKICAgICAgICAgICAgICAgICAgICBsYXN0X3llYXIsIGxhc3RfbW9udGgsIGxhc3RfZGF5LAogICAgICAgICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgZGF0ZSBpbnRvIHllYXIgbW9udGggZGF0ZSBhbmQgaG91cgogICAgICAgIF9nZXRfeW1kaChkYXRlKSB7bGV0IGQgPSBuZXcgRGF0ZShkYXRlKTsgcmV0dXJuIFtkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSsxLCBkLmdldERhdGUoKSwgZC5nZXRIb3VycygpXTt9CgogICAgfQoKICAgIC8vIEV4cG9zZSBjbGFzcwogICAgd2luZG93LkhlYXRtYXAgPSBIZWF0bWFwOwp9KSgpOwo="}]},{"name":"Wanikani: Overall Progress Bars","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_prototypes":false,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["/^https://(www|preview).wanikani.com/(dashboard)?$/"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"ts":1647573854342,"data":{}},"enabled":true,"position":4,"file_url":"https://greasyfork.org/scripts/441185-wanikani-overall-progress-bars/code/Wanikani:%20Overall%20Progress%20Bars.user.js","uuid":"6903faf2-112e-4773-924f-9cbd7f501938","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBXYW5pa2FuaTogT3ZlcmFsbCBQcm9ncmVzcyBCYXJzCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMS4zLjEKLy8gQGRlc2NyaXB0aW9uICBDcmVhdGVzIGEgcHJvZ3Jlc3MgYmFyIG9uIHRoZSBkYXNoYm9hcmQgZm9yIGV2ZXJ5IGxldmVsCi8vIEBhdXRob3IgICAgICAgS3VtaXJlaQovLyBAaW5jbHVkZSAgICAgIC9eaHR0cHM6Ly8od3d3fHByZXZpZXcpLndhbmlrYW5pLmNvbS8oZGFzaGJvYXJkKT8kLwovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gQGxpY2Vuc2UgICAgICBNSVQKLy8gPT0vVXNlclNjcmlwdD09Cgo7KGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHsgd2tvZiwgJCB9ID0gd2luZG93CgogICAgLy8gU2NyaXB0IGluZm8KICAgIGNvbnN0IHNjcmlwdF9uYW1lID0gJ092ZXJhbGwgUHJvZ3Jlc3MgQmFycycKICAgIGNvbnN0IHNjcmlwdF9pZCA9ICdvdmVyYWxsX3Byb2dyZXNzX2JhcicKCiAgICAvLyBDb25zdGFudHMKICAgIHNyc19uYW1lcyA9IHsKICAgICAgICAnLTEnOiAnTG9ja2VkJywKICAgICAgICAwOiAnSW4gbGVzc29ucycsCiAgICAgICAgMTogJ0FwcHJlbnRpY2UgMScsCiAgICAgICAgMjogJ0FwcHJlbnRpY2UgMicsCiAgICAgICAgMzogJ0FwcHJlbnRpY2UgMycsCiAgICAgICAgNDogJ0FwcHJlbnRpY2UgNCcsCiAgICAgICAgNTogJ0d1cnUgMScsCiAgICAgICAgNjogJ0d1cnUgMicsCiAgICAgICAgNzogJ01hc3RlcicsCiAgICAgICAgODogJ0VubGlnaHRlbmVkJywKICAgICAgICA5OiAnQnVybmVkJywKICAgIH0KICAgIGNvbnN0IHBvc2l0aW9ucyA9IFsKICAgICAgICAkKCcucHJvZ3Jlc3MtYW5kLWZvcmVjYXN0JyksCiAgICAgICAgJCgnLnNycy1wcm9ncmVzcycpLAogICAgICAgICQoJy5yZWNlbnQtdW5sb2NrcycpLmNsb3Nlc3QoJy5yb3cnKSwKICAgICAgICAkKCcuZm9ydW0tdG9waWNzLWxpc3QnKS5jbG9zZXN0KCcucm93JyksCiAgICBdCgogICAgLy8gSW5pdAogICAgY29uZmlybV93a29mKCkKICAgIHdrb2YuaW5jbHVkZSgnTWVudSxTZXR0aW5ncyxJdGVtRGF0YScpCiAgICBhd2FpdCB3a29mLnJlYWR5KCdNZW51LFNldHRpbmdzLEl0ZW1EYXRhJykudGhlbihsb2FkX3NldHRpbmdzKS50aGVuKGluc3RhbGxfbWVudSkKCiAgICBjb25zdCBzZXR0aW5ncyA9IHdrb2Yuc2V0dGluZ3Nbc2NyaXB0X2lkXQogICAgbGV0IGNvbG9yCgogICAgLy8gR2V0IGl0ZW1zIGJ5IGxldmVsCiAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHdrb2YuSXRlbURhdGEuZ2V0X2l0ZW1zKCdhc3NpZ25tZW50cycpCiAgICBjb25zdCBpdGVtc19ieV9sZXZlbCA9IHdrb2YuSXRlbURhdGEuZ2V0X2luZGV4KGl0ZW1zLCAnbGV2ZWwnKQoKICAgIC8vIEdldCBjb3VudHMgcGVyIFNSUyBsZXZlbCBwZXIgbGV2ZWwKICAgIGNvbnN0IGNvdW50c19ieV9sZXZlbF9hbmRfc3JzID0ge30KICAgIGZvciAobGV0IFtsZXZlbCwgaXRlbXNdIG9mIE9iamVjdC5lbnRyaWVzKGl0ZW1zX2J5X2xldmVsKSkgewogICAgICAgIGNvdW50c19ieV9sZXZlbF9hbmRfc3JzW2xldmVsXSA9IE9iamVjdC5mcm9tRW50cmllcygKICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMod2tvZi5JdGVtRGF0YS5nZXRfaW5kZXgoaXRlbXMsICdzcnNfc3RhZ2UnKSkubWFwKChbc3JzLCBpdGVtc10pID0+IFtzcnMsIGl0ZW1zLmxlbmd0aF0pLAogICAgICAgICkKICAgIH0KICAgIGRpc3BsYXkoKQoKICAgIGZ1bmN0aW9uIGRpc3BsYXkoKSB7CiAgICAgICAgc2V0X2NvbG9yX3RoZW1lKCkKICAgICAgICBpbmplY3RDc3MoKQogICAgICAgICQoJy5zcnMtbGV2ZWwtZ3JhcGgnKS5yZW1vdmUoKQogICAgICAgIHBvc2l0aW9uc1tzZXR0aW5ncy5wb3NpdGlvbl0uYmVmb3JlKAogICAgICAgICAgICBgPHNlY3Rpb24gY2xhc3M9InNycy1sZXZlbC1ncmFwaCI+JHtPYmplY3QuZW50cmllcyhjb3VudHNfYnlfbGV2ZWxfYW5kX3NycykKICAgICAgICAgICAgICAgIC5tYXAoZ2V0X2xldmVsKQogICAgICAgICAgICAgICAgLmpvaW4oJycpfTwvc2VjdGlvbmAsCiAgICAgICAgKQogICAgfQoKICAgIGZ1bmN0aW9uIHNldF9jb2xvcl90aGVtZSgpIHsKICAgICAgICBjb2xvciA9IHsKICAgICAgICAgICAgJy0xJzogc2V0dGluZ3MudGhlbWUgPT09ICdicmVlemUnID8gJyMzMTM2M0InIDogJyNhYWFhYWEnLAogICAgICAgICAgICAwOiBzZXR0aW5ncy50aGVtZSA9PT0gJ2JyZWV6ZScgPyAnIzMxMzYzQicgOiAnI2FhYWFhYScsCiAgICAgICAgICAgIDE6IHNldHRpbmdzLnRoZW1lID09PSAnYnJlZXplJyA/ICcjM2ZiYmYzJyA6ICcjZmYwMGJiJywKICAgICAgICAgICAgMjogc2V0dGluZ3MudGhlbWUgPT09ICdicmVlemUnID8gJyMyZWFhZjQnIDogJyNlZTAwYWEnLAogICAgICAgICAgICAzOiBzZXR0aW5ncy50aGVtZSA9PT0gJ2JyZWV6ZScgPyAnIzFkOTlmMycgOiAnI2RkMDA5OScsCiAgICAgICAgICAgIDQ6IHNldHRpbmdzLnRoZW1lID09PSAnYnJlZXplJyA/ICcjMGM4OGUyJyA6ICcjY2MwMDg4JywKICAgICAgICAgICAgNTogc2V0dGluZ3MudGhlbWUgPT09ICdicmVlemUnID8gJyMxY2RjOWEnIDogJyM5MzM5YWEnLAogICAgICAgICAgICA2OiBzZXR0aW5ncy50aGVtZSA9PT0gJ2JyZWV6ZScgPyAnIzFjZGM5YScgOiAnIzg4MmQ5ZScsCiAgICAgICAgICAgIDc6IHNldHRpbmdzLnRoZW1lID09PSAnYnJlZXplJyA/ICcjYzljZTNiJyA6ICcjMjk0ZGRiJywKICAgICAgICAgICAgODogc2V0dGluZ3MudGhlbWUgPT09ICdicmVlemUnID8gJyNmNjc0MDAnIDogJyMwMDkzZGQnLAogICAgICAgICAgICA5OiBzZXR0aW5ncy50aGVtZSA9PT0gJ2JyZWV6ZScgPyAnI2RhNDQ1MycgOiAnI0ZBQUYwRScsCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldF9sZXZlbChbbGV2ZWwsIGNvdW50c19ieV9zcnNdKSB7CiAgICAgICAgY29uc3QgdG90YWwgPSBPYmplY3QudmFsdWVzKGNvdW50c19ieV9zcnMpLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCkKICAgICAgICBjb25zdCBiYXJzID0gT2JqZWN0LmVudHJpZXMoY291bnRzX2J5X3NycykKICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gZ2V0X2JhciguLi5pdGVtLCB0b3RhbCkpCiAgICAgICAgICAgIC5qb2luKCcnKQogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0ibGV2ZWwiPjxkaXYgY2xhc3M9ImJhcnMiIHN0eWxlPSJiYWNrZ3JvdW5kOiAke2dldF9jb2xvcigKICAgICAgICAgICAgY291bnRzX2J5X3NycywKICAgICAgICApfTsiPiR7YmFyc308L2Rpdj48ZGl2IGNsYXNzPSJsYmwiIHRpdGxlPSJMZXZlbCAke2xldmVsfSI+JHtsZXZlbH08L2Rpdj48L2Rpdj5gCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0X2JhcihzcnNfbGV2ZWwsIGNvdW50LCB0b3RhbCkgewogICAgICAgIGNvbnN0IHBlcmNlbnQgPSBNYXRoLnJvdW5kKChjb3VudCAvIHRvdGFsKSAqIDEwMCkKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InNycyIgZGF0YS1zcnM9IiR7c3JzX2xldmVsfSIgdGl0bGU9IiR7c3JzX25hbWVzW3Nyc19sZXZlbF19OiAke2NvdW50fSAvICR7dG90YWx9IGl0ZW1zICgke3BlcmNlbnR9JSkiIHN0eWxlPSJmbGV4LWdyb3c6ICR7Y291bnR9Ij48L2Rpdj5gCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0X2NvbG9yKGNvdW50c19ieV9zcnMpIHsKICAgICAgICBpZiAoIVsnYmxlbmQnLCAnYXZnX3NycyddLmluY2x1ZGVzKHNldHRpbmdzLmRpc3BsYXkpKSByZXR1cm4gJycKICAgICAgICBjb25zdCBzcnNfbGV2ZWxzID0gT2JqZWN0LmVudHJpZXMoY291bnRzX2J5X3NycykucmVkdWNlKAogICAgICAgICAgICAoc3JzX2l0ZW1zLCBbc3JzX2xldmVsLCBjb3VudF0pID0+IHNyc19pdGVtcy5jb25jYXQobmV3IEFycmF5KGNvdW50KS5maWxsKHNyc19sZXZlbCA8IDAgPyAwIDogc3JzX2xldmVsKSksCiAgICAgICAgICAgIFtdLAogICAgICAgICkKICAgICAgICBjb25zdCBhdmdfc3JzID0gc3JzX2xldmVscy5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyBOdW1iZXIodmFsKSwgMCkgLyBzcnNfbGV2ZWxzLmxlbmd0aAogICAgICAgIGlmIChzZXR0aW5ncy5kaXNwbGF5ID09PSAnYmxlbmQnKSB7CiAgICAgICAgICAgIHJldHVybiBhdmVyYWdlQ29sb3JzKHNyc19sZXZlbHMpCiAgICAgICAgfSBlbHNlIGlmIChzZXR0aW5ncy5kaXNwbGF5ID09PSAnYXZnX3NycycpIHsKICAgICAgICAgICAgcmV0dXJuIGludGVycG9sYXRlX2NvbG9yKGNvbG9yW01hdGguZmxvb3IoYXZnX3NycyldLCBjb2xvcltNYXRoLmNlaWwoYXZnX3NycyldLCBhdmdfc3JzICUgMSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuICcnCiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUNvbG9ycyhsZXZlbEl0ZW1zKSB7CiAgICAgICAgbGV0IGl0ZW1WYWx1ZXMgPSBbMCwgMCwgMF0KICAgICAgICBsZXQgYXZlcmFnZUNvbG9yID0gJyMnCgogICAgICAgIC8vIEZvciBlYWNoIGxldmVsLCBhIG1lYW4gYXZlcmFnZSBpcyB0YWtlbiBvZiBlYWNoIGl0ZW0ncyBjb2xvcgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGV2ZWxJdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgICAgICAgaXRlbVZhbHVlc1tqXSArPSBwYXJzZUludCgnMHgwJyArIGNvbG9yW2xldmVsSXRlbXNbaV1dLnNsaWNlKDIgKiBqICsgMSwgMiAqIGogKyAzKSwgMTYpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIERpdmlkZSBieSB0aGUgdG90YWwgdG8gZ2V0IHRoZSBtZWFucyBmb3IgUkdCCiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBpdGVtVmFsdWVzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIGl0ZW1WYWx1ZXNba10gPSBpdGVtVmFsdWVzW2tdIC8gbGV2ZWxJdGVtcy5sZW5ndGgKICAgICAgICAgICAgaXRlbVZhbHVlc1trXSA9IE1hdGgucm91bmQoaXRlbVZhbHVlc1trXSkKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgYmFjayBpbnRvIGhleAogICAgICAgIGF2ZXJhZ2VDb2xvciA9ICcjJyArIGl0ZW1WYWx1ZXMubWFwKChhKSA9PiBgMDAke3BhcnNlSW50KGEsIDEwKS50b1N0cmluZygxNil9YC5zbGljZSgtMikpLmpvaW4oJycpCgogICAgICAgIHJldHVybiBhdmVyYWdlQ29sb3IKICAgIH0KCiAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZV9jb2xvcihhLCBiLCBhbW91bnQpIHsKICAgICAgICB2YXIgYWggPSBwYXJzZUludChhLnJlcGxhY2UoLyMvZywgJycpLCAxNiksCiAgICAgICAgICAgIGFyID0gYWggPj4gMTYsCiAgICAgICAgICAgIGFnID0gKGFoID4+IDgpICYgMHhmZiwKICAgICAgICAgICAgYWIgPSBhaCAmIDB4ZmYsCiAgICAgICAgICAgIGJoID0gcGFyc2VJbnQoYi5yZXBsYWNlKC8jL2csICcnKSwgMTYpLAogICAgICAgICAgICBiciA9IGJoID4+IDE2LAogICAgICAgICAgICBiZyA9IChiaCA+PiA4KSAmIDB4ZmYsCiAgICAgICAgICAgIGJiID0gYmggJiAweGZmLAogICAgICAgICAgICByciA9IGFyICsgYW1vdW50ICogKGJyIC0gYXIpLAogICAgICAgICAgICByZyA9IGFnICsgYW1vdW50ICogKGJnIC0gYWcpLAogICAgICAgICAgICByYiA9IGFiICsgYW1vdW50ICogKGJiIC0gYWIpCgogICAgICAgIHJldHVybiAnIycgKyAoKCgxIDw8IDI0KSArIChyciA8PCAxNikgKyAocmcgPDwgOCkgKyByYikgfCAwKS50b1N0cmluZygxNikuc2xpY2UoMSkKICAgIH0KCiAgICBmdW5jdGlvbiBpbmplY3RDc3MoKSB7CiAgICAgICAgbGV0IHNyc19jc3MgPSAnJwogICAgICAgIGZvciAobGV0IGkgPSAtMTsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgc3JzX2NzcyArPSBgCi5zcnMtbGV2ZWwtZ3JhcGggLnNyc1tkYXRhLXNycz0iJHtpfSJdIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICR7Y29sb3JbaV19OwogICAgJHtzZXR0aW5ncy5kaXNwbGF5ICE9PSAnYmFycycgPyAnd2lkdGg6IDEwMCcgOiAnaGVpZ2h0OiAnICsgKGkgKyAxKSAqIDEwfSU7Cn1gCiAgICAgICAgfQoKICAgICAgICBjb25zdCBjc3MgPSBgLnNycy1sZXZlbC1ncmFwaCB7CiAgICBoZWlnaHQ6IDNlbTsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWV2ZW5seTsKICAgIGdhcDogMC4yZW07CiAgICBwYWRkaW5nOiAxNnB4IDEycHggMTJweDsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmNGY0ZjQ7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBtYXJnaW46IDAgMCAzMHB4IDAgIWltcG9ydGFudDsKfQoKLnNycy1sZXZlbC1ncmFwaCAubGV2ZWwgewogICAgd2lkdGg6IDEwMCU7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKfQoKLnNycy1sZXZlbC1ncmFwaCAuYmFycyB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGZsZXgtZW5kOwogICAgZmxleC1ncm93OiAxOwogICAgZmxleC1kaXJlY3Rpb246ICR7c2V0dGluZ3MuZGlzcGxheSAhPT0gJ2JhcnMnID8gJ2NvbHVtbicgOiAncm93LXJldmVyc2UnfTsKfQoKLnNycy1sZXZlbC1ncmFwaCAubGJsIHsKICAgIGZvbnQtc2l6ZTogMC43NWVtOwogICAgbGluZS1oZWlnaHQ6IDEuNWVtOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgdmVydGljYWwtYWxpZ246IGJvdHRvbTsKfQoKLnNycy1sZXZlbC1ncmFwaCAuc3JzIHsKICAgICR7WydibGVuZCcsICdhdmdfc3JzJ10uaW5jbHVkZXMoc2V0dGluZ3MuZGlzcGxheSkgPyAnZGlzcGxheTpub25lOycgOiAnJ30KICAgICR7c2V0dGluZ3MuZGlzcGxheSAhPT0gJ2JhcnMnID8gJycgOiAnYm9yZGVyLXJhZGl1czogMC4xZW0gMC4xZW0gMCAwOyd9Cn0KCi5zcnMtbGV2ZWwtZ3JhcGggLnNyc1tkYXRhLXNycz0iLTEiXSB7CiAgICBvcmRlcjogLTE7Cn0KCiR7c3JzX2Nzc31gCgogICAgICAgICQoYCNvdmVyYWxsLXByb2dyZXNzLWJhcnMtY3NzYCkucmVtb3ZlKCkKICAgICAgICAkKCdoZWFkJykuYXBwZW5kKGA8c3R5bGUgaWQ9Im92ZXJhbGwtcHJvZ3Jlc3MtYmFycy1jc3MiPiR7Y3NzfTwvc3R5bGU+YCkKICAgIH0KCiAgICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KICAgIC8vIFdLT0Ygc2V0dXAKICAgIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAgIC8vIE1ha2VzIHN1cmUgdGhhdCBXS09GIGlzIGluc3RhbGxlZAogICAgYXN5bmMgZnVuY3Rpb24gY29uZmlybV93a29mKCkgewogICAgICAgIGlmICghd2tvZikgewogICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBjb25maXJtKAogICAgICAgICAgICAgICAgYCR7c2NyaXB0X25hbWV9IHJlcXVpcmVzIFdhbmlLYW5pIE9wZW4gRnJhbWV3b3JrLlxuQ2xpY2sgIk9LIiB0byBiZSBmb3J3YXJkZWQgdG8gaW5zdGFsbGF0aW9uIGluc3RydWN0aW9ucy5gLAogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPQogICAgICAgICAgICAgICAgICAgICdodHRwczovL2NvbW11bml0eS53YW5pa2FuaS5jb20vdC9pbnN0cnVjdGlvbnMtaW5zdGFsbGluZy13YW5pa2FuaS1vcGVuLWZyYW1ld29yay8yODU0OScKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICB9CgogICAgLy8gTG9hZCBXS09GIHNldHRpbmdzCiAgICBmdW5jdGlvbiBsb2FkX3NldHRpbmdzKCkgewogICAgICAgIGNvbnN0IGRlZmF1bHRzID0gewogICAgICAgICAgICBkaXNwbGF5OiAnc3RhY2snLAogICAgICAgICAgICB0aGVtZTogJ2RlZmF1bHQnLAogICAgICAgICAgICBwb3NpdGlvbjogMCwKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdrb2YuU2V0dGluZ3MubG9hZChzY3JpcHRfaWQsIGRlZmF1bHRzKQogICAgfQoKICAgIC8vIEluc3RhbGxzIHRoZSBvcHRpb25zIGJ1dHRvbiBpbiB0aGUgbWVudQogICAgZnVuY3Rpb24gaW5zdGFsbF9tZW51KCkgewogICAgICAgIGNvbnN0IGNvbmZpZyA9IHsKICAgICAgICAgICAgbmFtZTogc2NyaXB0X2lkLAogICAgICAgICAgICBzdWJtZW51OiAnU2V0dGluZ3MnLAogICAgICAgICAgICB0aXRsZTogc2NyaXB0X25hbWUsCiAgICAgICAgICAgIG9uX2NsaWNrOiBvcGVuX3NldHRpbmdzLAogICAgICAgIH0KICAgICAgICB3a29mLk1lbnUuaW5zZXJ0X3NjcmlwdF9saW5rKGNvbmZpZykKICAgIH0KCiAgICAvLyBPcGVucyBzZXR0aW5ncyBkaWFsb2d1ZSB3aGVuIGJ1dHRvbiBpcyBwcmVzc2VkCiAgICBmdW5jdGlvbiBvcGVuX3NldHRpbmdzKCkgewogICAgICAgIGxldCBjb25maWcgPSB7CiAgICAgICAgICAgIHNjcmlwdF9pZDogc2NyaXB0X2lkLAogICAgICAgICAgICB0aXRsZTogc2NyaXB0X25hbWUsCiAgICAgICAgICAgIG9uX3NhdmU6IGRpc3BsYXksCiAgICAgICAgICAgIGNvbnRlbnQ6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZHJvcGRvd24nLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnRGlzcGxheSBhcycsCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogJ3N0YWNrJywKICAgICAgICAgICAgICAgICAgICBob3Zlcl90aXA6ICdDaGFuZ2VzIGhvdyB0aGUgYmFycyBsb29rJywKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrOiAnU3RhY2snLAogICAgICAgICAgICAgICAgICAgICAgICBiYXJzOiAnQmFycycsCiAgICAgICAgICAgICAgICAgICAgICAgIGF2Z19zcnM6ICdTaW5nbGUgQ29sb3IgKGF2ZXJhZ2UgU1JTKScsCiAgICAgICAgICAgICAgICAgICAgICAgIGJsZW5kOiAnU2luZ2xlIENvbG9yIChibGVuZCknLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGhlbWU6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZHJvcGRvd24nLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVGhlbWUnLAogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnQ2hhbmdlcyB0aGUgY29sb3JzIG9mIHRoZSBiYXJzJywKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7IGRlZmF1bHQ6ICdEZWZhdWx0JywgYnJlZXplOiAnQnJlZXplIERhcmsnIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZHJvcGRvd24nLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnUG9zaXRpb24nLAogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgaG92ZXJfdGlwOiAnQ2hhbmdlcyB0aGUgY29sb3JzIG9mIHRoZSBiYXJzJywKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBbJ1RvcCcsICdBYm92ZSBTUlMgQ291bnRzJywgJ0Fib3ZlIFBhbmVscycsICdBYm92ZSBSZWNlbnQgVG9waWNzJ10sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICBsZXQgZGlhbG9nID0gbmV3IHdrb2YuU2V0dGluZ3MoY29uZmlnKQogICAgICAgIGRpYWxvZy5vcGVuKCkKICAgIH0KfSkoKQo="},{"name":"Bunpro: Streak Chart Additions","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_prototypes":false,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["*bunpro.jp/user/profile/stats"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null}},"storage":{"ts":1647911369152,"data":{}},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/370059-bunpro-streak-chart-additions/code/Bunpro:%20Streak%20Chart%20Additions.user.js","uuid":"689a41a7-58f8-4ad6-aa73-bf91196475b6","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBCdW5wcm86IFN0cmVhayBDaGFydCBBZGRpdGlvbnMKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8KLy8gQHZlcnNpb24gICAgICAwLjEuMwovLyBAZGVzY3JpcHRpb24gIEFkZHMgYSBiYXIgZm9yIHVubGVhcm5lZCBpdGVtcyBhbmQgY2hhbmdlcyB0aGUgbGFiZWxzIG9uIHRoZSBiYXJzIHRvIGJlIG1vcmUgaW5mb3JtYXRpdmUKLy8gQGF1dGhvciAgICAgICBLdW1pcmVpCi8vIEBpbmNsdWRlICAgICAgKmJ1bnByby5qcC91c2VyL3Byb2ZpbGUvc3RhdHMKLy8gQGdyYW50ICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQovKmpzaGludCBlc3ZlcnNpb246IDggKi8KCihmdW5jdGlvbigpIHsKICAgIC8vIENoYW5nZSB0aGlzIHRvIGZhbHNlIGlmIHlvdSB3YW50IHRvIGhpZGUgdGhlIHVubGVhcm5lZCBiYXIKICAgIHZhciBkaXNwbGF5VW5sZWFybmVkID0gdHJ1ZTsKCiAgICAvL2FkZHMgdGhlIGJhcnMKICAgIGZ1bmN0aW9uIGVkaXRDaGFydCgpIHsKICAgICAgICB2YXIgY29uZmlnID0gbXlDaGFydC5jaGFydC5jb25maWc7CiAgICAgICAgdmFyIGRhdGFzZXQgPSBjb25maWcuZGF0YS5kYXRhc2V0c1swXTsKICAgICAgICB2YXIgdW5sZWFybmVkID0gdG90YWwgLSBsZWFybmVkOwogICAgICAgIHZhciBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCA0MDApOwogICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAncmdiKDIyNywgMTkxLCAxMjcpJyk7CiAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICdyZ2IoMjE5LCAzMiwgMzUpJyk7CiAgICAgICAgaWYgKGRpc3BsYXlVbmxlYXJuZWQpIHsKICAgICAgICAgICAgZGF0YXNldC5kYXRhLnVuc2hpZnQodW5sZWFybmVkKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYWRkIHRoZSBiYXJzCiAgICAgICAgICAgIGNvbmZpZy5kYXRhLmxhYmVscy51bnNoaWZ0KCIgIik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xhYmVsIHRoZSBiYXJzCiAgICAgICAgICAgIGRhdGFzZXQuYmFja2dyb3VuZENvbG9yID0gWyIjMWIyNDM3IiwgLi4uQXJyYXkoMTMpLmZpbGwoZ3JhZGllbnQpXTsgICAgICAgICAgICAgICAvL21ha2UgdW5sZWFybmVkIGJhciBhIGRpZmZlcmVudCBjb2xvcgogICAgICAgICAgICAkKCcuYnVucHJvLWhhbmtvLXN0YXRzJykucHJlcGVuZCgnPGRpdiBjbGFzcz0iY29sLXhzLTEgc3RyZWFrIGhhbmtvIGhhbmtvLS1ncmV5Ij48L2Rpdj4nKTsKICAgICAgICAgICAgLy9jaGFuZ2Ugc3R5bGluZyBvZiBzdGFtcHMgdG8gbWFrZSByb29tIGZvciB0aGUgdHdvIG5ldyBvbmVzCiAgICAgICAgICAgICQoJ2hlYWQnKS5hcHBlbmQoJzxzdHlsZSBpZD0iQ2hhcnRTY3JpcHRTdHlsZSI+JysKICAgICAgICAgICAgJy5idW5wcm8taGFua28tc3RhdHMgLmhhbmtvIHt3aWR0aDogNy4xNCUgIWltcG9ydGFudDsgcGFkZGluZzogMDt9JysKICAgICAgICAgICAgJ0BtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgeycrCiAgICAgICAgICAgICcuYnVucHJvLWhhbmtvLXN0YXRzIHtwYWRkaW5nLWxlZnQ6IDMzcHggIWltcG9ydGFudDsgcGFkZGluZy1yaWdodDogMTNweCAhaW1wb3J0YW50O30nKwogICAgICAgICAgICAnfScrCiAgICAgICAgICAgICdAbWVkaWEgKG1pbi13aWR0aDogMTIwMHB4KSB7JysKICAgICAgICAgICAgJy5idW5wcm8taGFua28tc3RhdHMge3BhZGRpbmctbGVmdDogMzhweCAhaW1wb3J0YW50OyBwYWRkaW5nLXJpZ2h0OiA4cHggIWltcG9ydGFudDt9JysKICAgICAgICAgICAgJ30nKwogICAgICAgICAgICAnPC9zdHlsZT4nKTsKICAgICAgICB9CiAgICAgICAgY29uZmlnLm9wdGlvbnMudG9vbHRpcHMuZGlzcGxheUNvbG9ycyA9IGZhbHNlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVtb3ZlcyBjb2xvciBib3ggZnJvbSB0b29sdGlwIGxhYmVsCiAgICAgICAgY29uZmlnLm9wdGlvbnMudG9vbHRpcHMuY2FsbGJhY2tzID0ge3RpdGxlOiBmdW5jdGlvbihpdGVtLCBkYXRhKSB7ICAgICAgICAgICAgICAgIC8vYWRkIGludGVydmFsIGluZm8gdG8gdG9vbHRpcAogICAgICAgICAgICB2YXIgbGFiZWxzID0gWyJOb3ciLCAiNGgiLCAiOGgiLCAiMjRoIiwgIjJkIiwgIjRkIiwgIjhkIiwgIjJ3IiwgIjFtIiwgIjJtIiwgIjRtIiwgIjZtIiwgIk5ldmVyIl07CiAgICAgICAgICAgIGlmIChkaXNwbGF5VW5sZWFybmVkKSBsYWJlbHMudW5zaGlmdCgnVW5sZWFybmVkJyk7CiAgICAgICAgICAgIHJldHVybiBsYWJlbHNbaXRlbVswXS5pbmRleF07fX07CiAgICAgICAgICAgIGRhdGFzZXQubGFiZWwgPSAiQ291bnQiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NoYW5nZXMgIlN0cmVhayIgdG8gIkNvdW50IiBpbiB0b29sdGlwCiAgICAgICAgICAgIG15Q2hhcnQudXBkYXRlKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy91cGRhdGUgY2hhcnQKICAgICAgICB9CgoKICAgICAgICAvL2dldCBudW1iZXIgb2YgbGVhcm5lZCBpdGVtcyBhbmQgdG90YWwgbnVtYmVyIG9mIGl0ZW1zCiAgICAgICAgdmFyIHVybCA9ICQoJyNsb2dvJylbMF0uaHJlZjsgLy9wcm9maWxlIHBhZ2UgdXJsCiAgICAgICAgdmFyIGxlYXJuZWQgPSAwOwogICAgICAgIHZhciB0b3RhbCA9IDA7CiAgICAgICAgJC5nZXQodXJsLCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICQoZGF0YSkuZmluZCgnLnByb2dyZXNzLWNvdW50JykuZWFjaChmdW5jdGlvbihpLCBlKSB7CiAgICAgICAgICAgICAgICB2YXIgTGVhcm5lZFRvdGFsID0gZS5pbm5lclRleHQuc3BsaXQoJy8nKTsKICAgICAgICAgICAgICAgIGlmICghaXNOYU4oTGVhcm5lZFRvdGFsWzBdKSkgewogICAgICAgICAgICAgICAgICAgIGxlYXJuZWQgKz0gTnVtYmVyKExlYXJuZWRUb3RhbFswXSk7CiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gTnVtYmVyKExlYXJuZWRUb3RhbFsxXS5zcGxpdCgiICIpWzBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSkudGhlbihlZGl0Q2hhcnQpOwogICAgfSkoKTsK"}]}